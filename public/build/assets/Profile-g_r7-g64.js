import{_ as ae,r as n,f as B,w as q,W as oe,v as C,O as a,C as r,al as le,E as f,H as S,a8 as re,D as Y,F as te,R as v,L as P,$ as x,Z as A,am as L,ab as se,G as b,ag as I,aw as j,J as N,a0 as m,a6 as u,aD as ne,av as z,ao as F,a5 as ie,a3 as U,ax as de}from"./main-DHxkGDom.js";import{b as ue,u as ce}from"./app-DZGKe3Aq.js";const fe={setup(){const s=ue(),o=n(null),_=n(null),e=n(!1),E=n(!1),w=n(!1),t=n(""),g=n(""),O=n(null),R=n(!1),h=n(!1),W=n(!1);n(!1);const M=n(""),D=n(3),k=n(!1),c=B({first_name:"",last_name:"",middle_name:"",phone:"",email:""}),y=B({current_password:"",new_password:"",confirm_password:""}),G={deactivate:l=>!!l||"You must confirm your account deactivation",required:l=>!!l||"This field is required",email:l=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)||"Invalid email format",phone:l=>/^\d{10}$/.test(l.replace(/\D/g,""))||"Invalid phone number format (10 digits required)",passwordStrength:l=>l.length>=8||"Password must be at least 8 characters",passwordMatch:l=>l===y.new_password||"Passwords do not match"},H=async()=>{try{if(h.value=!0,(await v.post("/api/send-deactivation-code")).status===200)g.value=!0;else throw new Error("Failed to send verification code.")}catch(l){console.error("Error sending verification code:",l),s.error("Unable to send verification code. Please try again later.")}finally{h.value=!1}},J=async()=>{var l,i;try{if(h.value=!0,(await v.post("/api/deactivate-account",{code:M.value})).status===200)s.success("Your account has been successfully deactivated."),Q(),T();else throw new Error("Account deactivation failed.")}catch(d){console.error("Error deactivating account:",d),s.error(((i=(l=d.response)==null?void 0:l.data)==null?void 0:i.message)||"Failed to deactivate account.")}finally{h.value=!1}},T=()=>{console.log("Countdown started"),k.value=!0;const l=setInterval(()=>{console.log("Countdown:",D.value),D.value-=1,D.value===0&&(clearInterval(l),Z(),K())},1e3)},Z=()=>{D.value=3,k.value=!1},K=()=>{ce().logoutWithoutConfirmation()},Q=async()=>{try{await v.post("/api/send-deactivation-email")}catch(l){console.error("Error sending deactivation email:",l)}},X=async()=>{try{e.value=!0;const l=await v.get("/user-data",{params:{personal_info:!0}});Object.assign(c,l.data.personal_info||{}),t.value=c.email}catch{s.error("Failed to load profile")}finally{e.value=!1}},$=async()=>{var d,V;if(!o.value){s.error("Form not found");return}const{valid:l}=await o.value.validate();if(!l){s.error("Please fill all required fields correctly");return}const i=c.email!==t.value;if(i&&!w.value){console.log("Email has changed and not verifying yet.");try{if(e.value=!0,(await v.post("/api/send-verification",{email:c.email})).status===200)w.value=!0,s.info("Verification code sent to your email");else throw new Error("Failed to send verification code")}catch(p){console.error("Error sending verification email:",p),s.error("Failed to send verification code")}finally{e.value=!1}return}if(i&&!g.value){s.error("Please enter the verification code");return}try{e.value=!0;const p={...c,verificationCode:i?g.value:null};if((await v.post("/api/profile/update",p)).status===200)s.success("Profile updated successfully"),i&&(w.value=!1,g.value="",t.value=c.email);else throw new Error("Profile update failed")}catch(p){console.error("Error updating profile:",p),s.error(((V=(d=p.response)==null?void 0:d.data)==null?void 0:V.message)||"Failed to update profile")}finally{e.value=!1}},ee=async()=>{var i,d;if(!_.value){s.error("Form reference is not found.");return}const{valid:l}=await _.value.validate();if(!l){s.error("Please fill all required fields correctly.");return}try{if(E.value=!0,(await v.post("/api/update-password",{current_password:y.current_password,new_password:y.new_password,new_password_confirmation:y.confirm_password})).status===200)s.success("Password updated successfully!"),Object.assign(y,{current_password:"",new_password:"",confirm_password:""}),_.value.reset();else throw new Error("Password update failed")}catch(V){console.error("Error updating password:",V),s.error(((d=(i=V.response)==null?void 0:i.data)==null?void 0:d.message)||"Failed to update password.")}finally{E.value=!1}};return q(w,l=>{console.log("isVerifying changed:",l)}),q(c,async(l,i)=>{if(console.log("formData changed:",{oldValue:i,newValue:l}),o.value){const d=await o.value.validate();console.log("Validation status after formData change:",d)}else console.error("Form reference is not available.")}),q(g,l=>{l&&s.info("Please enter the verification code sent to your email.")}),oe(X),{handleDeactivate:J,sendVerificationCode:H,deactivateForm:O,verificationCodeInput:M,confirmDeactivation:W,deactivateLoading:h,form:o,sendingCode:R,countdownActive:k,countdown:D,passwordForm:_,formData:c,passwordData:y,loading:e,startCountdown:T,passwordLoading:E,isVerifying:w,verificationCode:g,rules:G,handleSubmit:$,handlePasswordUpdate:ee}}},me={key:0,class:"mt-4"},pe={key:0},ve={key:1},we={key:0,class:"custom-overlay"},ge={class:"overlay-content text-center"},ye={class:"text-white mb-4"};function Ve(s,o,_,e,E,w){return P(),C(te,null,[a(le,null,{default:r(()=>[a(x,null,{default:r(()=>[a(A,{class:"details-card pa-4 rounded-lg shadow-lg",style:{margin:"0 auto","background-color":"#f9f9f9"}},{default:r(()=>[a(L,{class:"d-flex justify-space-between align-center"},{default:r(()=>[o[13]||(o[13]=f("span",{class:"text-h6 font-weight-bold"},"My Profile",-1)),a(se,{color:"success",size:"small",variant:"tonal","prepend-icon":"mdi-check-circle"},{default:r(()=>o[12]||(o[12]=[b(" Verified Account ")])),_:1})]),_:1}),a(I,{class:"my-3"}),a(j,{ref:"form",onSubmit:N(e.handleSubmit,["prevent"])},{default:r(()=>[a(x,{class:"mt-4"},{default:r(()=>[a(m,{cols:"12",md:"6"},{default:r(()=>[a(u,{modelValue:e.formData.first_name,"onUpdate:modelValue":o[0]||(o[0]=t=>e.formData.first_name=t),label:"First Name",outlined:"",dense:"",readonly:e.isVerifying,"prepend-inner-icon":"mdi-account",rules:[e.rules.required],color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly","rules"])]),_:1}),a(m,{cols:"12",md:"6"},{default:r(()=>[a(u,{modelValue:e.formData.last_name,"onUpdate:modelValue":o[1]||(o[1]=t=>e.formData.last_name=t),label:"Last Name",outlined:"",dense:"",readonly:e.isVerifying,"prepend-inner-icon":"mdi-account",rules:[e.rules.required],color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly","rules"])]),_:1}),a(m,{cols:"12",md:"6"},{default:r(()=>[a(u,{modelValue:e.formData.middle_name,"onUpdate:modelValue":o[2]||(o[2]=t=>e.formData.middle_name=t),label:"Middle Name",outlined:"",dense:"",readonly:e.isVerifying,"prepend-inner-icon":"mdi-account",color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly"])]),_:1}),a(m,{cols:"12",md:"6"},{default:r(()=>[a(u,{modelValue:e.formData.phone,"onUpdate:modelValue":o[3]||(o[3]=t=>e.formData.phone=t),label:"Phone",outlined:"",dense:"",readonly:e.isVerifying,"prepend-inner-icon":"mdi-phone",rules:[e.rules.required,e.rules.phone],color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly","rules"])]),_:1}),a(m,{cols:"12"},{default:r(()=>[a(u,{modelValue:e.formData.email,"onUpdate:modelValue":o[4]||(o[4]=t=>e.formData.email=t),label:"Email",outlined:"",dense:"",readonly:e.isVerifying,"prepend-inner-icon":"mdi-email",rules:[e.rules.required,e.rules.email],color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly","rules"])]),_:1})]),_:1}),a(ne,null,{default:r(()=>[e.isVerifying?(P(),C("div",me,[a(z,{color:"success",variant:"tonal",border:"start"},{default:r(()=>[b(" Please enter the verification code sent to "+S(s.originalEmail),1)]),_:1}),a(u,{modelValue:e.verificationCode,"onUpdate:modelValue":o[5]||(o[5]=t=>e.verificationCode=t),label:"Verification Code",variant:"outlined",class:"mt-4 custom-purple-input",rules:[e.rules.required]},null,8,["modelValue","rules"])])):Y("",!0)]),_:1}),a(F,{class:"mt-4"},{default:r(()=>[a(ie),a(U,{color:"purple",type:"submit",variant:"elevated",loading:e.loading,disabled:e.loading},{default:r(()=>[b(S(e.isVerifying?"Verify & Update":"Update Profile"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1}),a(x,{class:"mt-10"},{default:r(()=>[a(A,{class:"details-card pa-4 rounded-lg shadow-lg",style:{margin:"0 auto","background-color":"#f9f9f9"}},{default:r(()=>[a(L,{class:"d-flex justify-space-between align-center"},{default:r(()=>o[14]||(o[14]=[f("span",{class:"text-h6 font-weight-bold"},"Update Password",-1)])),_:1}),a(I,{class:"my-3"}),a(j,{ref:"passwordForm",onSubmit:N(e.handlePasswordUpdate,["prevent"])},{default:r(()=>[a(x,{class:"mt-4"},{default:r(()=>[a(m,{cols:"12",md:"12"},{default:r(()=>[a(u,{modelValue:e.passwordData.current_password,"onUpdate:modelValue":o[6]||(o[6]=t=>e.passwordData.current_password=t),label:"Current Password",type:"password",outlined:"",dense:"",rules:[e.rules.required],"prepend-inner-icon":"mdi-lock",color:"purple"},null,8,["modelValue","rules"])]),_:1}),a(m,{cols:"12",md:"12"},{default:r(()=>[a(u,{modelValue:e.passwordData.new_password,"onUpdate:modelValue":o[7]||(o[7]=t=>e.passwordData.new_password=t),label:"New Password",type:"password",outlined:"",dense:"",rules:[e.rules.required,e.rules.passwordStrength],"prepend-inner-icon":"mdi-lock",color:"purple"},null,8,["modelValue","rules"])]),_:1}),a(m,{cols:"12",md:"12"},{default:r(()=>[a(u,{modelValue:e.passwordData.confirm_password,"onUpdate:modelValue":o[8]||(o[8]=t=>e.passwordData.confirm_password=t),label:"Confirm Password",type:"password",outlined:"",dense:"",rules:[e.rules.required,e.rules.passwordMatch],"prepend-inner-icon":"mdi-lock",color:"purple"},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(F,{class:"mt-4 d-flex justify-end"},{default:r(()=>[a(U,{color:"purple",type:"submit",variant:"elevated",loading:e.passwordLoading,disabled:e.passwordLoading,class:"font-weight-bold"},{default:r(()=>o[15]||(o[15]=[b(" Update Password ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1}),a(x,{class:"mt-10"},{default:r(()=>[a(A,{class:"details-card pa-4 rounded-lg shadow-lg",style:{margin:"0 auto","background-color":"#f9f9f9"}},{default:r(()=>[a(L,{class:"d-flex justify-space-between align-center"},{default:r(()=>o[16]||(o[16]=[f("span",{class:"text-h6 font-weight-bold"},"Deactivate Account",-1)])),_:1}),a(I,{class:"my-3"}),a(j,{ref:"deactivateForm",onSubmit:o[11]||(o[11]=N(t=>e.verificationCode?e.handleDeactivate():e.sendVerificationCode(),["prevent"]))},{default:r(()=>[a(z,{type:"",outlined:"",border:"start",class:"rounded-lg mb-6"},{default:r(()=>o[17]||(o[17]=[f("div",null,[f("h4",{class:"text-gray-900 fw-bold"},"You Are Deactivating Your Account"),f("p",{class:"text-gray-700"}," For extra security, we will send a verification code to your email. Please input the code below to confirm your account deactivation. ")],-1)])),_:1}),e.verificationCode?(P(),C("div",ve,[a(u,{modelValue:e.verificationCodeInput,"onUpdate:modelValue":o[10]||(o[10]=t=>e.verificationCodeInput=t),label:"Verification Code",variant:"outlined",rules:[e.rules.required],color:"primary",class:"mb-1"},null,8,["modelValue","rules"]),a(F,{class:"d-flex justify-end py-6 px-9"},{default:r(()=>[a(U,{color:"red",type:"submit",loading:e.deactivateLoading,disabled:e.deactivateLoading||!e.verificationCodeInput,class:"fw-semibold"},{default:r(()=>o[19]||(o[19]=[b(" Confirm and Deactivate ")])),_:1},8,["loading","disabled"])]),_:1})])):(P(),C("div",pe,[a(de,{modelValue:e.confirmDeactivation,"onUpdate:modelValue":o[9]||(o[9]=t=>e.confirmDeactivation=t),label:"I confirm my account deactivation",rules:[e.rules.deactivate],class:"mb-1"},null,8,["modelValue","rules"]),a(F,{class:"d-flex justify-end py-4 px-9"},{default:r(()=>[a(U,{size:"large",variant:"elevated",color:"red",type:"submit",loading:e.deactivateLoading,disabled:e.deactivateLoading||!e.confirmDeactivation,class:"fw-semibold"},{default:r(()=>o[18]||(o[18]=[b(" Deactivate Account ")])),_:1},8,["loading","disabled"])]),_:1})]))]),_:1},512)]),_:1})]),_:1})]),_:1}),e.countdownActive?(P(),C("div",we,[f("div",ge,[f("h1",ye,"Logging out in "+S(e.countdown)+" seconds...",1),a(re,{value:e.countdown/3*100,size:"100",width:"10",color:"white"},null,8,["value"])])])):Y("",!0)],64)}const De=ae(fe,[["render",Ve],["__scopeId","data-v-fa04ef3b"]]);export{De as default};

import{r as e,f as a,w as l,S as o,v as r,O as t,C as s,E as i,H as d,D as n,F as u,L as c,G as f,J as p}from"./vendor-DWrK2g1_.js";import{b as m,u as v}from"./app-B9jtdv3Q.js";import{_ as w,x as y,m as g,a as _,b as h,V as b,y as V,p as D,u as C,F as P,e as x,k as F,M as U,E,A as q,j,h as k,G as L}from"./main-DhXQbgH3.js";const I={key:0,class:"mt-4"},S={key:0},A={key:1},M={key:0,class:"custom-overlay"},N={class:"overlay-content text-center"},Y={class:"text-white mb-4"};const z=w({setup(){const r=m(),t=e(null),s=e(null),i=e(!1),d=e(!1),n=e(!1),u=e(""),c=e(""),f=e(null),p=e(!1),w=e(!1),y=e(!1);e(!1);const g=e(""),h=e(3),b=e(!1),V=a({first_name:"",last_name:"",middle_name:"",phone:"",email:""}),D=a({current_password:"",new_password:"",confirm_password:""}),C={deactivate:e=>!!e||"You must confirm your account deactivation",required:e=>!!e||"This field is required",email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||"Invalid email format",phone:e=>/^\d{10}$/.test(e.replace(/\D/g,""))||"Invalid phone number format (10 digits required)",passwordStrength:e=>e.length>=8||"Password must be at least 8 characters",passwordMatch:e=>e===D.new_password||"Passwords do not match"},P=()=>{console.log("Countdown started"),b.value=!0;const e=setInterval((()=>{console.log("Countdown:",h.value),h.value-=1,0===h.value&&(clearInterval(e),x(),F())}),1e3)},x=()=>{h.value=3,b.value=!1},F=()=>{v().logoutWithoutConfirmation()},U=async()=>{try{await _.post("/api/send-deactivation-email")}catch(e){console.error("Error sending deactivation email:",e)}};return l(n,(e=>{console.log("isVerifying changed:",e)})),l(V,(async(e,a)=>{if(console.log("formData changed:",{oldValue:a,newValue:e}),t.value){const e=await t.value.validate();console.log("Validation status after formData change:",e)}else console.error("Form reference is not available.")})),l(c,(e=>{e&&r.info("Please enter the verification code sent to your email.")})),o((async()=>{try{i.value=!0;const e=await _.get("/user-data",{params:{personal_info:!0}});Object.assign(V,e.data.personal_info||{}),u.value=V.email}catch(e){r.error("Failed to load profile")}finally{i.value=!1}})),{handleDeactivate:async()=>{var e,a;try{w.value=!0;if(200!==(await _.post("/api/deactivate-account",{code:g.value})).status)throw new Error("Account deactivation failed.");r.success("Your account has been successfully deactivated."),U(),P()}catch(l){console.error("Error deactivating account:",l),r.error((null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.message)||"Failed to deactivate account.")}finally{w.value=!1}},sendVerificationCode:async()=>{try{w.value=!0;if(200!==(await _.post("/api/send-deactivation-code")).status)throw new Error("Failed to send verification code.");c.value=!0}catch(e){console.error("Error sending verification code:",e),r.error("Unable to send verification code. Please try again later.")}finally{w.value=!1}},deactivateForm:f,verificationCodeInput:g,confirmDeactivation:y,deactivateLoading:w,form:t,sendingCode:p,countdownActive:b,countdown:h,passwordForm:s,formData:V,passwordData:D,loading:i,startCountdown:P,passwordLoading:d,isVerifying:n,verificationCode:c,rules:C,handleSubmit:async()=>{var e,a;if(!t.value)return void r.error("Form not found");const{valid:l}=await t.value.validate();if(!l)return void r.error("Please fill all required fields correctly");const o=V.email!==u.value;if(!o||n.value)if(!o||c.value)try{i.value=!0;const e={...V,verificationCode:o?c.value:null};if(200!==(await _.post("/api/profile/update",e)).status)throw new Error("Profile update failed");r.success("Profile updated successfully"),o&&(n.value=!1,c.value="",u.value=V.email)}catch(s){console.error("Error updating profile:",s),r.error((null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.message)||"Failed to update profile")}finally{i.value=!1}else r.error("Please enter the verification code");else{console.log("Email has changed and not verifying yet.");try{i.value=!0;if(200!==(await _.post("/api/send-verification",{email:V.email})).status)throw new Error("Failed to send verification code");n.value=!0,r.info("Verification code sent to your email")}catch(s){console.error("Error sending verification email:",s),r.error("Failed to send verification code")}finally{i.value=!1}}},handlePasswordUpdate:async()=>{var e,a;if(!s.value)return void r.error("Form reference is not found.");const{valid:l}=await s.value.validate();if(l)try{d.value=!0;if(200!==(await _.post("/api/update-password",{current_password:D.current_password,new_password:D.new_password,new_password_confirmation:D.confirm_password})).status)throw new Error("Password update failed");r.success("Password updated successfully!"),Object.assign(D,{current_password:"",new_password:"",confirm_password:""}),s.value.reset()}catch(o){console.error("Error updating password:",o),r.error((null==(a=null==(e=o.response)?void 0:e.data)?void 0:a.message)||"Failed to update password.")}finally{d.value=!1}else r.error("Please fill all required fields correctly.")}}}},[["render",function(e,a,l,o,m,v){return c(),r(u,null,[t(y,null,{default:s((()=>[t(h,null,{default:s((()=>[t(b,{class:"details-card pa-4 rounded-lg shadow-lg",style:{margin:"0 auto","background-color":"#f9f9f9"}},{default:s((()=>[t(V,{class:"d-flex justify-space-between align-center"},{default:s((()=>[a[13]||(a[13]=i("span",{class:"text-h6 font-weight-bold"},"My Profile",-1)),t(D,{color:"success",size:"small",variant:"tonal","prepend-icon":"mdi-check-circle"},{default:s((()=>a[12]||(a[12]=[f(" Verified Account ")]))),_:1})])),_:1}),t(C,{class:"my-3"}),t(P,{ref:"form",onSubmit:p(o.handleSubmit,["prevent"])},{default:s((()=>[t(h,{class:"mt-4"},{default:s((()=>[t(x,{cols:"12",md:"6"},{default:s((()=>[t(F,{modelValue:o.formData.first_name,"onUpdate:modelValue":a[0]||(a[0]=e=>o.formData.first_name=e),label:"First Name",outlined:"",dense:"",readonly:o.isVerifying,"prepend-inner-icon":"mdi-account",rules:[o.rules.required],color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly","rules"])])),_:1}),t(x,{cols:"12",md:"6"},{default:s((()=>[t(F,{modelValue:o.formData.last_name,"onUpdate:modelValue":a[1]||(a[1]=e=>o.formData.last_name=e),label:"Last Name",outlined:"",dense:"",readonly:o.isVerifying,"prepend-inner-icon":"mdi-account",rules:[o.rules.required],color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly","rules"])])),_:1}),t(x,{cols:"12",md:"6"},{default:s((()=>[t(F,{modelValue:o.formData.middle_name,"onUpdate:modelValue":a[2]||(a[2]=e=>o.formData.middle_name=e),label:"Middle Name",outlined:"",dense:"",readonly:o.isVerifying,"prepend-inner-icon":"mdi-account",color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly"])])),_:1}),t(x,{cols:"12",md:"6"},{default:s((()=>[t(F,{modelValue:o.formData.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>o.formData.phone=e),label:"Phone",outlined:"",dense:"",readonly:o.isVerifying,"prepend-inner-icon":"mdi-phone",rules:[o.rules.required,o.rules.phone],color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly","rules"])])),_:1}),t(x,{cols:"12"},{default:s((()=>[t(F,{modelValue:o.formData.email,"onUpdate:modelValue":a[4]||(a[4]=e=>o.formData.email=e),label:"Email",outlined:"",dense:"",readonly:o.isVerifying,"prepend-inner-icon":"mdi-email",rules:[o.rules.required,o.rules.email],color:"purple",class:"custom-purple-input"},null,8,["modelValue","readonly","rules"])])),_:1})])),_:1}),t(U,null,{default:s((()=>[o.isVerifying?(c(),r("div",I,[t(E,{color:"success",variant:"tonal",border:"start"},{default:s((()=>[f(" Please enter the verification code sent to "+d(e.originalEmail),1)])),_:1}),t(F,{modelValue:o.verificationCode,"onUpdate:modelValue":a[5]||(a[5]=e=>o.verificationCode=e),label:"Verification Code",variant:"outlined",class:"mt-4 custom-purple-input",rules:[o.rules.required]},null,8,["modelValue","rules"])])):n("",!0)])),_:1}),t(q,{class:"mt-4"},{default:s((()=>[t(j),t(k,{color:"purple",type:"submit",variant:"elevated",loading:o.loading,disabled:o.loading},{default:s((()=>[f(d(o.isVerifying?"Verify & Update":"Update Profile"),1)])),_:1},8,["loading","disabled"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1}),t(h,{class:"mt-10"},{default:s((()=>[t(b,{class:"details-card pa-4 rounded-lg shadow-lg",style:{margin:"0 auto","background-color":"#f9f9f9"}},{default:s((()=>[t(V,{class:"d-flex justify-space-between align-center"},{default:s((()=>a[14]||(a[14]=[i("span",{class:"text-h6 font-weight-bold"},"Update Password",-1)]))),_:1}),t(C,{class:"my-3"}),t(P,{ref:"passwordForm",onSubmit:p(o.handlePasswordUpdate,["prevent"])},{default:s((()=>[t(h,{class:"mt-4"},{default:s((()=>[t(x,{cols:"12",md:"12"},{default:s((()=>[t(F,{modelValue:o.passwordData.current_password,"onUpdate:modelValue":a[6]||(a[6]=e=>o.passwordData.current_password=e),label:"Current Password",type:"password",outlined:"",dense:"",rules:[o.rules.required],"prepend-inner-icon":"mdi-lock",color:"purple"},null,8,["modelValue","rules"])])),_:1}),t(x,{cols:"12",md:"12"},{default:s((()=>[t(F,{modelValue:o.passwordData.new_password,"onUpdate:modelValue":a[7]||(a[7]=e=>o.passwordData.new_password=e),label:"New Password",type:"password",outlined:"",dense:"",rules:[o.rules.required,o.rules.passwordStrength],"prepend-inner-icon":"mdi-lock",color:"purple"},null,8,["modelValue","rules"])])),_:1}),t(x,{cols:"12",md:"12"},{default:s((()=>[t(F,{modelValue:o.passwordData.confirm_password,"onUpdate:modelValue":a[8]||(a[8]=e=>o.passwordData.confirm_password=e),label:"Confirm Password",type:"password",outlined:"",dense:"",rules:[o.rules.required,o.rules.passwordMatch],"prepend-inner-icon":"mdi-lock",color:"purple"},null,8,["modelValue","rules"])])),_:1})])),_:1}),t(q,{class:"mt-4 d-flex justify-end"},{default:s((()=>[t(k,{color:"purple",type:"submit",variant:"elevated",loading:o.passwordLoading,disabled:o.passwordLoading,class:"font-weight-bold"},{default:s((()=>a[15]||(a[15]=[f(" Update Password ")]))),_:1},8,["loading","disabled"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1}),t(h,{class:"mt-10"},{default:s((()=>[t(b,{class:"details-card pa-4 rounded-lg shadow-lg",style:{margin:"0 auto","background-color":"#f9f9f9"}},{default:s((()=>[t(V,{class:"d-flex justify-space-between align-center"},{default:s((()=>a[16]||(a[16]=[i("span",{class:"text-h6 font-weight-bold"},"Deactivate Account",-1)]))),_:1}),t(C,{class:"my-3"}),t(P,{ref:"deactivateForm",onSubmit:a[11]||(a[11]=p((e=>o.verificationCode?o.handleDeactivate():o.sendVerificationCode()),["prevent"]))},{default:s((()=>[t(E,{type:"",outlined:"",border:"start",class:"rounded-lg mb-6"},{default:s((()=>a[17]||(a[17]=[i("div",null,[i("h4",{class:"text-gray-900 fw-bold"},"You Are Deactivating Your Account"),i("p",{class:"text-gray-700"}," For extra security, we will send a verification code to your email. Please input the code below to confirm your account deactivation. ")],-1)]))),_:1}),o.verificationCode?(c(),r("div",A,[t(F,{modelValue:o.verificationCodeInput,"onUpdate:modelValue":a[10]||(a[10]=e=>o.verificationCodeInput=e),label:"Verification Code",variant:"outlined",rules:[o.rules.required],color:"primary",class:"mb-1"},null,8,["modelValue","rules"]),t(q,{class:"d-flex justify-end py-6 px-9"},{default:s((()=>[t(k,{color:"red",type:"submit",loading:o.deactivateLoading,disabled:o.deactivateLoading||!o.verificationCodeInput,class:"fw-semibold"},{default:s((()=>a[19]||(a[19]=[f(" Confirm and Deactivate ")]))),_:1},8,["loading","disabled"])])),_:1})])):(c(),r("div",S,[t(L,{modelValue:o.confirmDeactivation,"onUpdate:modelValue":a[9]||(a[9]=e=>o.confirmDeactivation=e),label:"I confirm my account deactivation",rules:[o.rules.deactivate],class:"mb-1"},null,8,["modelValue","rules"]),t(q,{class:"d-flex justify-end py-4 px-9"},{default:s((()=>[t(k,{size:"large",variant:"elevated",color:"red",type:"submit",loading:o.deactivateLoading,disabled:o.deactivateLoading||!o.confirmDeactivation,class:"fw-semibold"},{default:s((()=>a[18]||(a[18]=[f(" Deactivate Account ")]))),_:1},8,["loading","disabled"])])),_:1})]))])),_:1},512)])),_:1})])),_:1})])),_:1}),o.countdownActive?(c(),r("div",M,[i("div",N,[i("h1",Y,"Logging out in "+d(o.countdown)+" seconds...",1),t(g,{value:o.countdown/3*100,size:"100",width:"10",color:"white"},null,8,["value"])])])):n("",!0)],64)}],["__scopeId","data-v-fa04ef3b"]]);export{z as default};

import{b as S,u as _,s as I,e as g}from"./app-DZGKe3Aq.js";import{u as U}from"./useNotifications-BoI3aIEX.js";import{_ as R,v as A,O as i,C as n,al as N,ap as T,F as D,L as f,Z as F,am as C,G as m,H as u,an as y,E as d,a3 as h,D as v,z as M,aR as L,ab as O,aW as q,ao as E,a5 as B,av as z,y as k,aw as P,K as J,a0 as p,a6 as b,$ as V,J as j,a2 as G,ax as Y}from"./main-DHxkGDom.js";const H={setup(){const t=S(),e=_(),{user:a}=I(e);return{authStore:e,user:a,toast:t}},data(){const{unreadCount:t,refresh:e}=U();return{refreshNotifications:e,isTableLoading:!1,isFormValid:!1,errorMessage:"",originalMembers:[],editableMembers:[],originalNewMember:{firstName:"",lastName:"",email:"",percentage:0,amount:0},accountGoal:"",totalAmount:0,team:{name:"Development Team"},team:{},teamMembers:[],isSubmitting:!1,tableHeaders:[{text:"SN",value:"index",align:"center",width:"50px"},{text:"Name",value:"name"},{text:"Email",value:"email"},{text:"Role",value:"role"},{text:"Status",value:"status"},{text:"Percentage",value:"percentage"},{text:"Amount",value:"amount"},{text:"Actions",value:"actions",sortable:!1}],currentMode:null,editableMembers:this.teamMembers,rules:{required:a=>a==null||a===""?"This field is required.":!0,email:a=>a?/.+@.+\..+/.test(a)||"Enter a valid email address.":!0,positiveNumber:a=>{if(!a)return!0;const l=String(a).replace(/[^0-9.]/g,"");return l===""?"The amount must be a positive number.":parseFloat(l)>0||"The amount must be a positive number."},positivePercentage:a=>{if(a==null||a==="")return"This field is required.";const l=parseFloat(a);return isNaN(l)?"Please enter a valid number":l>=1&&l<=100||"Percentage must be between 1 and 100."}},showEditAmountsModal:!1,showModal:!1,showAdminLeaveModal:!1,editMode:!1,newAdminUuid:null,newMemberForm:{firstName:"",lastName:"",email:"",percentage:0,amount:0},modalForm:{uuid:null,firstName:"",lastName:"",email:"",role:"member",status:"pending",amount:0},showResendConfirmDialog:!1,selectedMember:null,showDissolveModal:!1,verificationCode:"",dissolveConfirmed:!1,isPromoting:!1,isDissolving:!1,adminSelectError:"",codeError:"",checkboxError:""}},computed:{isCurrentUserAdmin(){var e;const t=(e=this.user)==null?void 0:e.id;return!t||!this.teamAdmin?!1:this.teamAdmin.user_id===t},sortedTeamMembers(){return[...this.teamMembers].sort((t,e)=>t.role==="admin"&&e.role!=="admin"?-1:t.role!=="admin"&&e.role==="admin"?1:t.status==="accepted"&&e.status!=="accepted"?-1:t.status!=="accepted"&&e.status==="accepted"?1:0)},teamAdmin(){return this.teamMembers.find(t=>t.role==="admin")},activeMembers(){return this.teamMembers.filter(t=>t.status==="accepted")},acceptedMembers(){return this.teamMembers.filter(t=>t.status==="accepted")},remainingBalance(){return this.totalAmount-this.totalAssigned},remainingBalance(){return this.totalAmount-this.totalAssigned},totalAssignedAmount(){return this.activeMembers.reduce((t,e)=>t+e.amount,0)},totalAssigned(){if(this.showEditAmountsModal){let t=this.editableMembers.reduce((e,a)=>e+(a.amount||0),0);return this.currentMode==="add"&&this.newMemberForm.amount&&(t+=this.newMemberForm.amount),t}return this.acceptedMembers.reduce((t,e)=>t+(e.amount||0),0)},totalAssignedPercentage(){if(this.showEditAmountsModal){let t=this.editableMembers.reduce((e,a)=>e+(a.percentage||0),0);return this.currentMode==="add"&&this.newMemberForm.percentage&&(t+=this.newMemberForm.percentage),t}return this.totalAssigned/this.totalAmount*100},remainingBalance(){return this.totalAmount-this.totalAssigned},remainingBalancePercentage(){return this.showEditAmountsModal?100-this.totalAssignedPercentage:this.remainingBalance/this.totalAmount*100},promotableMembers(){return this.teamMembers.filter(t=>t.status==="accepted"&&t.role==="member").map(t=>({uuid:t.uuid,title:t.name,subtitle:t.email}))},isFormValid(){return this.newMemberForm.firstName&&this.newMemberForm.lastName&&this.newMemberForm.email&&this.newMemberForm.percentage>0},calculatedNewMemberAmount(){return console.log(this.newMemberForm),this.newMemberForm.amount?(console.log(this.newMemberForm.amount),this.newMemberForm.amount):"0.00"}},methods:{updateAmountFromPercentage(t){const e=t===this.newMemberForm;(typeof t.percentage!="number"||isNaN(t.percentage))&&(t.percentage=0);const a=parseFloat(t.percentage)||0,l=a/100*this.totalAmount;e?(this.newMemberForm.percentage=a,this.newMemberForm.amount=parseFloat(l.toFixed(2))):t.amount=parseFloat(l.toFixed(2))},async validateForm(){const t=this.$refs.addMemberForm;return this.errorMessage="",t?await t.validate():!1},async submitChangesOld(){var t,e;if(!this.isCurrentUserAdmin){this.toast.error("Only team admin can perform this action");return}if(!(this.currentMode==="add"&&!(await this.validateForm()).valid)){if(!this.validatePercentageTotal()){this.toast.error("Total percentage must equal 100%");return}try{this.isSubmitting=!0,this.currentMode==="add"?await this.addNewMember():this.currentMode==="remove"?await this.removeMember(this.selectedMember):await this.adjustPercentages(),await this.fetchTeamData(),this.closeEditAmountsModal(),this.isSubmitting=!1}catch(a){this.isSubmitting=!1,this.teamMembers=JSON.parse(JSON.stringify(this.originalMembers)),this.toast.error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Error saving changes")}}},async submitChanges(){var t,e;if(!this.isCurrentUserAdmin){this.toast.error("Only team admin can perform this action");return}if(!(this.currentMode==="add"&&!(await this.validateForm()).valid)){if(!this.validatePercentageTotal()){this.toast.error("Total percentage must equal 100%");return}try{this.isSubmitting=!0;let a=!1;if(this.currentMode==="add"?a=await this.addNewMember():this.currentMode==="remove"?a=await this.removeMember():a=await this.adjustPercentages(),a)await this.refreshNotifications(),this.isSubmitting=!1;else throw new Error("Operation failed")}catch(a){this.toast.error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Error saving changes")}finally{this.isSubmitting=!1}}},async fetchTeamDataOld(){try{const t=await g.get("/api/team/members");t.data.team&&(this.team=t.data.team,this.accountGoal=t.data.totalAmount.user.account_goal,this.totalAmount=parseFloat(t.data.totalAmount.amount||0),this.teamMembers=t.data.team.team_members.map(e=>({...e,percentage:parseFloat(e.percentage||0),amount:this.calculateMemberAmount(parseFloat(e.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:null})))}catch(t){this.toast.error("Error fetching team data"),console.error("Error:",t)}},async fetchTeamData2(){var t,e;try{this.isTableLoading=!0;const a=await g.get("/api/team/members");return a.data.team?(this.team=a.data.team,this.accountGoal=a.data.totalAmount.user.account_goal,this.totalAmount=parseFloat(a.data.totalAmount.amount||0),this.teamMembers=a.data.team.team_members.map(l=>({...l,percentage:parseFloat(l.percentage||0),amount:this.calculateMemberAmount(parseFloat(l.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:l.last_invite_sent_at?new Date(l.last_invite_sent_at).getTime()+5*60*60*1e3:null})),this.teamMembers.sort((l,r)=>l.role==="admin"?-1:r.role==="admin"?1:l.status==="accepted"&&r.status!=="accepted"?-1:l.status!=="accepted"&&r.status==="accepted"?1:0),await this.refreshNotifications(),!0):!1}catch(a){return this.toast.error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Error fetching team data"),console.error("Error:",a),!1}finally{this.isTableLoading=!1}},async fetchTeamData(){var t,e,a,l,r;try{this.isTableLoading=!0;const o=await g.get("/api/team/members");return o.data.team?(this.team=o.data.team,o.data.totalAmount?(this.accountGoal=((e=(t=o.data.totalAmount)==null?void 0:t.user)==null?void 0:e.account_goal)||"",this.totalAmount=parseFloat(((a=o.data.totalAmount)==null?void 0:a.amount)||0),this.team.address_id?(this.teamMembers=o.data.team.team_members.map(s=>({...s,percentage:parseFloat(s.percentage||0),amount:this.calculateMemberAmount(parseFloat(s.percentage||0),this.totalAmount||0),isResending:!1,nextInviteTime:s.last_invite_sent_at?new Date(s.last_invite_sent_at).getTime()+5*60*60*1e3:null})),this.teamMembers.sort((s,c)=>s.role==="admin"?-1:c.role==="admin"?1:s.status==="accepted"&&c.status!=="accepted"?-1:s.status!=="accepted"&&c.status==="accepted"?1:0),await this.refreshNotifications(),!0):(this.toast.warning("Please add address details to manage team contributions"),this.teamMembers=[],!1)):(this.toast.warning("Please add address details to manage team contributions"),this.accountGoal="",this.totalAmount=0,this.teamMembers=[],!1)):(this.toast.warning("No team data found"),!1)}catch(o){return this.toast.error(((r=(l=o.response)==null?void 0:l.data)==null?void 0:r.message)||"Error fetching team data"),console.error("Error:",o),!1}finally{this.isTableLoading=!1}},async addNewMember(){var t,e;try{const a=this.editableMembers.map(r=>({uuid:r.uuid,percentage:r.percentage,amount:r.amount})),l=await g.post("/api/team/members",{name:`${this.newMemberForm.firstName} ${this.newMemberForm.lastName}`,email:this.newMemberForm.email,percentage:this.newMemberForm.percentage,amount:this.newMemberForm.amount,members_percentages:a});if(l.data.status==="success"){if(this.toast.success(l.data.message||"New member added successfully"),this.closeEditAmountsModal(),l.data.team){this.team=l.data.team;const r=l.data.team.team_members.map(o=>({...o,percentage:parseFloat(o.percentage||0),amount:this.calculateMemberAmount(parseFloat(o.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:null}));this.teamMembers=[...r]}return!0}else throw new Error(l.data.message||"Failed to add member")}catch(a){const l=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message||"Error adding new member";return this.toast.error(l),console.error("Add member error:",a),!1}},async removeMember(){var t,e;try{if(!this.selectedMember){this.toast.error("No member selected for removal");return}const a=this.editableMembers.map(r=>({uuid:r.uuid,percentage:r.percentage,amount:r.amount})),l=await g.delete("/api/team/members",{data:{member_uuid:this.selectedMember.uuid,members_percentages:a}});if(l.data.status==="success"){if(this.toast.success(`${this.selectedMember.name} has been removed from the team`),this.closeEditAmountsModal(),l.data.team){this.team=l.data.team;const r=l.data.team.team_members.map(o=>({...o,percentage:parseFloat(o.percentage||0),amount:this.calculateMemberAmount(parseFloat(o.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:null}));this.teamMembers=[...r]}return!0}else throw new Error(l.data.message||"Failed to remove member")}catch(a){console.error("Remove member error:",a),this.toast.error(((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Error removing member from team")}},async adjustPercentages(){try{const t=this.editableMembers.map(a=>({uuid:a.uuid,percentage:a.percentage,amount:a.amount})),e=await g.put("/api/team/members/percentages",{members_percentages:t});if(e.data.status==="success"&&e.data.team){this.team=e.data.team;const a=e.data.team.team_members.map(l=>({...l,percentage:parseFloat(l.percentage||0),amount:this.calculateMemberAmount(parseFloat(l.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:null}));return this.teamMembers=[...a],this.toast.success(e.data.message||"Percentages updated successfully"),!0}return!1}catch(t){return t.response?this.toast.error(t.response.data.message||"Error updating percentages"):this.toast.error("Network error occurred"),console.error("Adjust percentages error:",t),!1}},formatToCAD(t){return new Intl.NumberFormat("en-CA",{style:"currency",currency:"CAD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},calculateMemberAmount(t,e){if(!t||!e)return 0;const a=t/100*e;return parseFloat(a.toFixed(2))},getStatusColor(t){switch(t){case"accepted":return"success";case"pending":return"warning";case"declined":return"error";default:return"grey"}},capitalizeFirst(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""},getResendButtonText(t){return t.nextInviteTime&&new Date<new Date(t.nextInviteTime)?`Wait ${this.getTimeLeft(t.nextInviteTime)}`:"Resend Invite"},getTimeLeft(t){const e=new Date(t)-new Date,a=Math.floor(e/(1e3*60*60)),l=Math.floor(e%(1e3*60*60)/(1e3*60));return`${a}h ${l}m`},confirmResendInvite(t){if(!this.isCurrentUserAdmin){this.toast.error("Only team admin can perform this action");return}this.selectedMember=t,this.showResendConfirmDialog=!0},async resendInvite(){if(!this.isCurrentUserAdmin){this.toast.error("Only team admin can perform this action");return}if(this.selectedMember)try{this.selectedMember.isResending=!0,await g.post("/api/team/members/resend-invite",{member_uuid:this.selectedMember.uuid}),this.selectedMember.nextInviteTime=new Date(Date.now()+5*60*60*1e3).toISOString(),this.toast.success(`Invite resent to ${this.selectedMember.email}`)}catch(t){this.toast.error("Error resending invite"),console.error("Error:",t)}finally{this.selectedMember.isResending=!1,this.showResendConfirmDialog=!1,this.selectedMember=null}},openModal(t,e=null){if(!this.isCurrentUserAdmin){this.toast.error("Only team admin can perform this action");return}this.currentMode=t,this.originalMembers=JSON.parse(JSON.stringify(this.teamMembers)),t==="add"?(this.newMemberForm={...this.originalNewMember},this.editableMembers=JSON.parse(JSON.stringify(this.teamMembers))):t==="remove"?(this.editableMembers=this.teamMembers.filter(a=>a.uuid!==e.uuid).map(a=>({...a})),this.selectedMember={...e}):this.editableMembers=JSON.parse(JSON.stringify(this.teamMembers)),this.showEditAmountsModal=!0},validatePercentageTotal(){var e;let t=this.editableMembers.reduce((a,l)=>{const r=parseFloat(l==null?void 0:l.percentage)||0;return a+r},0);if(this.currentMode==="add"){const a=parseFloat((e=this.newMemberForm)==null?void 0:e.percentage)||0;t+=a}return Math.abs(t-100)<.01},async addNewMemberOld(){const t=this.editableMembers.map(e=>({uuid:e.uuid,percentage:e.percentage,amount:e.amount}));await g.post("/api/team/members",{name:`${this.newMemberForm.firstName} ${this.newMemberForm.lastName}`,email:this.newMemberForm.email,percentage:this.newMemberForm.percentage,amount:this.newMemberForm.amount,members_percentages:t})},sendInvite(){const t=this.editableMembers.find(e=>e.email===this.newMemberForm.email);this.teamMembers.push(t),this.toast.success(`Invite sent to ${t.email}`)},updateContributions(){this.teamMembers=[...this.editableMembers],this.toast.success("Contributions updated successfully.")},sanitizeInput(t){const e=this.modalForm[t];if(e==null||e===""){this.modalForm[t]="";return}this.modalForm[t]=String(e).replace(/[^0-9.]/g,"")},sanitizeAmount(t){(typeof t.amount!="number"||isNaN(t.amount))&&(t.amount=0)},sanitizePercentage(t){t.percentage<0?t.percentage=0:t.percentage>100&&(t.percentage=100)},async editMember(t){this.showModal=!0,this.editMode=!0,this.modalForm={...t}},openAddMemberModal(){this.showModal=!0,this.editMode=!1,this.modalForm={uuid:null,firstName:"",lastName:"",email:"",role:"member",status:"pending",amount:0}},closeModal(){this.showModal=!1,this.$refs.form.reset()},closeEditAmountsModal(){this.showEditAmountsModal=!1,this.teamMembers=JSON.parse(JSON.stringify(this.originalMembers)),this.newMemberForm={...this.originalNewMember},this.currentMode=null,this.editableMembers=[]},validateAmountDistribution(){const t=this.totalAssignedAmount;t!==this.totalAmount&&this.toast.warning(`Total assigned amount (${t}) does not match the rent/mortgage amount (${this.totalAmount}). Please adjust!`)},openAdminLeaveModal(){if(!this.isCurrentUserAdmin){this.toast.error("Only team admin can perform this action");return}this.showAdminLeaveModal=!0},closeAdminLeaveModal(){this.showAdminLeaveModal=!1,this.newAdminUuid=null},async promoteNewAdmin(){if(!this.newAdminUuid){this.adminSelectError="Please select a new admin";return}try{this.isPromoting=!0;const t=await g.post("/api/team/admin/transfer",{new_admin_uuid:this.newAdminUuid});t.data.success&&(await this.fetchTeamData(),this.toast.success(t.data.message),this.closeAdminLeaveModal())}catch(t){this.handleError(t)}finally{this.isPromoting=!1}},showDissolveConfirmation(){this.showDissolveModal=!0,g.post("/api/team/dissolve/code")},handleError(t){var e,a,l,r,o,s,c,w;(l=(a=(e=t.response)==null?void 0:e.data)==null?void 0:a.errors)!=null&&l.new_admin_uuid?this.adminSelectError=t.response.data.errors.new_admin_uuid[0]:(s=(o=(r=t.response)==null?void 0:r.data)==null?void 0:o.errors)!=null&&s.verification_code?this.codeError=t.response.data.errors.verification_code[0]:this.toast.error(((w=(c=t.response)==null?void 0:c.data)==null?void 0:w.message)||"An error occurred")},closeDissolveModal(){this.showDissolveModal=!1,this.verificationCode="",this.dissolveConfirmed=!1,this.codeError="",this.checkboxError=""},async confirmDissolveTeam(){if(!this.dissolveConfirmed){this.checkboxError="You must confirm this action";return}if(!this.verificationCode){this.codeError="Verification code is required";return}try{this.isDissolving=!0;const t=await g.post("/api/team/dissolve",{verification_code:this.verificationCode});t.data.success&&(await this.fetchTeamData(),this.toast.success(t.data.message),this.closeDissolveModal(),this.closeAdminLeaveModal(),this.$router.push("/dashboard"))}catch(t){this.handleError(t)}finally{this.isDissolving=!1}},clearAdminError(){this.adminSelectError=""},numericOnly(t){let e=String.fromCharCode(t.keyCode);if(/^[0-9]$/.test(e)&&this.verificationCode.length<6)return!0;t.preventDefault()},clearCodeError(){this.codeError="",this.verificationCode=this.verificationCode.replace(/[^0-9]/g,"").substring(0,6)},clearCheckboxError(){this.checkboxError=""}},mounted(){this.fetchTeamData(),console.log("Promotable Members:",this.promotableMembers)}},K={class:"amount-cell"},W={class:"amount-cell"},Z={key:0,class:"d-flex gap-2"},Q={class:"text-decoration-line-through grey--text"},X={key:1};function $(t,e,a,l,r,o){return f(),A(D,null,[i(N,null,{default:n(()=>[i(F,{class:"mb-4"},{default:n(()=>[i(C,null,{default:n(()=>[m("Team: "+u(o.capitalizeFirst(r.accountGoal)),1)]),_:1}),i(y,null,{default:n(()=>{var s;return[d("p",null,[e[17]||(e[17]=m("Total Amount: ")),d("b",K,u(o.formatToCAD(r.totalAmount.toFixed(2))),1)]),d("p",null,"Admin: "+u(((s=o.teamAdmin)==null?void 0:s.name)||"No Admin Assigned"),1),o.isCurrentUserAdmin?(f(),A(D,{key:0},[i(h,{color:"purple",rounded:"lg",class:"m-2",onClick:e[0]||(e[0]=c=>o.openModal("add"))},{default:n(()=>e[18]||(e[18]=[m("Add New Member")])),_:1}),i(h,{color:"purple",rounded:"lg",class:"m-2",onClick:e[1]||(e[1]=c=>o.openModal("adjust"))},{default:n(()=>e[19]||(e[19]=[m("Adjust Amounts")])),_:1}),i(h,{color:"red",rounded:"lg",class:"m-2",onClick:o.openAdminLeaveModal},{default:n(()=>e[20]||(e[20]=[m("Leave Team")])),_:1},8,["onClick"])],64)):v("",!0)]}),_:1})]),_:1}),(f(),M(q,{headers:r.tableHeaders,loading:r.isTableLoading,"loading-text":"Loading team members...",items:r.teamMembers,"item-value":"uuid",class:"elevation-1",key:r.teamMembers.length},{loading:n(()=>[i(L,{type:"table-row",class:"my-2"})]),"item.index":n(({index:s})=>[m(u(s+1),1)]),"item.role":n(({item:s})=>[m(u(o.capitalizeFirst(s.role)),1)]),"item.status":n(({item:s})=>[i(O,{color:o.getStatusColor(s.status),text:o.capitalizeFirst(s.status),small:""},null,8,["color","text"])]),"item.percentage":n(({item:s})=>[m(u(s.percentage)+"% ",1)]),"item.amount":n(({item:s})=>[d("span",W,u(o.formatToCAD(parseFloat(s.amount).toFixed(2))),1)]),"item.actions":n(({item:s})=>[o.isCurrentUserAdmin?(f(),A("div",Z,[s.status==="pending"?(f(),M(h,{key:0,size:"x-small",color:"primary",loading:s.isResending,disabled:s.nextInviteTime&&new Date<new Date(s.nextInviteTime),onClick:c=>o.confirmResendInvite(s)},{default:n(()=>[m(u(o.getResendButtonText(s)),1)]),_:2},1032,["loading","disabled","onClick"])):v("",!0),i(h,{size:"x-small",color:"error",disabled:s.role==="admin",onClick:c=>o.openModal("remove",s)},{default:n(()=>e[21]||(e[21]=[m(" Remove ")])),_:2},1032,["disabled","onClick"])])):v("",!0)]),_:1},8,["headers","loading","items"])),i(T,{modelValue:r.showResendConfirmDialog,"onUpdate:modelValue":e[3]||(e[3]=s=>r.showResendConfirmDialog=s),"max-width":"400px"},{default:n(()=>[i(F,null,{default:n(()=>[i(C,null,{default:n(()=>e[22]||(e[22]=[m("Confirm Resend Invite")])),_:1}),i(y,null,{default:n(()=>{var s;return[m(" Are you sure you want to resend invite to "+u((s=r.selectedMember)==null?void 0:s.email)+"? ",1)]}),_:1}),i(E,null,{default:n(()=>[i(B),i(h,{color:"primary",onClick:o.resendInvite},{default:n(()=>e[23]||(e[23]=[m("Yes")])),_:1},8,["onClick"]),i(h,{color:"grey",onClick:e[2]||(e[2]=s=>r.showResendConfirmDialog=!1)},{default:n(()=>e[24]||(e[24]=[m("No")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(T,{modelValue:r.showEditAmountsModal,"onUpdate:modelValue":e[11]||(e[11]=s=>r.showEditAmountsModal=s),persistent:"","max-width":"700px"},{default:n(()=>[i(F,null,{default:n(()=>[i(C,null,{default:n(()=>[m(u(r.currentMode==="add"?"Add New Member":r.currentMode==="remove"?"Remove Member":"Adjust Contributions"),1)]),_:1}),i(y,null,{default:n(()=>[r.currentMode==="remove"?(f(),M(z,{key:0,type:"warning",color:"warning",class:"mb-4",variant:"tonal"},{default:n(()=>{var s,c;return[e[25]||(e[25]=m(" Please redistribute ")),d("strong",null,u((s=r.selectedMember)==null?void 0:s.name)+"'s",1),m(" percentage ("+u((c=r.selectedMember)==null?void 0:c.percentage)+"%) among remaining members. Total must equal 100% to proceed. ",1)]}),_:1})):v("",!0),d("div",null,[d("p",null,[e[26]||(e[26]=d("strong",null,"Total Rent/Mortgage:",-1)),m(" $"+u(r.totalAmount.toFixed(2)),1)]),d("p",null,[e[27]||(e[27]=d("strong",null,"Total Assigned:",-1)),m(" $"+u(o.totalAssigned.toFixed(2))+" ("+u(o.totalAssignedPercentage.toFixed(2))+"%) ",1)]),d("p",null,[e[28]||(e[28]=d("strong",null,"Balance:",-1)),d("span",{class:k(o.remainingBalance===0?"text-success":"text-error")}," $"+u(o.remainingBalance.toFixed(2))+" ("+u(o.remainingBalancePercentage.toFixed(2))+"%) ",3)])]),e[29]||(e[29]=d("hr",null,null,-1)),i(P,{ref:"editAmountsForm"},{default:n(()=>[i(N,null,{default:n(()=>[(f(!0),A(D,null,J(r.editableMembers,(s,c)=>(f(),M(V,{key:s.uuid,class:k(["align-center",{"active-member":r.currentMode==="remove"}])},{default:n(()=>[i(p,{cols:"4"},{default:n(()=>[d("p",null,u(s.name),1)]),_:2},1024),i(p,{cols:"4"},{default:n(()=>{var w;return[i(b,{modelValue:s.percentage,"onUpdate:modelValue":x=>s.percentage=x,modelModifiers:{number:!0},label:"Percentage (%)",type:"number",readonly:s.readOnly,onInput:x=>o.updateAmountFromPercentage(s),rules:[r.rules.required,r.rules.positivePercentage],hint:r.currentMode==="remove"?`Previous: ${(w=r.originalMembers.find(x=>x.uuid===s.uuid))==null?void 0:w.percentage}%`:"","persistent-hint":"",required:""},null,8,["modelValue","onUpdate:modelValue","readonly","onInput","rules","hint"])]}),_:2},1024),i(p,{cols:"4"},{default:n(()=>[i(b,{modelValue:s.amount,"onUpdate:modelValue":w=>s.amount=w,modelModifiers:{number:!0},label:"Amount ($)",type:"number",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["class"]))),128)),r.currentMode==="remove"&&r.selectedMember?(f(),M(V,{key:0,class:"align-center removed-member-row"},{default:n(()=>[i(p,{cols:"4"},{default:n(()=>[d("p",Q,u(r.selectedMember.name)+" (Being Removed) ",1)]),_:1}),i(p,{cols:"4"},{default:n(()=>[i(b,{value:r.selectedMember.percentage,label:"Previous Percentage (%)",disabled:"",readonly:"",class:"grey--text"},null,8,["value"])]),_:1}),i(p,{cols:"4"},{default:n(()=>[i(b,{value:r.selectedMember.amount,label:"Previous Amount ($)",disabled:"",readonly:"",class:"grey--text"},null,8,["value"])]),_:1})]),_:1})):v("",!0)]),_:1})]),_:1},512),r.currentMode=="add"?(f(),M(N,{key:1},{default:n(()=>[i(P,{ref:"addMemberForm",onSubmit:j(o.submitChanges,["prevent"]),modelValue:o.isFormValid,"onUpdate:modelValue":e[10]||(e[10]=s=>o.isFormValid=s)},{default:n(()=>[i(N,null,{default:n(()=>[i(V,null,{default:n(()=>[i(p,{cols:"6"},{default:n(()=>[i(b,{modelValue:r.newMemberForm.firstName,"onUpdate:modelValue":e[4]||(e[4]=s=>r.newMemberForm.firstName=s),label:"First Name",rules:[r.rules.required],required:""},null,8,["modelValue","rules"])]),_:1}),i(p,{cols:"6"},{default:n(()=>[i(b,{modelValue:r.newMemberForm.lastName,"onUpdate:modelValue":e[5]||(e[5]=s=>r.newMemberForm.lastName=s),label:"Last Name",rules:[r.rules.required],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),i(V,null,{default:n(()=>[i(p,{cols:"12"},{default:n(()=>[i(b,{modelValue:r.newMemberForm.email,"onUpdate:modelValue":e[6]||(e[6]=s=>r.newMemberForm.email=s),label:"Email",rules:[r.rules.required,r.rules.email],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),i(V,null,{default:n(()=>[i(p,{cols:"6"},{default:n(()=>[i(b,{modelValue:r.newMemberForm.percentage,"onUpdate:modelValue":e[7]||(e[7]=s=>r.newMemberForm.percentage=s),modelModifiers:{number:!0},label:"Percentage (%)",type:"number",min:"1",max:"100",rules:[r.rules.required,r.rules.positivePercentage],onInput:e[8]||(e[8]=s=>o.updateAmountFromPercentage(r.newMemberForm)),required:""},null,8,["modelValue","rules"])]),_:1}),i(p,{cols:"6"},{default:n(()=>[i(b,{modelValue:o.calculatedNewMemberAmount,"onUpdate:modelValue":e[9]||(e[9]=s=>o.calculatedNewMemberAmount=s),label:"Amount ($)",type:"text",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit","modelValue"])]),_:1})):v("",!0)]),_:1}),i(E,null,{default:n(()=>[i(h,{color:"primary",disabled:o.remainingBalance!==0,loading:r.isSubmitting,onClick:o.submitChanges},{default:n(()=>[m(u(r.currentMode==="add"?"Send Invite":r.currentMode==="remove"?"Confirm Removal":"Submit Changes"),1)]),_:1},8,["disabled","loading","onClick"]),i(h,{color:"grey",onClick:o.closeEditAmountsModal,disabled:r.isSubmitting},{default:n(()=>e[30]||(e[30]=[m("Cancel")])),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),i(T,{modelValue:r.showAdminLeaveModal,"onUpdate:modelValue":e[13]||(e[13]=s=>r.showAdminLeaveModal=s),persistent:"","max-width":"500px"},{default:n(()=>[i(F,null,{default:n(()=>[i(C,null,{default:n(()=>e[31]||(e[31]=[m("Admin Leaving Options")])),_:1}),i(y,null,{default:n(()=>[e[32]||(e[32]=d("p",null,"You are about to leave the team. Choose one of the following options:",-1)),r.teamMembers.length>1?(f(),M(G,{key:0,modelValue:r.newAdminUuid,"onUpdate:modelValue":e[12]||(e[12]=s=>r.newAdminUuid=s),items:o.promotableMembers,"item-text":"name","item-value":"uuid",label:"Select New Admin","error-messages":r.adminSelectError,onInput:o.clearAdminError},null,8,["modelValue","items","error-messages","onInput"])):(f(),A("p",X,"There are no other members in this team. You can dissolve the team."))]),_:1}),i(E,null,{default:n(()=>[r.teamMembers.length>1?(f(),M(h,{key:0,color:"primary",onClick:o.promoteNewAdmin,loading:r.isPromoting},{default:n(()=>e[33]||(e[33]=[m(" Promote New Admin ")])),_:1},8,["onClick","loading"])):v("",!0),i(h,{color:"red",onClick:o.showDissolveConfirmation},{default:n(()=>e[34]||(e[34]=[m("Dissolve Team")])),_:1},8,["onClick"]),i(h,{color:"grey",onClick:o.closeAdminLeaveModal},{default:n(()=>e[35]||(e[35]=[m("Cancel")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(T,{modelValue:r.showDissolveModal,"onUpdate:modelValue":e[16]||(e[16]=s=>r.showDissolveModal=s),persistent:"","max-width":"500px"},{default:n(()=>[i(F,null,{default:n(()=>[i(C,null,{default:n(()=>e[36]||(e[36]=[m("Confirm Team Dissolution")])),_:1}),i(y,null,{default:n(()=>[e[37]||(e[37]=d("p",null,"A verification code has been sent to your email.",-1)),i(b,{modelValue:r.verificationCode,"onUpdate:modelValue":e[14]||(e[14]=s=>r.verificationCode=s),label:"Enter Verification Code","error-messages":r.codeError,onInput:o.clearCodeError,maxlength:"6",rules:[s=>!!s||"Code is required",s=>/^[0-9]{6}$/.test(s)||"Code must be 6 digits"],type:"text",onKeypress:o.numericOnly},null,8,["modelValue","error-messages","onInput","rules","onKeypress"]),i(Y,{modelValue:r.dissolveConfirmed,"onUpdate:modelValue":e[15]||(e[15]=s=>r.dissolveConfirmed=s),label:"I understand this action cannot be undone","error-messages":r.checkboxError,onChange:o.clearCheckboxError},null,8,["modelValue","error-messages","onChange"])]),_:1}),i(E,null,{default:n(()=>[i(h,{color:"red",onClick:o.confirmDissolveTeam,loading:r.isDissolving,disabled:!r.dissolveConfirmed||!r.verificationCode},{default:n(()=>e[38]||(e[38]=[m(" Dissolve Team ")])),_:1},8,["onClick","loading","disabled"]),i(h,{color:"grey",onClick:o.closeDissolveModal},{default:n(()=>e[39]||(e[39]=[m("Cancel")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const se=R(H,[["render",$],["__scopeId","data-v-2f317fdc"]]);export{se as default};

import{b as u}from"./app-DZGKe3Aq.js";import{_ as G,R as C,z as b,C as o,al as H,L as k,O as n,a0 as M,E as r,$ as R,Z as y,aX as I,au as U,G as d,a5 as D,a3 as v,a4 as w,an as S,a2 as z,a6 as A,a7 as j,v as p,K as E,a9 as N,y as V,aa as P,H as h,ab as F,ad as B,ae as K,F as _,af as W,A as Z,D as m,aY as J,ao as L,aj as x,av as X,aZ as q,am as O,aw as Y,J as $,ap as Q}from"./main-DHxkGDom.js";const ee={data(){return{showDateFilter:!1,selectedStartDate:null,selectedEndDate:null,showDatePicker:!1,selectedDateRange:null,displayedTickets:[],statusOptions:[{title:"RESOLVED",value:"resolved"},{title:"UNRESOLVED",value:"unresolved"}],showCloseTicketModal:!1,isClosing:!1,closeTicketData:{status:"resolved",reason:"",feedback:"",rating:0},defaultAvatar:"https://via.placeholder.com/40x40.png?text=User",tickets:[],messages:[],user:{id:1},file:null,selectedTicket:null,message:"",newTicket:{subject:"",description:""},selectedStatus:"All",searchQuery:"",showCreateTicketModal:!1,isFormValid:!1,isCreating:!1,isSending:!1,isLoadingTicket:!1,channelSubscriptions:[]}},computed:{isCloseFormValid(){return this.closeTicketData.rating>0&&(this.closeTicketData.status!=="unresolved"||!!this.closeTicketData.reason)},filteredTickets(){const t=this.tickets.filter(e=>{const i=this.selectedStatus==="All"||e.status.toLowerCase()===this.selectedStatus.toLowerCase(),l=e.subject.toLowerCase().includes(this.searchQuery.toLowerCase())||e.description.toLowerCase().includes(this.searchQuery.toLowerCase()),s=!this.selectedDateRange||this.selectedDateRange.length<2||new Date(e.created_at)>=new Date(this.selectedDateRange[0])&&new Date(e.created_at)<=new Date(this.selectedDateRange[1]);return i&&l&&s});return console.log("Filtered Tickets:",t),t},formatDate(t){return new Date(t).toLocaleDateString()},groupedMessages(){return this.messages.reduce((t,e)=>{const i=new Date(e.created_at).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});return t[i]||(t[i]=[]),t[i].push(e),t},{})},canSendMessage(){var t;return(((t=this.message)==null?void 0:t.trim())||this.file)&&!this.isSending}},watch:{showDateFilter(t){console.log("Menu open state:",t)},selectedDateRange(t){console.log("Selected Date Range:",t)},selectedTicket(t,e){(t==null?void 0:t.id)!==(e==null?void 0:e.id)&&(t!=null&&t.uuid)&&this.setupTicketChannels()}},methods:{handleTicketUpdate(t){console.log("Ticket update received:",t),this.selectedTicket&&this.selectedTicket.id===t.id&&(this.selectedTicket.status=t.status,u().info(`Ticket status updated to ${t.status}`));const e=this.tickets.findIndex(i=>i.id===t.id);e!==-1&&(this.tickets[e].status=t.status,this.tickets[e].updated_at=t.updated_at)},handleTicketClosure(t){console.log("Ticket closure received:",t),this.selectedTicket&&this.selectedTicket.id===t.id&&(this.selectedTicket.status=t.status,this.selectedTicket.closure=t.closure,u().info(`Ticket has been marked as ${t.status}`));const e=this.tickets.findIndex(i=>i.id===t.id);e!==-1&&(this.tickets[e].status=t.status)},handleNewMessage(t){var l;if(console.log("New message received:",t),t.sender_id===this.user.id&&t.sender_type!=="admin"){console.log("Ignoring own message");return}if(this.messages.some(s=>s.id===t.id)){console.log("Message already in the list");return}const e={id:t.id,ticket_id:t.ticket_id,sender_id:t.sender_id,sender_name:(l=t.sender)!=null&&l.first_name?`${t.sender.first_name} ${t.sender.last_name}`.trim():t.sender_type==="admin"?"Support Staff":"Unknown",message:t.message,file_url:t.file_url,file_name:t.file_name,file_size:t.file_size,created_at:t.created_at};this.messages.push(e);const i=this.tickets.findIndex(s=>s.id===t.ticket_id);i!==-1&&(this.tickets[i].last_message=t.message||"File attachment",this.tickets[i].updated_at=t.created_at),u().info("New message received"),this.$nextTick(()=>{this.initChatMessagesScroll()})},clearExistingListeners(){this.channelSubscriptions&&this.channelSubscriptions.length>0&&(console.log("Cleaning up existing listeners..."),this.channelSubscriptions.forEach(t=>{try{console.log(`Unsubscribing from ${t.name}`),typeof t.channel.stopListening=="function"&&(t.events&&Array.isArray(t.events)?t.events.forEach(e=>{t.channel.stopListening(e)}):t.event&&t.channel.stopListening(t.event)),typeof t.channel.unsubscribe=="function"&&t.channel.unsubscribe()}catch(e){console.error(`Error cleaning up listener ${t.name}:`,e)}}),this.channelSubscriptions=[])},listenForNewTickets(){const t=this.channelSubscriptions.find(e=>e.name==="tickets");t&&(t.channel.unsubscribe(),this.channelSubscriptions=this.channelSubscriptions.filter(e=>e.name!=="tickets")),console.log("Subscribing to general tickets channel");try{const e=window.Echo.channel("tickets");e.listen("TicketCreated",i=>{console.log("New ticket created:",i),i.created_by===this.user.id&&(this.tickets.some(l=>l.id===i.id)||(this.tickets.unshift({...i,avatar:this.defaultAvatar,last_message:i.description||""}),u().info(`New ticket created: ${i.subject}`)))}),this.channelSubscriptions.push({name:"tickets",channel:e,event:"TicketCreated"}),console.log("Tickets listener set up successfully")}catch(e){console.error("Error setting up tickets listener:",e)}},setupTicketChannels(){var e;if(this.channelSubscriptions.filter(i=>{var l;return i.name.startsWith("ticket.")||i.name===`ticket.${(l=this.selectedTicket)==null?void 0:l.uuid}`}).forEach(i=>{i.channel.unsubscribe()}),this.channelSubscriptions=this.channelSubscriptions.filter(i=>{var l;return!i.name.startsWith("ticket.")&&i.name!==`ticket.${(l=this.selectedTicket)==null?void 0:l.uuid}`}),!!((e=this.selectedTicket)!=null&&e.uuid)){console.log(`Subscribing to ticket channel: ticket.${this.selectedTicket.uuid}`);try{const i=window.Echo.channel(`ticket.${this.selectedTicket.uuid}`);i.listen(".MessageCreated",l=>{console.log("New message received:",l),l.sender_id!==this.user.id&&!this.messages.find(s=>s.id===l.id)&&(this.messages.push(l),this.$nextTick(()=>{this.initChatMessagesScroll()}),u().info("New message received"))}).error(l=>{console.error("Channel subscription error:",l)}),i.listen("TicketUpdated",l=>{console.log("Ticket updated:",l),this.selectedTicket.id===l.id&&(this.selectedTicket.status=l.status,u().info(`Ticket status updated to: ${l.status}`),(l.status==="resolved"||l.status==="unresolved")&&this.selectTicket(this.selectedTicket.id));const s=this.tickets.findIndex(a=>a.id===l.id);s!==-1&&(this.tickets[s].status=l.status)}).error(l=>{console.error("Channel subscription error:",l)}),i.listen("TicketClosed",l=>{console.log("Ticket closed:",l),this.selectedTicket&&this.selectedTicket.id===l.id&&(this.selectedTicket.status=l.status,this.selectedTicket.closure=l.closure,u().info(`Ticket has been marked as ${l.status}`));const s=this.tickets.findIndex(a=>a.id===l.id);s!==-1&&(this.tickets[s].status=l.status)}).error(l=>{console.error("Channel subscription error:",l)}),this.channelSubscriptions.push({name:`ticket.${this.selectedTicket.uuid}`,channel:i}),console.log(`Successfully subscribed to ticket.${this.selectedTicket.uuid} channel`)}catch(i){console.error(`Failed to subscribe to ticket.${this.selectedTicket.uuid} channel:`,i)}}},listenForNotifications(){const t=this.channelSubscriptions.find(e=>e.name==="notifications");t&&(t.channel.unsubscribe(),this.channelSubscriptions=this.channelSubscriptions.filter(e=>e.name!=="notifications")),console.log("Subscribing to notifications channel");try{const e=window.Echo.channel("notifications");e.listen("NotificationEvent",i=>{console.log("Notification received:",i),u().info(i.message,{timeout:8e3,position:"top-right"})}),this.channelSubscriptions.push({name:"notifications",channel:e,event:"NotificationEvent"}),console.log("Notifications listener set up successfully")}catch(e){console.error("Error setting up notifications listener:",e)}},onDateSelected(){if(this.showDatePicker=!1,this.selectedDateRange&&this.selectedDateRange.length===2){const[t,e]=this.selectedDateRange;this.filterTicketsByDate(t,e)}},filterTicketsByDate(t,e){const i=new Date(t),l=new Date(e);this.displayedTickets=this.tickets.filter(s=>{const a=new Date(s.created_at);return a>=i&&a<=l}),this.displayedTickets.length===0&&u().info("No tickets found for the selected date range")},formatDate(t){return new Date(t).toLocaleDateString()},initChatMessagesScroll(){const t=this.$el.querySelector(".chat-messages");t?t.scrollTop=t.scrollHeight:console.error("chatMessages element not found in DOM")},truncate(t,e){return t?t.length>e?t.substring(0,e)+"...":t:""},formatFileSize(t){if(!t)return"0 B";const e=1024,i=["B","KB","MB","GB"],l=Math.floor(Math.log(t)/Math.log(e));return`${parseFloat((t/Math.pow(e,l)).toFixed(2))} ${i[l]}`},formatRelativeTime(t){const i=Math.floor((new Date-new Date(t))/1e3);return i<60?`${i} seconds ago`:i<3600?`${Math.floor(i/60)} minutes ago`:i<86400?`${Math.floor(i/3600)} hours ago`:`${Math.floor(i/86400)} days ago`},async fetchTickets(){try{const t=await C.get("/api/tickets");this.tickets=t.data.map(e=>{var i,l;return{...e,avatar:e.avatar||this.defaultAvatar,last_message:((l=(i=e.messages)==null?void 0:i.slice(-1)[0])==null?void 0:l.message)||""}}),this.displayedTickets=this.tickets}catch{u().error("Failed to fetch tickets")}},async selectTicket(t){var e;this.isLoadingTicket=!0;try{const i=await C.get(`/api/tickets/${t}`);this.selectedTicket=i.data;const l=await C.get(`/api/tickets/${t}/messages`);this.messages=l.data.map(s=>({...s,sender_name:s.sender_name||"Unknown",message:s.message||"",created_at:s.created_at||""})),(e=this.selectedTicket)!=null&&e.uuid&&(this.clearChannelSubscriptions(),this.setupTicketListeners(this.selectedTicket.uuid),this.setupRawEventListener()),this.$nextTick(()=>{this.initChatMessagesScroll()})}catch{u().error("Failed to load ticket")}finally{this.isLoadingTicket=!1}},setupRawEventListener(){var e,i;const t=(i=(e=window.Echo)==null?void 0:e.connector)==null?void 0:i.pusher;t&&t.bind_global((l,s)=>{(l.includes("Message")||l.includes("message"))&&(console.log(`🔔 Raw Pusher event: ${l}`,s),s&&s.message&&s.ticket_id&&(console.log("This looks like a message, trying to handle it..."),this.handleNewMessage(s)))})},setupTicketListeners(t){if(console.log(`Setting up listeners for ticket ${t}`),typeof window.Echo>"u"){console.error("Echo is not available for ticket listeners");return}try{this.cleanupChannelSubscription(`ticket.${t}`);const e=`ticket.${t}`,i=window.Echo.channel(e);console.log(e),i.error(l=>{console.error(`Channel error on ${e}:`,l)}),i.listen("MessageCreated",l=>{console.log("MessageCreated event received:",l),this.handleNewMessage(l)}),i.listenToAll((l,s)=>{console.log(`All ticket events - ${l}:`,s),(l.includes("message")||l.includes("Message"))&&s&&(s.message||s.id)&&this.handleNewMessage(s)}),this.channelSubscriptions.push({name:e,channel:i,events:["MessageCreated"]}),console.log(`Successfully subscribed to ${e}`)}catch(e){console.error(`Error setting up ticket listeners for ${t}:`,e)}},cleanupChannelSubscription(t){const e=this.channelSubscriptions.findIndex(i=>i.name===t);if(e!==-1){try{console.log(`Cleaning up existing subscription to ${t}`),window.Echo.leave(t)}catch(i){console.warn(`Error leaving channel ${t}:`,i)}this.channelSubscriptions.splice(e,1)}},clearChannelSubscriptions(){this.channelSubscriptions||(this.channelSubscriptions=[]),this.channelSubscriptions.forEach(t=>{if(t.channel&&(Array.isArray(t.events)&&t.events.forEach(e=>{try{t.channel.stopListening(e)}catch{}}),typeof t.channel.leave=="function"))try{t.channel.leave()}catch{}}),this.channelSubscriptions=[]},logConnectionStatus(){if(window.Echo&&window.Echo.connector&&window.Echo.connector.pusher){const t=window.Echo.connector.pusher.connection.state;if(console.log(`Pusher connection state: ${t}`),t==="connected"){console.log(`Socket ID: ${window.Echo.connector.pusher.connection.socket_id}`);const e=window.Echo.connector.pusher.channels.channels;console.log("Subscribed channels:");for(const i in e)console.log(`- ${i}: ${e[i].subscribed?"Subscribed":"Pending"}`)}}else console.error("Echo or Pusher not properly initialized")},async createTicket(){var t;if(this.isFormValid){this.isCreating=!0;try{const e=await C.post("/api/tickets",this.newTicket);this.tickets.unshift(e.data),this.showCreateTicketModal=!1,this.newTicket={subject:"",description:""},u().success("Ticket created successfully")}catch(e){((t=e.response)==null?void 0:t.status)===422?Object.entries(e.response.data.errors).forEach(([i,[l]])=>{u().error(`${i}: ${l}`)}):u().error("Failed to create ticket")}finally{this.isCreating=!1}}},getStatusColor(t){switch(t.toLowerCase()){case"resolved":return"success";case"pending":return"warning";case"unresolved":return"error";default:return"grey"}},async sendMessage(){if(this.canSendMessage){this.isSending=!0;try{const t=new FormData;t.append("ticket_id",this.selectedTicket.id),this.message&&t.append("message",this.message),this.file&&t.append("file",this.file);const e=await C.post("/api/tickets/messages",t,{headers:{"Content-Type":"multipart/form-data"}});this.messages.push(e.data),this.message="",this.file=null,this.$refs.fileInput.value=""}catch{u().error("Failed to send message")}finally{this.isSending=!1}}},handleFileChange(t){const e=t.target.files[0];if(e.size>1024*1024*10){u().error("File size exceeds the 10MB limit");return}this.file=e},removeFile(){this.file=null,this.$refs.fileInput.value=""},async closeTicket2(){if(this.selectedTicket)try{await C.post(`/api/tickets/${this.selectedTicket.id}/close`,{status:"resolved"}),u().success("Ticket closed successfully"),this.fetchTickets()}catch{u().error("Failed to close ticket")}},async submitCloseTicket(){var t,e,i,l,s,a;if(!this.isCloseFormValid){u().error("Please complete all required fields");return}if(this.closeTicketData.status==="unresolved"&&!((t=this.closeTicketData.reason)!=null&&t.trim())){u().error("Reason is required for unresolved tickets");return}if(this.closeTicketData.rating<1){u().error("Please provide a rating");return}this.isClosing=!0;try{const c={status:this.closeTicketData.status,rating:this.closeTicketData.rating,reason:this.closeTicketData.status==="unresolved"?(e=this.closeTicketData.reason)==null?void 0:e.trim():null,feedback:this.closeTicketData.status==="resolved"?(i=this.closeTicketData.feedback)==null?void 0:i.trim():null},f=await C.post(`/api/tickets/${this.selectedTicket.id}/close`,c);if(f.data.error){u().error(f.data.error);return}u().success("Ticket closed successfully"),this.showCloseTicketModal=!1,await this.fetchTickets();const T=await C.get(`/api/tickets/${this.selectedTicket.id}`);this.selectedTicket=T.data}catch(c){if(((l=c.response)==null?void 0:l.status)===422){const f=c.response.data.errors;Object.values(f).forEach(T=>{T.forEach(g=>u().error(g))})}else u().error(((a=(s=c.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to close ticket")}finally{this.isClosing=!1}},closeTicket(){this.closeTicketData={status:"resolved",reason:"",feedback:"",rating:0},this.showCloseTicketModal=!0},archiveTicket(){this.selectedTicket&&u().info("Archive ticket functionality is under development")}},mounted(){if(window.Echo&&window.Echo.connector&&window.Echo.connector.pusher){const t=window.Echo.connector.pusher;if(console.log("Echo instance found, socket ID:",window.Echo.socketId()),console.log("Pusher connection state:",t.connection.state),t.bind_global((e,i)=>{(e.includes("Message")||e.includes("message")||e.startsWith("pusher:"))&&(console.log(`Global Pusher event: ${e}`,i),i&&(i.message||i.id)&&(console.log("This looks like a message event, attempting to process"),typeof this.handleNewMessage=="function"&&this.handleNewMessage(i)))}),console.log(window.Echo,"window.Echo"),window.Echo){const e=window.Echo.channel("ticket.0b07acd7-f834-4182-b2fa-d2cc431ebccc");e.listen("MessageCreated",i=>{console.log("TEST - Message received!",i),alert("Message received: "+i.message)}),e.listenToAll((i,l)=>{console.log(`TEST - Event received: ${i}`,l)}),console.log("Test listeners set up successfully")}t.connection.bind("state_change",e=>{console.log(`Pusher connection changed: ${e.previous} → ${e.current}`)}),t.connection.bind("connected",()=>{console.log("✅ Pusher connected! Socket ID:",t.connection.socket_id)}),t.connection.bind("error",e=>{console.error("❌ Pusher connection error:",e)})}else console.error("Echo or Pusher not properly initialized");this.fetchTickets(),this.connectionCheckInterval=setInterval(()=>{this.logConnectionStatus()},3e4),this.$nextTick(()=>{this.initChatMessagesScroll()})},beforeUnmount(){this.channelSubscriptions.length>0&&(console.log("Cleaning up channel subscriptions"),this.channelSubscriptions.forEach(t=>{t.channel&&typeof t.channel.unsubscribe=="function"&&(t.channel.unsubscribe(),console.log(`Unsubscribed from ${t.name}`))}),this.channelSubscriptions=[]),this.connectionCheckInterval&&clearInterval(this.connectionCheckInterval)}},te={class:"d-flex flex-column align-end"},se={class:"text-caption"},ie={key:0,class:"ticket-details mb-4"},le={class:"d-flex align-center"},ne={class:"text-h6 mb-1"},oe={class:"text-body-2 text-grey-darken-1 mb-2"},ce={class:"d-flex align-center"},re={class:"text-caption text-grey"},ae={class:"chat-messages"},de={class:"date-divider"},ue={class:"date-text"},he={key:0,class:"file-message"},fe=["href"],ke={class:"text-wrap"},ge={class:"text-subtitle-2"},me={class:"text-caption"},pe={class:"message-text"},Te={class:"message-time"},be={key:2,class:"file-preview px-4 py-2"},ve={class:"file-preview-card"},we={class:"file-info mx-2"},Ce={class:"file-name font-weight-medium"},ye={class:"text-caption"},_e={class:"closure-section pa-6"},Se={class:"d-flex align-center justify-space-between mb-4"},De={class:"text-subtitle-2 text-grey mb-4"},Ve={class:"rating-section my-4"},xe={class:"d-flex justify-center"};function Me(t,e,i,l,s,a){return k(),b(H,{fluid:"",class:"chat-container"},{default:o(()=>[n(R,{class:"mb-3"},{default:o(()=>[n(M,{cols:"12"},{default:o(()=>e[17]||(e[17]=[r("h2",{class:"text-h4 font-weight-bold"},"Help & Support",-1)])),_:1})]),_:1}),n(R,null,{default:o(()=>[n(M,{cols:"12",md:"4"},{default:o(()=>[n(y,{elevation:"3",class:"rounded-lg ticket-list"},{default:o(()=>[n(I,{flat:"",color:"primary",class:"rounded-t-lg"},{default:o(()=>[n(U,{class:"text-white"},{default:o(()=>e[18]||(e[18]=[d("Tickets")])),_:1}),n(D),n(v,{color:"white",class:"m-2",variant:"flat",onClick:e[0]||(e[0]=c=>s.showCreateTicketModal=!0)},{default:o(()=>[n(w,{start:""},{default:o(()=>e[19]||(e[19]=[d("mdi-plus")])),_:1}),e[20]||(e[20]=d(" Create "))]),_:1})]),_:1}),n(S,null,{default:o(()=>[n(z,{modelValue:s.selectedStatus,"onUpdate:modelValue":e[1]||(e[1]=c=>s.selectedStatus=c),items:["All","Pending","Resolved","Unresolved"],label:"Filter by Status",variant:"outlined",density:"compact",class:"mb-4"},null,8,["modelValue"]),n(A,{modelValue:s.searchQuery,"onUpdate:modelValue":e[2]||(e[2]=c=>s.searchQuery=c),label:"Search tickets","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",class:"mb-4"},null,8,["modelValue"]),n(j,{class:"ticket-list-items",style:{"max-height":"calc(90vh - 200px)","overflow-y":"auto"}},{default:o(()=>[(k(!0),p(_,null,E(a.filteredTickets,c=>{var f;return k(),b(N,{key:c.id,onClick:T=>a.selectTicket(c.id),class:V([{"selected-ticket":((f=s.selectedTicket)==null?void 0:f.id)===c.id},"mb-2 rounded-lg"])},{prepend:o(()=>[n(P,{color:"primary",size:"40"},{default:o(()=>{var T;return[d(h(((T=c.subject[0])==null?void 0:T.toUpperCase())||"T"),1)]}),_:2},1024)]),append:o(()=>[r("div",te,[n(F,{color:a.getStatusColor(c.status),size:"small",class:"mb-1 text-capitalize"},{default:o(()=>[d(h(c.status),1)]),_:2},1032,["color"]),r("span",se,h(a.formatRelativeTime(c.updated_at)),1)])]),default:o(()=>[n(B,{class:"font-weight-medium"},{default:o(()=>[d(h(a.truncate(c.subject,20)),1)]),_:2},1024),n(K,{class:"text-caption"},{default:o(()=>[d(h(a.truncate(c.last_message||c.description,30)),1)]),_:2},1024)]),_:2},1032,["onClick","class"])}),128))]),_:1})]),_:1})]),_:1})]),_:1}),n(M,{cols:"12",md:"8"},{default:o(()=>[n(y,{elevation:"3",class:"chat-section rounded-lg"},{default:o(()=>{var c;return[n(I,{flat:"",color:"primary",class:"rounded-t-lg"},{default:o(()=>[n(U,{class:"text-white"},{default:o(()=>{var f;return[d(h(((f=s.selectedTicket)==null?void 0:f.subject)||"Select a Ticket"),1)]}),_:1}),n(D),s.selectedTicket&&s.selectedTicket.status==="pending"?(k(),b(W,{key:0},{activator:o(({props:f})=>[n(v,Z({icon:""},f),{default:o(()=>[n(w,null,{default:o(()=>e[21]||(e[21]=[d("mdi-dots-vertical")])),_:1})]),_:2},1040)]),default:o(()=>[n(j,null,{default:o(()=>[n(N,{onClick:a.closeTicket},{prepend:o(()=>[n(w,null,{default:o(()=>e[22]||(e[22]=[d("mdi-check-circle")])),_:1})]),default:o(()=>[n(B,null,{default:o(()=>e[23]||(e[23]=[d("Close Ticket")])),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})):m("",!0)]),_:1}),s.selectedTicket?(k(),p("div",ie,[n(y,{flat:"",class:"pa-4 bg-grey-lighten-4"},{default:o(()=>[r("div",le,[n(P,{color:"primary",size:"48",class:"mr-4"},{default:o(()=>{var f;return[d(h(((f=s.selectedTicket.subject[0])==null?void 0:f.toUpperCase())||"T"),1)]}),_:1}),r("div",null,[r("h3",ne,h(s.selectedTicket.subject),1),r("p",oe,h(s.selectedTicket.description),1),r("div",ce,[n(F,{color:a.getStatusColor(s.selectedTicket.status),size:"small",class:"mr-2 text-capitalize"},{default:o(()=>[d(h(s.selectedTicket.status),1)]),_:1},8,["color"]),r("span",re,"Created "+h(a.formatRelativeTime(s.selectedTicket.created_at)),1)])])])]),_:1})])):m("",!0),s.isLoadingTicket?(k(),b(J,{key:1,indeterminate:"",color:"primary"})):m("",!0),r("div",ae,[(k(!0),p(_,null,E(a.groupedMessages,(f,T)=>(k(),p(_,{key:T},[r("div",de,[e[24]||(e[24]=r("div",{class:"date-line"},null,-1)),r("span",ue,h(T),1),e[25]||(e[25]=r("div",{class:"date-line"},null,-1))]),(k(!0),p(_,null,E(f,g=>(k(),p("div",{key:g.id,class:V(["message-wrapper",{"message-sent":g.sender_id===s.user.id}])},[n(y,{color:g.sender_id===s.user.id?"primary":"grey-lighten-4",class:V({"message-bubble":!0})},{default:o(()=>[n(S,{class:V({"text-white":g.sender_id===s.user.id})},{default:o(()=>[g.file_url?(k(),p("div",he,[n(y,{flat:"",color:g.sender_id===s.user.id?"primary-lighten-1":"grey-lighten-3",class:"pa-2"},{default:o(()=>[r("a",{href:g.file_url,target:"_blank",class:"file-link d-flex align-center"},[n(w,{color:g.sender_id===s.user.id?"white":"primary",class:"mr-2"},{default:o(()=>e[26]||(e[26]=[d(" mdi-file-document-outline ")])),_:2},1032,["color"]),r("div",ke,[r("div",ge,h(g.file_name),1),r("div",me,h(a.formatFileSize(g.file_size)),1)])],8,fe)]),_:2},1032,["color"])])):m("",!0),r("div",pe,h(g.message),1),r("span",Te,h(a.formatRelativeTime(g.created_at)),1)]),_:2},1032,["class"])]),_:2},1032,["color"])],2))),128))],64))),128))]),s.file?(k(),p("div",be,[r("div",ve,[n(w,{color:"primary",size:"24"},{default:o(()=>e[27]||(e[27]=[d("mdi-file")])),_:1}),r("div",we,[r("span",Ce,h(s.file.name),1),r("small",ye,h((s.file.size/1024).toFixed(2))+" KB",1)]),n(v,{icon:"",size:"small",color:"error",onClick:a.removeFile},{default:o(()=>[n(w,null,{default:o(()=>e[28]||(e[28]=[d("mdi-close")])),_:1})]),_:1},8,["onClick"])])])):m("",!0),r("input",{type:"file",ref:"fileInput",class:"d-none",onChange:e[3]||(e[3]=(...f)=>a.handleFileChange&&a.handleFileChange(...f))},null,544),s.selectedTicket&&s.selectedTicket.status==="pending"?(k(),b(L,{key:3,class:"chat-input pa-4"},{default:o(()=>[n(v,{icon:"",onClick:e[4]||(e[4]=f=>t.$refs.fileInput.click())},{default:o(()=>[n(w,null,{default:o(()=>e[29]||(e[29]=[d("mdi-paperclip")])),_:1})]),_:1}),n(x,{modelValue:s.message,"onUpdate:modelValue":e[5]||(e[5]=f=>s.message=f),rows:"1","auto-grow":"","hide-details":"",variant:"outlined",density:"compact",class:"mx-4",placeholder:"Type a message..."},null,8,["modelValue"]),n(v,{loading:s.isSending,disabled:!a.canSendMessage,color:"primary",icon:"",onClick:a.sendMessage},{default:o(()=>[n(w,null,{default:o(()=>e[30]||(e[30]=[d("mdi-send")])),_:1})]),_:1},8,["loading","disabled","onClick"])]),_:1})):m("",!0),r("div",_e,[s.selectedTicket&&s.selectedTicket.status!=="pending"?(k(),b(X,{key:0,color:s.selectedTicket.status==="resolved"?"success":"error",icon:s.selectedTicket.status==="resolved"?"mdi-check-circle":"mdi-alert-circle",variant:"tonal",class:"mb-6"},{default:o(()=>[d(" This ticket is "+h(s.selectedTicket.status)+". No new messages can be sent. ",1)]),_:1},8,["color","icon"])):m("",!0),(c=s.selectedTicket)!=null&&c.closure?(k(),b(y,{key:1,variant:"outlined",class:"closure-details pa-4"},{default:o(()=>[r("div",Se,[e[31]||(e[31]=r("div",{class:"text-h6"},"Ticket Closure Details",-1)),n(F,{color:s.selectedTicket.status==="resolved"?"success":"error",size:"small",variant:"elevated"},{default:o(()=>[d(h(s.selectedTicket.status.toUpperCase()),1)]),_:1},8,["color"])]),r("div",De,[n(w,{size:"small",class:"mr-1"},{default:o(()=>e[32]||(e[32]=[d("mdi-clock-outline")])),_:1}),d(" Closed "+h(a.formatRelativeTime(s.selectedTicket.closure.created_at)),1)]),s.selectedTicket.closure.reason?(k(),p(_,{key:0},[e[33]||(e[33]=r("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Reason",-1)),n(S,{class:"pa-3 bg-grey-lighten-4 rounded mb-4"},{default:o(()=>[d(h(s.selectedTicket.closure.reason),1)]),_:1})],64)):m("",!0),s.selectedTicket.closure.feedback?(k(),p(_,{key:1},[e[34]||(e[34]=r("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Feedback",-1)),n(S,{class:"pa-3 bg-grey-lighten-4 rounded mb-4"},{default:o(()=>[d(h(s.selectedTicket.closure.feedback),1)]),_:1})],64)):m("",!0),s.selectedTicket.closure.rating?(k(),p(_,{key:2},[e[35]||(e[35]=r("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Rating",-1)),n(q,{"model-value":s.selectedTicket.closure.rating,color:"amber",readonly:"","half-increments":"",size:"small"},null,8,["model-value"])],64)):m("",!0)]),_:1})):m("",!0)])]}),_:1})]),_:1})]),_:1}),n(Q,{modelValue:s.showCreateTicketModal,"onUpdate:modelValue":e[10]||(e[10]=c=>s.showCreateTicketModal=c),"max-width":"500px"},{default:o(()=>[n(y,null,{default:o(()=>[n(O,null,{default:o(()=>e[36]||(e[36]=[d("Create Ticket")])),_:1}),n(S,null,{default:o(()=>[n(Y,{ref:"form",modelValue:s.isFormValid,"onUpdate:modelValue":e[8]||(e[8]=c=>s.isFormValid=c),onSubmit:$(a.createTicket,["prevent"])},{default:o(()=>[n(A,{modelValue:s.newTicket.subject,"onUpdate:modelValue":e[6]||(e[6]=c=>s.newTicket.subject=c),rules:[c=>!!c||"Subject is required"],label:"Subject",required:"",clearable:""},null,8,["modelValue","rules"]),n(x,{modelValue:s.newTicket.description,"onUpdate:modelValue":e[7]||(e[7]=c=>s.newTicket.description=c),rules:[c=>!!c||"Description is required"],label:"Description",required:"",clearable:""},null,8,["modelValue","rules"])]),_:1},8,["modelValue","onSubmit"])]),_:1}),n(L,null,{default:o(()=>[n(D),n(v,{text:"",onClick:e[9]||(e[9]=c=>s.showCreateTicketModal=!1)},{default:o(()=>e[37]||(e[37]=[d("Cancel")])),_:1}),n(v,{color:"primary",variant:"elevated",loading:s.isCreating,disabled:!s.isFormValid,onClick:a.createTicket},{default:o(()=>e[38]||(e[38]=[d(" Create ")])),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(Q,{modelValue:s.showCloseTicketModal,"onUpdate:modelValue":e[16]||(e[16]=c=>s.showCloseTicketModal=c),"max-width":"500px"},{default:o(()=>[n(y,null,{default:o(()=>[n(O,null,{default:o(()=>e[39]||(e[39]=[d("Close Ticket")])),_:1}),n(S,null,{default:o(()=>[n(z,{modelValue:s.closeTicketData.status,"onUpdate:modelValue":e[11]||(e[11]=c=>s.closeTicketData.status=c),items:s.statusOptions,label:"Status",required:""},null,8,["modelValue","items"]),s.closeTicketData.status==="unresolved"?(k(),b(x,{key:0,modelValue:s.closeTicketData.reason,"onUpdate:modelValue":e[12]||(e[12]=c=>s.closeTicketData.reason=c),label:"Reason",required:""},null,8,["modelValue"])):m("",!0),r("div",Ve,[e[40]||(e[40]=r("div",{class:"text-subtitle-1 mb-2"},"Rate your experience",-1)),r("div",xe,[n(q,{modelValue:s.closeTicketData.rating,"onUpdate:modelValue":e[13]||(e[13]=c=>s.closeTicketData.rating=c),color:"amber","active-color":"amber",hover:"",size:"large"},null,8,["modelValue"])])]),s.closeTicketData.status==="resolved"?(k(),b(x,{key:1,modelValue:s.closeTicketData.feedback,"onUpdate:modelValue":e[14]||(e[14]=c=>s.closeTicketData.feedback=c),label:"Additional Feedback (Optional)"},null,8,["modelValue"])):m("",!0)]),_:1}),n(L,null,{default:o(()=>[n(D),n(v,{text:"",onClick:e[15]||(e[15]=c=>s.showCloseTicketModal=!1)},{default:o(()=>e[41]||(e[41]=[d("Cancel")])),_:1}),n(v,{color:"primary",loading:s.isClosing,disabled:!a.isCloseFormValid,onClick:a.submitCloseTicket},{default:o(()=>e[42]||(e[42]=[d("Close Ticket")])),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Le=G(ee,[["render",Me]]);export{Le as default};

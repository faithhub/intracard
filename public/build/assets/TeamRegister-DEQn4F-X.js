import{i as L}from"./intracard-vz8Mx2b7.js";import{b as q}from"./app-DZGKe3Aq.js";import{_ as S,R as w,z as y,C as i,al as k,M as R,L as V,O as r,a0 as c,a8 as j,$ as g,Z as b,a4 as A,G as f,H as h,E as n,J as E,au as F,an as I,av as U,ag as _,aw as M,a6 as p,a3 as v,D as Y,ax as z,ao as N,a5 as T,am as O,ap as B}from"./main-DHxkGDom.js";const G="/build/assets/intracard-small-D4WtWD_P.png",W="/build/assets/ca-flag-DhNpSlue.png",H={setup(){return{toast:q()}},data(){return{showDeclineDialog:!1,isDeclining:!1,isLoading:!0,isValid:!1,errorMessage:"",invitation:null,errorDescription:"",status:"",logoSrc:L,verificationCode:"",cooldownTime:0,cooldownInterval:null,form:{firstName:"",middleName:"",lastName:"",email:"",phone:"",password:"",password_confirmation:"",consent:!1},token:null,attemptsRemaining:5,validationErrors:{phone:[],verificationCode:[]},showPassword:!1,isRegistering:!1,isDeclining:!1,isSendingCode:!1,isVerifyingCode:!1,isCodeSent:!1,isPhoneVerified:!1,verificationCode:"",displayPhone:"",rules:{required:t=>!!t||"This field is required",email:t=>/.+@.+\..+/.test(t)||"Enter a valid email address",min:t=>t.length>=8||"Password must be at least 8 characters",passwordMatch:t=>t===this.form.password||"Passwords must match",phone:t=>/^\+?[\d\s-]{10,}$/.test(t)||"Enter a valid phone number",consent:t=>t||"You must agree to the terms"}}},computed:{isPhoneValid(){return this.rules.phone(this.form.phone)===!0},isFormValid(){return this.valid&&this.isPhoneVerified&&this.form.consent},canVerifyPhone(){return this.form.phone.replace(/\D/g,"").length===10&&!this.isPhoneVerified},errorIcon(){switch(this.status){case"declined":return"mdi-close-circle";case"accepted":return"mdi-check-circle";case"expired":return"mdi-clock-alert";default:return"mdi-alert-circle"}},errorIconColor(){switch(this.status){case"declined":return"error";case"accepted":return"success";case"expired":return"warning";default:return"error"}},errorDescription(){switch(this.status){case"declined":return"This invitation has been declined. Please contact the team administrator for a new invitation if needed.";case"accepted":return"This invitation has already been used. Please login to your account.";case"expired":return"This invitation has expired. Please contact the team administrator for a new invitation.";default:return"Please contact the team administrator for assistance."}}},created(){if(this.token=this.$route.params.token,!this.token){this.handleInvalidInvitation("Invalid invitation link");return}this.checkInvitation()},methods:{async register(){var t,e,l,m,s,o;if(!this.validateForm()){this.toast.error("Please fill in all required fields");return}if(!this.isPhoneVerified){this.toast.error("Please verify your phone number"),this.validationErrors.phone=["Phone number must be verified"];return}this.isRegistering=!0;try{const d={first_name:this.form.firstName.trim(),middle_name:((t=this.form.middleName)==null?void 0:t.trim())||null,last_name:this.form.lastName.trim(),email:this.form.email.trim(),phone:this.form.phone.replace(/\D/g,""),password:this.form.password,password_confirmation:this.form.password_confirmation,terms_accepted:this.form.consent},u=await w.post(`/api/team/invitation/${this.token}/accept`,d);this.toast.success("Registration completed! Please check your email for verification instructions."),setTimeout(()=>{this.$router.push({name:"Login"})},2e3)}catch(d){((e=d.response)==null?void 0:e.status)===422?(this.validationErrors=d.response.data.errors,this.toast.error("Please correct the errors in the form")):((l=d.response)==null?void 0:l.status)===404?(this.toast.error("Invalid or expired invitation"),setTimeout(()=>this.$router.push({name:"Login"}),3e3)):((m=d.response)==null?void 0:m.status)===409?(this.validationErrors.email=[d.response.data.message],this.toast.error("Email address is already registered")):(o=(s=d.response)==null?void 0:s.data)!=null&&o.message?this.toast.error(d.response.data.message):(this.toast.error("An unexpected error occurred. Please try again."),console.error("Registration error:",d))}finally{this.isRegistering=!1}},async checkInvitation(){var t,e,l,m;try{const s=await w.get(`/api/team/invitation/${this.token}`);if(!s.data.valid){this.handleInvalidInvitation(s.data.message,s.data.status);return}if(this.isValid=!0,this.invitation=s.data.data,this.form.email=this.invitation.email,this.invitation.name){const o=this.invitation.name.split(" ");this.form.firstName=o[0]||"",this.form.lastName=o[o.length-1]||"",o.length>2&&(this.form.middleName=o.slice(1,-1).join(" "))}}catch(s){const o=((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.message)||"Error loading invitation details",d=((m=(l=s.response)==null?void 0:l.data)==null?void 0:m.status)||"";this.handleInvalidInvitation(o,d)}finally{this.isLoading=!1}},handleInvalidInvitation(t,e=""){this.isValid=!1,this.errorMessage=t,this.status=e,this.isLoading=!1,e==="accepted"&&setTimeout(()=>{this.$router.push({name:"login"})},3e3)},onPhoneInput(t){this.clearError("phone");let e=(t||"").replace(/\D/g,"");e.length>10&&(e=e.slice(0,10));let l=e;e.length>6?l=`${e.slice(0,3)} ${e.slice(3,6)} ${e.slice(6)}`:e.length>3&&(l=`${e.slice(0,3)} ${e.slice(3)}`),this.form.phone=l},clearError(t){this.validationErrors[t]&&delete this.validationErrors[t]},async sendVerificationCode(){var t,e,l,m;this.isSendingCode=!0;try{const s=this.form.phone.replace(/\D/g,""),o=await w.post("/api/phone/send-code",{phone:s});this.isCodeSent=!0,this.toast.success("Verification code sent"),this.cooldownTime=60,this.startCooldownTimer(),o.data.data&&(this.attemptsRemaining=o.data.data.attempts_remaining)}catch(s){if((e=(t=s.response)==null?void 0:t.data)!=null&&e.errors){const o=Object.values(s.response.data.errors).flat().join(`
`);this.toast.error(o),s.response.data.errors.phone&&(this.validationErrors.phone=s.response.data.errors.phone)}else(m=(l=s.response)==null?void 0:l.data)!=null&&m.message?this.toast.error(s.response.data.message):this.toast.error("Error sending verification code")}finally{this.isSendingCode=!1}},async verifyCode(){var t,e,l,m;this.isVerifyingCode=!0;try{const s=this.form.phone.replace(/\D/g,"");await w.post("/api/phone/verify-code",{phone:s,code:this.verificationCode}),this.isPhoneVerified=!0,this.toast.success("Phone number verified"),this.validationErrors.phone=[],this.verificationCode="",this.isCodeSent=!1}catch(s){if((e=(t=s.response)==null?void 0:t.data)!=null&&e.errors){const o=Object.values(s.response.data.errors).flat().join(`
`);this.toast.error(o),s.response.data.errors.code&&(this.validationErrors.verificationCode=s.response.data.errors.code),s.response.data.errors.phone&&(this.validationErrors.phone=s.response.data.errors.phone)}else(m=(l=s.response)==null?void 0:l.data)!=null&&m.message?this.toast.error(s.response.data.message):this.toast.error("Invalid verification code")}finally{this.isVerifyingCode=!1}},startCooldownTimer(){this.cooldownInterval&&clearInterval(this.cooldownInterval),this.cooldownInterval=setInterval(()=>{this.cooldownTime>0?this.cooldownTime--:clearInterval(this.cooldownInterval)},1e3)},capitalizeFirstLetter(t){return t?(typeof t!="string"&&(t=String(t)),t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()):""},formatToCAD(t){return new Intl.NumberFormat("en-CA",{style:"currency",currency:"CAD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},validateForm(){return this.validationErrors={},this.form.firstName||(this.validationErrors.firstName=["First name is required"]),this.form.lastName||(this.validationErrors.lastName=["Last name is required"]),this.form.email||(this.validationErrors.email=["Email is required"]),this.form.phone||(this.validationErrors.phone=["Phone number is required"]),this.form.password||(this.validationErrors.password=["Password is required"]),this.form.password.length<8&&(this.validationErrors.password=["Password must be at least 8 characters"]),this.form.password!==this.form.password_confirmation&&(this.validationErrors.password_confirmation=["Passwords do not match"]),this.form.consent||(this.validationErrors.consent=["You must agree to the terms"]),Object.keys(this.validationErrors).length===0},async confirmDecline(){this.isDeclining=!0;try{const t=await w.post(`/api/team/invitation/${this.token}/decline`);this.toast.success(t.data.message||"Invitation declined successfully"),setTimeout(()=>{this.$router.push({name:"Login"})},1500)}catch(t){if(t.response)switch(t.response.status){case 404:this.toast.error("Invitation not found or already processed");break;case 400:this.toast.error(t.response.data.message||"Invalid invitation status");break;case 403:this.toast.error("You do not have permission to decline this invitation");break;default:this.toast.error(t.response.data.message||"Error declining invitation")}else t.request?this.toast.error("Network error. Please check your connection and try again."):(this.toast.error("An unexpected error occurred"),console.error("Decline error:",t))}finally{this.isDeclining=!1,this.showDeclineDialog=!1}}},beforeDestroy(){this.cooldownInterval&&clearInterval(this.cooldownInterval)}},J={class:"text-h5 mb-4"},Z={class:"mb-6"},K={class:"text-center pb-5",style:{"background-color":"#7b1fa2 !important"}},Q={class:"text-h6 mb-2 font-weight-bold primary-text"},X={class:"mt-2"},$={class:"content-text mb-2"},ee={class:"mt-2"},se={class:"d-flex justify-space-between align-center mb-1"},te={class:"label-text"},re={class:"content-text"},ie={class:"d-flex justify-space-between align-center mb-1"},oe={class:"content-text"},ae={class:"d-flex justify-space-between align-center"},ne={class:"content-text"};function le(t,e,l,m,s,o){const d=R("router-link");return s.isLoading?(V(),y(k,{key:0,class:"fill-height d-flex align-center justify-center"},{default:i(()=>[r(g,{justify:"center",align:"center"},{default:i(()=>[r(c,{cols:"12",class:"text-center"},{default:i(()=>[r(j,{indeterminate:"",color:"purple-darken-2",size:"64",width:"4"})]),_:1})]),_:1})]),_:1})):(V(),y(k,{key:1,class:"fill-height"},{default:i(()=>[s.isValid?(V(),y(g,{key:1,align:"center",justify:"center"},{default:i(()=>[r(c,{cols:"12",sm:"10",md:"10",lg:"8"},{default:i(()=>[r(b,{class:"elevation-12"},{default:i(()=>[n("div",K,[r(d,{to:"/",onClick:e[0]||(e[0]=E(()=>{},["prevent"]))},{default:i(()=>e[21]||(e[21]=[n("img",{alt:"Logo",src:G,class:"h-65px mb-2 mt-2"},null,-1)])),_:1}),r(F,{class:"text-white"},{default:i(()=>e[22]||(e[22]=[f("Complete Your Registration")])),_:1})]),r(I,null,{default:i(()=>[r(U,{type:"info",variant:"tonal",color:"purple-lighten-4",class:"mb-4 invitation-details",border:""},{default:i(()=>{var u,a,C,x,D,P;return[n("h3",Q,"Team: "+h((u=s.invitation)==null?void 0:u.team_name),1),r(_,{class:"my-2"}),n("div",X,[e[23]||(e[23]=n("div",{class:"label-text mb-1"},"Property Address:",-1)),n("p",$,h((a=s.invitation)==null?void 0:a.property_address),1)]),r(_,{class:"my-2"}),n("div",ee,[n("div",se,[n("span",te,"Total Amount for "+h(o.capitalizeFirstLetter((C=s.invitation)==null?void 0:C.role))+":",1),n("span",re,h(o.formatToCAD((x=s.invitation)==null?void 0:x.total_amount)),1)]),n("div",ie,[e[24]||(e[24]=n("span",{class:"label-text"},"Your Percentage:",-1)),n("span",oe,h((D=s.invitation)==null?void 0:D.percentage)+"%",1)]),n("div",ae,[e[25]||(e[25]=n("span",{class:"label-text"},"Your Monthly Payment:",-1)),n("span",ne,h(o.formatToCAD((P=s.invitation)==null?void 0:P.monthly_payment)),1)])])]}),_:1}),r(M,{ref:"form",onSubmit:E(o.register,["prevent"])},{default:i(()=>{var u;return[r(g,null,{default:i(()=>[r(c,{cols:"12",md:"6"},{default:i(()=>[r(p,{modelValue:s.form.firstName,"onUpdate:modelValue":e[1]||(e[1]=a=>s.form.firstName=a),"error-messages":s.validationErrors.firstName,label:"First Name",outlined:"",dense:"",onInput:e[2]||(e[2]=a=>o.clearError("firstName")),required:""},null,8,["modelValue","error-messages"])]),_:1}),r(c,{cols:"12",md:"6"},{default:i(()=>[r(p,{modelValue:s.form.lastName,"onUpdate:modelValue":e[3]||(e[3]=a=>s.form.lastName=a),"error-messages":s.validationErrors.lastName,label:"Last Name",outlined:"",dense:"",onInput:e[4]||(e[4]=a=>o.clearError("lastName")),required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),r(g,null,{default:i(()=>[r(c,{cols:"12",md:"6"},{default:i(()=>[r(p,{modelValue:s.form.email,"onUpdate:modelValue":e[5]||(e[5]=a=>s.form.email=a),"error-messages":s.validationErrors.email,label:"Email",outlined:"",dense:"",onInput:e[6]||(e[6]=a=>o.clearError("email")),required:""},null,8,["modelValue","error-messages"])]),_:1}),r(c,{cols:"12",md:"6"},{default:i(()=>[r(p,{modelValue:s.form.middleName,"onUpdate:modelValue":e[7]||(e[7]=a=>s.form.middleName=a),label:"Middle Name (Optional)",outlined:"",dense:""},null,8,["modelValue"])]),_:1})]),_:1}),r(g,{align:"center",class:"mb-2 mt-2","no-gutters":""},{default:i(()=>[r(c,{cols:"10",class:"pe-2"},{default:i(()=>[r(p,{modelValue:s.form.phone,"onUpdate:modelValue":[e[8]||(e[8]=a=>s.form.phone=a),o.onPhoneInput],"error-messages":s.validationErrors.phone,label:"Phone Number",readonly:s.isPhoneVerified,suffix:s.isPhoneVerified?"✓ Verified":"",outlined:"",dense:"",class:"input-no-spacing"},{prepend:i(()=>e[26]||(e[26]=[n("div",{class:"d-flex align-center"},[n("img",{src:W,alt:"Canadian flag",class:"mr-1",style:{width:"20px",height:"15px"}}),n("span",{class:"country-prefix"},"+1")],-1)])),_:1},8,["modelValue","error-messages","readonly","suffix","onUpdate:modelValue"])]),_:1}),r(c,{cols:"2",class:"pl-1"},{default:i(()=>[r(v,{color:"purple-darken-2",loading:s.isSendingCode,disabled:!o.canVerifyPhone||s.cooldownTime>0,onClick:o.sendVerificationCode,width:"120",height:"40",class:"ml-auto d-block"},{default:i(()=>[f(h(s.isPhoneVerified?"✓ Verified":s.cooldownTime>0?`${s.cooldownTime}s`:"Get Code"),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1}),s.isCodeSent&&!s.isPhoneVerified?(V(),y(g,{key:0,align:"center",class:"mb-2"},{default:i(()=>[r(c,{cols:"10",class:"pt-0"},{default:i(()=>[r(p,{modelValue:s.verificationCode,"onUpdate:modelValue":e[9]||(e[9]=a=>s.verificationCode=a),"error-messages":s.validationErrors.verificationCode,label:"Enter Verification Code",outlined:"",dense:"",maxlength:"6",placeholder:"Enter 6-digit code"},null,8,["modelValue","error-messages"])]),_:1}),r(c,{cols:"2",class:"pl-0 pt-0"},{default:i(()=>[r(v,{color:"success",loading:s.isVerifyingCode,onClick:o.verifyCode,width:"120",height:"40",class:"ml-auto d-block",disabled:!s.verificationCode||s.verificationCode.length!==6},{default:i(()=>e[27]||(e[27]=[f(" Verify ")])),_:1},8,["loading","onClick","disabled"])]),_:1})]),_:1})):Y("",!0),r(p,{class:"mb-3",modelValue:s.form.password,"onUpdate:modelValue":e[10]||(e[10]=a=>s.form.password=a),"error-messages":s.validationErrors.password,type:s.showPassword?"text":"password",label:"Password",outlined:"",dense:"","append-icon":s.showPassword?"mdi-eye":"mdi-eye-off","onClick:append":e[11]||(e[11]=a=>s.showPassword=!s.showPassword),onInput:e[12]||(e[12]=a=>o.clearError("password")),required:""},null,8,["modelValue","error-messages","type","append-icon"]),r(p,{modelValue:s.form.password_confirmation,"onUpdate:modelValue":e[13]||(e[13]=a=>s.form.password_confirmation=a),"error-messages":s.validationErrors.password_confirmation,type:s.showPassword?"text":"password",label:"Confirm Password",outlined:"",dense:"",onInput:e[14]||(e[14]=a=>o.clearError("password_confirmation")),required:""},null,8,["modelValue","error-messages","type"]),r(z,{modelValue:s.form.consent,"onUpdate:modelValue":e[15]||(e[15]=a=>s.form.consent=a),"error-messages":s.validationErrors.consent,label:`I agree to the terms and conditions and confirm that I will be responsible for my portion of the ${((u=s.invitation)==null?void 0:u.role)||"rent/mortgage"} payment`,onChange:e[16]||(e[16]=a=>o.clearError("consent")),required:""},null,8,["modelValue","error-messages","label"])]}),_:1},8,["onSubmit"])]),_:1}),r(N,null,{default:i(()=>[r(T),r(v,{variant:"outlined",color:"error",onClick:e[17]||(e[17]=u=>s.showDeclineDialog=!0),loading:s.isDeclining},{default:i(()=>e[28]||(e[28]=[f(" Decline ")])),_:1},8,["loading"]),r(v,{variant:"flat",color:"purple-darken-2",onClick:o.register,loading:s.isRegistering,class:"ml-4"},{default:i(()=>e[29]||(e[29]=[f(" Complete Registration ")])),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1})]),_:1})):(V(),y(g,{key:0,align:"center",justify:"center"},{default:i(()=>[r(c,{cols:"12",sm:"8",md:"6"},{default:i(()=>[r(b,{class:"text-center pa-6"},{default:i(()=>[r(A,{size:"64",color:o.errorIconColor,class:"mb-4"},{default:i(()=>[f(h(o.errorIcon),1)]),_:1},8,["color"]),n("h2",J,h(s.errorMessage),1),n("p",Z,h(o.errorDescription),1),r(d,{to:"/auth/sign-in",class:"home-button"},{default:i(()=>e[20]||(e[20]=[f("Return to Login")])),_:1})]),_:1})]),_:1})]),_:1})),r(B,{modelValue:s.showDeclineDialog,"onUpdate:modelValue":e[19]||(e[19]=u=>s.showDeclineDialog=u),"max-width":"400"},{default:i(()=>[r(b,null,{default:i(()=>[r(O,null,{default:i(()=>e[30]||(e[30]=[f("Decline Invitation?")])),_:1}),r(I,null,{default:i(()=>e[31]||(e[31]=[f(" Are you sure you want to decline this invitation? This action cannot be undone. ")])),_:1}),r(N,null,{default:i(()=>[r(T),r(v,{color:"grey-darken-1",variant:"text",onClick:e[18]||(e[18]=u=>s.showDeclineDialog=!1)},{default:i(()=>e[32]||(e[32]=[f(" Cancel ")])),_:1}),r(v,{color:"error",variant:"text",loading:s.isDeclining,onClick:o.confirmDecline},{default:i(()=>e[33]||(e[33]=[f(" Yes, Decline ")])),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}const fe=S(H,[["render",le],["__scopeId","data-v-6426cf47"]]);export{fe as default};

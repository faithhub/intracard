import{f as tt,b as U,s as et}from"./app-DZGKe3Aq.js";import{R as H,aI as nt,W as rt,X as it}from"./main-DHxkGDom.js";const at=tt("notification",{state:()=>({notifications:[],unreadCount:0,activeTab:"all",loading:!1,categoryCounts:{general:0,payment:0,reminder:0}}),actions:{async fetchNotifications(){try{this.loading=!0;const i=await H.get("/api/notifications",{params:{type:this.activeTab!=="all"?this.activeTab:null}});this.notifications=i.data.notifications.data,this.unreadCount=i.data.unread_count,i.data.category_counts&&(this.categoryCounts=i.data.category_counts)}catch(i){console.error("Error fetching notifications:",i),U().error("Failed to fetch notifications")}finally{this.loading=!1}},async markAsRead2(i){try{console.log(i),await H.patch(`/api/notifications/${i}/read`),this.unreadCount=Math.max(0,this.unreadCount-1);const y=this.notifications.find(b=>b.id===i);y&&(y.read_at=new Date().toISOString())}catch(y){console.error("Error marking notification as read:",y)}},async markAsRead(i){try{this.notifications=this.notifications.filter(y=>y.id!==i.id),i.read_at||(this.unreadCount=Math.max(0,this.unreadCount-1),i.category&&this.categoryCounts[i.category]&&(this.categoryCounts[i.category]=Math.max(0,this.categoryCounts[i.category]-1))),await H.patch(`/api/notifications/${i.id}/read`)}catch(y){console.error("Error marking notification as read:",y),U().error("Failed to mark notification as read"),await this.fetchNotifications()}},async markAllAsRead2(){try{await H.patch("/api/notifications/mark-all-read",{type:this.activeTab}),this.notifications=this.notifications.map(i=>({...i,read_at:i.read_at||new Date().toISOString()})),this.unreadCount=0}catch(i){console.error("Error marking all as read:",i)}},async markAllAsRead(){try{const i=[...this.notifications];this.notifications=[],this.unreadCount=0,Object.keys(this.categoryCounts).forEach(y=>{this.categoryCounts[y]=0}),await H.patch("/api/notifications/mark-all-read",{type:this.activeTab})}catch(i){console.error("Error marking all as read:",i),U().error("Failed to mark all as read"),await this.fetchNotifications()}},setActiveTab(i){this.activeTab=i,this.fetchNotifications()},initializeWebSocket(){window.Echo&&window.Echo.private("notifications").listen("NotificationEvent",i=>{this.handleNewNotification(i)})},handleNewNotification(i){this.notifications.unshift({id:Date.now(),title:i.title,message:i.message,read_at:null,created_at:new Date().toISOString()}),this.unreadCount++,U().info(i.message,{title:i.title})}}});var z={exports:{}},st=z.exports,P;function ot(){return P||(P=1,function(i,y){(function(b,_){i.exports=_()})(st,function(){var b=1e3,_=6e4,W=36e5,T="millisecond",M="second",D="minute",S="hour",w="day",A="week",g="month",R="quarter",h="year",v="date",q="Invalid Date",Q=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,X=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,G={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var n=["th","st","nd","rd"],t=a%100;return"["+a+(n[(t-20)%10]||n[t]||n[0])+"]"}},J=function(a,n,t){var r=String(a);return!r||r.length>=n?a:""+Array(n+1-r.length).join(t)+a},K={s:J,z:function(a){var n=-a.utcOffset(),t=Math.abs(n),r=Math.floor(t/60),e=t%60;return(n<=0?"+":"-")+J(r,2,"0")+":"+J(e,2,"0")},m:function a(n,t){if(n.date()<t.date())return-a(t,n);var r=12*(t.year()-n.year())+(t.month()-n.month()),e=n.clone().add(r,g),s=t-e<0,o=n.clone().add(r+(s?-1:1),g);return+(-(r+(t-e)/(s?e-o:o-e))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:g,y:h,w:A,d:w,D:v,h:S,m:D,s:M,ms:T,Q:R}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},E="en",O={};O[E]=G;var V="$isDayjsObject",Z=function(a){return a instanceof L||!(!a||!a[V])},I=function a(n,t,r){var e;if(!n)return E;if(typeof n=="string"){var s=n.toLowerCase();O[s]&&(e=s),t&&(O[s]=t,e=s);var o=n.split("-");if(!e&&o.length>1)return a(o[0])}else{var u=n.name;O[u]=n,e=u}return!r&&e&&(E=e),e||!r&&E},d=function(a,n){if(Z(a))return a.clone();var t=typeof n=="object"?n:{};return t.date=a,t.args=arguments,new L(t)},c=K;c.l=I,c.i=Z,c.w=function(a,n){return d(a,{locale:n.$L,utc:n.$u,x:n.$x,$offset:n.$offset})};var L=function(){function a(t){this.$L=I(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[V]=!0}var n=a.prototype;return n.parse=function(t){this.$d=function(r){var e=r.date,s=r.utc;if(e===null)return new Date(NaN);if(c.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var o=e.match(Q);if(o){var u=o[2]-1||0,f=(o[7]||"0").substring(0,3);return s?new Date(Date.UTC(o[1],u,o[3]||1,o[4]||0,o[5]||0,o[6]||0,f)):new Date(o[1],u,o[3]||1,o[4]||0,o[5]||0,o[6]||0,f)}}return new Date(e)}(t),this.init()},n.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},n.$utils=function(){return c},n.isValid=function(){return this.$d.toString()!==q},n.isSame=function(t,r){var e=d(t);return this.startOf(r)<=e&&e<=this.endOf(r)},n.isAfter=function(t,r){return d(t)<this.startOf(r)},n.isBefore=function(t,r){return this.endOf(r)<d(t)},n.$g=function(t,r,e){return c.u(t)?this[r]:this.set(e,t)},n.unix=function(){return Math.floor(this.valueOf()/1e3)},n.valueOf=function(){return this.$d.getTime()},n.startOf=function(t,r){var e=this,s=!!c.u(r)||r,o=c.p(t),u=function(N,$){var k=c.w(e.$u?Date.UTC(e.$y,$,N):new Date(e.$y,$,N),e);return s?k:k.endOf(w)},f=function(N,$){return c.w(e.toDate()[N].apply(e.toDate("s"),(s?[0,0,0,0]:[23,59,59,999]).slice($)),e)},l=this.$W,m=this.$M,p=this.$D,x="set"+(this.$u?"UTC":"");switch(o){case h:return s?u(1,0):u(31,11);case g:return s?u(1,m):u(0,m+1);case A:var C=this.$locale().weekStart||0,j=(l<C?l+7:l)-C;return u(s?p-j:p+(6-j),m);case w:case v:return f(x+"Hours",0);case S:return f(x+"Minutes",1);case D:return f(x+"Seconds",2);case M:return f(x+"Milliseconds",3);default:return this.clone()}},n.endOf=function(t){return this.startOf(t,!1)},n.$set=function(t,r){var e,s=c.p(t),o="set"+(this.$u?"UTC":""),u=(e={},e[w]=o+"Date",e[v]=o+"Date",e[g]=o+"Month",e[h]=o+"FullYear",e[S]=o+"Hours",e[D]=o+"Minutes",e[M]=o+"Seconds",e[T]=o+"Milliseconds",e)[s],f=s===w?this.$D+(r-this.$W):r;if(s===g||s===h){var l=this.clone().set(v,1);l.$d[u](f),l.init(),this.$d=l.set(v,Math.min(this.$D,l.daysInMonth())).$d}else u&&this.$d[u](f);return this.init(),this},n.set=function(t,r){return this.clone().$set(t,r)},n.get=function(t){return this[c.p(t)]()},n.add=function(t,r){var e,s=this;t=Number(t);var o=c.p(r),u=function(m){var p=d(s);return c.w(p.date(p.date()+Math.round(m*t)),s)};if(o===g)return this.set(g,this.$M+t);if(o===h)return this.set(h,this.$y+t);if(o===w)return u(1);if(o===A)return u(7);var f=(e={},e[D]=_,e[S]=W,e[M]=b,e)[o]||1,l=this.$d.getTime()+t*f;return c.w(l,this)},n.subtract=function(t,r){return this.add(-1*t,r)},n.format=function(t){var r=this,e=this.$locale();if(!this.isValid())return e.invalidDate||q;var s=t||"YYYY-MM-DDTHH:mm:ssZ",o=c.z(this),u=this.$H,f=this.$m,l=this.$M,m=e.weekdays,p=e.months,x=e.meridiem,C=function($,k,Y,F){return $&&($[k]||$(r,s))||Y[k].slice(0,F)},j=function($){return c.s(u%12||12,$,"0")},N=x||function($,k,Y){var F=$<12?"AM":"PM";return Y?F.toLowerCase():F};return s.replace(X,function($,k){return k||function(Y){switch(Y){case"YY":return String(r.$y).slice(-2);case"YYYY":return c.s(r.$y,4,"0");case"M":return l+1;case"MM":return c.s(l+1,2,"0");case"MMM":return C(e.monthsShort,l,p,3);case"MMMM":return C(p,l);case"D":return r.$D;case"DD":return c.s(r.$D,2,"0");case"d":return String(r.$W);case"dd":return C(e.weekdaysMin,r.$W,m,2);case"ddd":return C(e.weekdaysShort,r.$W,m,3);case"dddd":return m[r.$W];case"H":return String(u);case"HH":return c.s(u,2,"0");case"h":return j(1);case"hh":return j(2);case"a":return N(u,f,!0);case"A":return N(u,f,!1);case"m":return String(f);case"mm":return c.s(f,2,"0");case"s":return String(r.$s);case"ss":return c.s(r.$s,2,"0");case"SSS":return c.s(r.$ms,3,"0");case"Z":return o}return null}($)||o.replace(":","")})},n.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},n.diff=function(t,r,e){var s,o=this,u=c.p(r),f=d(t),l=(f.utcOffset()-this.utcOffset())*_,m=this-f,p=function(){return c.m(o,f)};switch(u){case h:s=p()/12;break;case g:s=p();break;case R:s=p()/3;break;case A:s=(m-l)/6048e5;break;case w:s=(m-l)/864e5;break;case S:s=m/W;break;case D:s=m/_;break;case M:s=m/b;break;default:s=m}return e?s:c.a(s)},n.daysInMonth=function(){return this.endOf(g).$D},n.$locale=function(){return O[this.$L]},n.locale=function(t,r){if(!t)return this.$L;var e=this.clone(),s=I(t,r,!0);return s&&(e.$L=s),e},n.clone=function(){return c.w(this.$d,this)},n.toDate=function(){return new Date(this.valueOf())},n.toJSON=function(){return this.isValid()?this.toISOString():null},n.toISOString=function(){return this.$d.toISOString()},n.toString=function(){return this.$d.toUTCString()},a}(),B=L.prototype;return d.prototype=B,[["$ms",T],["$s",M],["$m",D],["$H",S],["$W",w],["$M",g],["$y",h],["$D",v]].forEach(function(a){B[a[1]]=function(n){return this.$g(n,a[0],a[1])}}),d.extend=function(a,n){return a.$i||(a(n,L,d),a.$i=!0),d},d.locale=I,d.isDayjs=Z,d.unix=function(a){return d(1e3*a)},d.en=O[E],d.Ls=O,d.p={},d})}(z)),z.exports}var ct=ot();const ut=nt(ct);function dt(){const i=at(),{notifications:y,unreadCount:b,activeTab:_,loading:W}=et(i),T=()=>i.fetchNotifications(),M=h=>i.markAsRead(h),D=()=>i.markAllAsRead(),S=h=>i.setActiveTab(h),w=h=>{const v={general:"mdi-information",payment:"mdi-cash",reminder:"mdi-clock"};return v[h]||v.general},A=h=>{const v={general:"info",payment:"success",reminder:"warning"};return v[h]||v.general},g=h=>ut(h).fromNow(),R=()=>{window.Echo&&window.Echo.private("notifications").listen("NotificationEvent",h=>{i.handleNewNotification(h)})};return rt(()=>{T(),R()}),it(()=>{window.Echo&&window.Echo.leave("notifications")}),{notifications:y,unreadCount:b,activeTab:_,loading:W,refresh:T,markAsRead:M,markAllAsRead:D,setActiveTab:S,getNotificationIcon:w,getNotificationColor:A,formatDate:g}}export{ut as d,dt as u};

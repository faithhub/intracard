import{b as e}from"./app-B9jtdv3Q.js";import{_ as t,a as s,x as i,e as a,b as l,V as c,a2 as n,D as o,j as r,h as d,i as u,z as h,g as k,k as g,l as f,n as m,o as p,p as T,r as v,s as b,t as w,a3 as _,A as y,w as C,E as S,a4 as D,y as x,F as $,B as E}from"./main-DhXQbgH3.js";import{z as M,C as V,L as F,O as L,E as R,G as U,v as z,K as j,y as N,H as I,F as A,A as P,D as B,J as q}from"./vendor-DWrK2g1_.js";const O={class:"d-flex flex-column align-end"},Q={class:"text-caption"},G={key:0,class:"ticket-details mb-4"},H={class:"d-flex align-center"},K={class:"text-h6 mb-1"},W={class:"text-body-2 text-grey-darken-1 mb-2"},J={class:"d-flex align-center"},X={class:"text-caption text-grey"},Y={class:"chat-messages"},Z={class:"date-divider"},ee={class:"date-text"},te={key:0,class:"file-message"},se=["href"],ie={class:"text-wrap"},ae={class:"text-subtitle-2"},le={class:"text-caption"},ce={class:"message-text"},ne={class:"message-time"},oe={key:2,class:"file-preview px-4 py-2"},re={class:"file-preview-card"},de={class:"file-info mx-2"},ue={class:"file-name font-weight-medium"},he={class:"text-caption"},ke={class:"closure-section pa-6"},ge={class:"d-flex align-center justify-space-between mb-4"},fe={class:"text-subtitle-2 text-grey mb-4"},me={class:"rating-section my-4"},pe={class:"d-flex justify-center"};const Te=t({data:()=>({showDateFilter:!1,selectedStartDate:null,selectedEndDate:null,showDatePicker:!1,selectedDateRange:null,displayedTickets:[],statusOptions:[{title:"RESOLVED",value:"resolved"},{title:"UNRESOLVED",value:"unresolved"}],showCloseTicketModal:!1,isClosing:!1,closeTicketData:{status:"resolved",reason:"",feedback:"",rating:0},defaultAvatar:"https://via.placeholder.com/40x40.png?text=User",tickets:[],messages:[],user:{id:1},file:null,selectedTicket:null,message:"",newTicket:{subject:"",description:""},selectedStatus:"All",searchQuery:"",showCreateTicketModal:!1,isFormValid:!1,isCreating:!1,isSending:!1,isLoadingTicket:!1,channelSubscriptions:[]}),computed:{isCloseFormValid(){return this.closeTicketData.rating>0&&("unresolved"!==this.closeTicketData.status||!!this.closeTicketData.reason)},filteredTickets(){const e=this.tickets.filter((e=>{const t="All"===this.selectedStatus||e.status.toLowerCase()===this.selectedStatus.toLowerCase(),s=e.subject.toLowerCase().includes(this.searchQuery.toLowerCase())||e.description.toLowerCase().includes(this.searchQuery.toLowerCase()),i=!this.selectedDateRange||this.selectedDateRange.length<2||new Date(e.created_at)>=new Date(this.selectedDateRange[0])&&new Date(e.created_at)<=new Date(this.selectedDateRange[1]);return t&&s&&i}));return console.log("Filtered Tickets:",e),e},formatDate:e=>new Date(e).toLocaleDateString(),groupedMessages(){return this.messages.reduce(((e,t)=>{const s=new Date(t.created_at).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});return e[s]||(e[s]=[]),e[s].push(t),e}),{})},canSendMessage(){var e;return((null==(e=this.message)?void 0:e.trim())||this.file)&&!this.isSending}},watch:{showDateFilter(e){console.log("Menu open state:",e)},selectedDateRange(e){console.log("Selected Date Range:",e)},selectedTicket(e,t){(null==e?void 0:e.id)!==(null==t?void 0:t.id)&&(null==e?void 0:e.uuid)&&this.setupTicketChannels()}},methods:{handleTicketUpdate(t){console.log("Ticket update received:",t),this.selectedTicket&&this.selectedTicket.id===t.id&&(this.selectedTicket.status=t.status,e().info(`Ticket status updated to ${t.status}`));const s=this.tickets.findIndex((e=>e.id===t.id));-1!==s&&(this.tickets[s].status=t.status,this.tickets[s].updated_at=t.updated_at)},handleTicketClosure(t){console.log("Ticket closure received:",t),this.selectedTicket&&this.selectedTicket.id===t.id&&(this.selectedTicket.status=t.status,this.selectedTicket.closure=t.closure,e().info(`Ticket has been marked as ${t.status}`));const s=this.tickets.findIndex((e=>e.id===t.id));-1!==s&&(this.tickets[s].status=t.status)},handleNewMessage(t){var s;if(console.log("New message received:",t),t.sender_id===this.user.id&&"admin"!==t.sender_type)return void console.log("Ignoring own message");if(this.messages.some((e=>e.id===t.id)))return void console.log("Message already in the list");const i={id:t.id,ticket_id:t.ticket_id,sender_id:t.sender_id,sender_name:(null==(s=t.sender)?void 0:s.first_name)?`${t.sender.first_name} ${t.sender.last_name}`.trim():"admin"===t.sender_type?"Support Staff":"Unknown",message:t.message,file_url:t.file_url,file_name:t.file_name,file_size:t.file_size,created_at:t.created_at};this.messages.push(i);const a=this.tickets.findIndex((e=>e.id===t.ticket_id));-1!==a&&(this.tickets[a].last_message=t.message||"File attachment",this.tickets[a].updated_at=t.created_at),e().info("New message received"),this.$nextTick((()=>{this.initChatMessagesScroll()}))},clearExistingListeners(){this.channelSubscriptions&&this.channelSubscriptions.length>0&&(console.log("Cleaning up existing listeners..."),this.channelSubscriptions.forEach((e=>{try{console.log(`Unsubscribing from ${e.name}`),"function"==typeof e.channel.stopListening&&(e.events&&Array.isArray(e.events)?e.events.forEach((t=>{e.channel.stopListening(t)})):e.event&&e.channel.stopListening(e.event)),"function"==typeof e.channel.unsubscribe&&e.channel.unsubscribe()}catch(t){console.error(`Error cleaning up listener ${e.name}:`,t)}})),this.channelSubscriptions=[])},listenForNewTickets(){const t=this.channelSubscriptions.find((e=>"tickets"===e.name));t&&(t.channel.unsubscribe(),this.channelSubscriptions=this.channelSubscriptions.filter((e=>"tickets"!==e.name))),console.log("Subscribing to general tickets channel");try{const t=window.Echo.channel("tickets");t.listen("TicketCreated",(t=>{console.log("New ticket created:",t),t.created_by===this.user.id&&(this.tickets.some((e=>e.id===t.id))||(this.tickets.unshift({...t,avatar:this.defaultAvatar,last_message:t.description||""}),e().info(`New ticket created: ${t.subject}`)))})),this.channelSubscriptions.push({name:"tickets",channel:t,event:"TicketCreated"}),console.log("Tickets listener set up successfully")}catch(s){console.error("Error setting up tickets listener:",s)}},setupTicketChannels(){var t;if(this.channelSubscriptions.filter((e=>{var t;return e.name.startsWith("ticket.")||e.name===`ticket.${null==(t=this.selectedTicket)?void 0:t.uuid}`})).forEach((e=>{e.channel.unsubscribe()})),this.channelSubscriptions=this.channelSubscriptions.filter((e=>{var t;return!e.name.startsWith("ticket.")&&e.name!==`ticket.${null==(t=this.selectedTicket)?void 0:t.uuid}`})),null==(t=this.selectedTicket)?void 0:t.uuid){console.log(`Subscribing to ticket channel: ticket.${this.selectedTicket.uuid}`);try{const t=window.Echo.channel(`ticket.${this.selectedTicket.uuid}`);t.listen(".MessageCreated",(t=>{console.log("New message received:",t),t.sender_id===this.user.id||this.messages.find((e=>e.id===t.id))||(this.messages.push(t),this.$nextTick((()=>{this.initChatMessagesScroll()})),e().info("New message received"))})).error((e=>{console.error("Channel subscription error:",e)})),t.listen("TicketUpdated",(t=>{console.log("Ticket updated:",t),this.selectedTicket.id===t.id&&(this.selectedTicket.status=t.status,e().info(`Ticket status updated to: ${t.status}`),"resolved"!==t.status&&"unresolved"!==t.status||this.selectTicket(this.selectedTicket.id));const s=this.tickets.findIndex((e=>e.id===t.id));-1!==s&&(this.tickets[s].status=t.status)})).error((e=>{console.error("Channel subscription error:",e)})),t.listen("TicketClosed",(t=>{console.log("Ticket closed:",t),this.selectedTicket&&this.selectedTicket.id===t.id&&(this.selectedTicket.status=t.status,this.selectedTicket.closure=t.closure,e().info(`Ticket has been marked as ${t.status}`));const s=this.tickets.findIndex((e=>e.id===t.id));-1!==s&&(this.tickets[s].status=t.status)})).error((e=>{console.error("Channel subscription error:",e)})),this.channelSubscriptions.push({name:`ticket.${this.selectedTicket.uuid}`,channel:t}),console.log(`Successfully subscribed to ticket.${this.selectedTicket.uuid} channel`)}catch(s){console.error(`Failed to subscribe to ticket.${this.selectedTicket.uuid} channel:`,s)}}},listenForNotifications(){const t=this.channelSubscriptions.find((e=>"notifications"===e.name));t&&(t.channel.unsubscribe(),this.channelSubscriptions=this.channelSubscriptions.filter((e=>"notifications"!==e.name))),console.log("Subscribing to notifications channel");try{const t=window.Echo.channel("notifications");t.listen("NotificationEvent",(t=>{console.log("Notification received:",t),e().info(t.message,{timeout:8e3,position:"top-right"})})),this.channelSubscriptions.push({name:"notifications",channel:t,event:"NotificationEvent"}),console.log("Notifications listener set up successfully")}catch(s){console.error("Error setting up notifications listener:",s)}},onDateSelected(){if(this.showDatePicker=!1,this.selectedDateRange&&2===this.selectedDateRange.length){const[e,t]=this.selectedDateRange;this.filterTicketsByDate(e,t)}},filterTicketsByDate(t,s){const i=new Date(t),a=new Date(s);this.displayedTickets=this.tickets.filter((e=>{const t=new Date(e.created_at);return t>=i&&t<=a})),0===this.displayedTickets.length&&e().info("No tickets found for the selected date range")},formatDate:e=>new Date(e).toLocaleDateString(),initChatMessagesScroll(){const e=this.$el.querySelector(".chat-messages");e?e.scrollTop=e.scrollHeight:console.error("chatMessages element not found in DOM")},truncate:(e,t)=>e?e.length>t?e.substring(0,t)+"...":e:"",formatFileSize(e){if(!e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,t)).toFixed(2))} ${["B","KB","MB","GB"][t]}`},formatRelativeTime(e){const t=new Date,s=Math.floor((t-new Date(e))/1e3);return s<60?`${s} seconds ago`:s<3600?`${Math.floor(s/60)} minutes ago`:s<86400?`${Math.floor(s/3600)} hours ago`:`${Math.floor(s/86400)} days ago`},async fetchTickets(){try{const e=await s.get("/api/tickets");this.tickets=e.data.map((e=>{var t,s;return{...e,avatar:e.avatar||this.defaultAvatar,last_message:(null==(s=null==(t=e.messages)?void 0:t.slice(-1)[0])?void 0:s.message)||""}})),this.displayedTickets=this.tickets}catch(t){e().error("Failed to fetch tickets")}},async selectTicket(t){var i;this.isLoadingTicket=!0;try{const e=await s.get(`/api/tickets/${t}`);this.selectedTicket=e.data;const a=await s.get(`/api/tickets/${t}/messages`);this.messages=a.data.map((e=>({...e,sender_name:e.sender_name||"Unknown",message:e.message||"",created_at:e.created_at||""}))),(null==(i=this.selectedTicket)?void 0:i.uuid)&&(this.clearChannelSubscriptions(),this.setupTicketListeners(this.selectedTicket.uuid),this.setupRawEventListener()),this.$nextTick((()=>{this.initChatMessagesScroll()}))}catch(a){e().error("Failed to load ticket")}finally{this.isLoadingTicket=!1}},setupRawEventListener(){var e,t;const s=null==(t=null==(e=window.Echo)?void 0:e.connector)?void 0:t.pusher;s&&s.bind_global(((e,t)=>{(e.includes("Message")||e.includes("message"))&&(console.log(`ðŸ”” Raw Pusher event: ${e}`,t),t&&t.message&&t.ticket_id&&(console.log("This looks like a message, trying to handle it..."),this.handleNewMessage(t)))}))},setupTicketListeners(e){if(console.log(`Setting up listeners for ticket ${e}`),void 0!==window.Echo)try{this.cleanupChannelSubscription(`ticket.${e}`);const t=`ticket.${e}`,s=window.Echo.channel(t);console.log(t),s.error((e=>{console.error(`Channel error on ${t}:`,e)})),s.listen("MessageCreated",(e=>{console.log("MessageCreated event received:",e),this.handleNewMessage(e)})),s.listenToAll(((e,t)=>{console.log(`All ticket events - ${e}:`,t),(e.includes("message")||e.includes("Message"))&&t&&(t.message||t.id)&&this.handleNewMessage(t)})),this.channelSubscriptions.push({name:t,channel:s,events:["MessageCreated"]}),console.log(`Successfully subscribed to ${t}`)}catch(t){console.error(`Error setting up ticket listeners for ${e}:`,t)}else console.error("Echo is not available for ticket listeners")},cleanupChannelSubscription(e){const t=this.channelSubscriptions.findIndex((t=>t.name===e));if(-1!==t){try{console.log(`Cleaning up existing subscription to ${e}`),window.Echo.leave(e)}catch(s){console.warn(`Error leaving channel ${e}:`,s)}this.channelSubscriptions.splice(t,1)}},clearChannelSubscriptions(){this.channelSubscriptions||(this.channelSubscriptions=[]),this.channelSubscriptions.forEach((e=>{if(e.channel&&(Array.isArray(e.events)&&e.events.forEach((t=>{try{e.channel.stopListening(t)}catch(s){}})),"function"==typeof e.channel.leave))try{e.channel.leave()}catch(t){}})),this.channelSubscriptions=[]},logConnectionStatus(){if(window.Echo&&window.Echo.connector&&window.Echo.connector.pusher){const e=window.Echo.connector.pusher.connection.state;if(console.log(`Pusher connection state: ${e}`),"connected"===e){console.log(`Socket ID: ${window.Echo.connector.pusher.connection.socket_id}`);const e=window.Echo.connector.pusher.channels.channels;console.log("Subscribed channels:");for(const t in e)console.log(`- ${t}: ${e[t].subscribed?"Subscribed":"Pending"}`)}}else console.error("Echo or Pusher not properly initialized")},async createTicket(){var t;if(this.isFormValid){this.isCreating=!0;try{const t=await s.post("/api/tickets",this.newTicket);this.tickets.unshift(t.data),this.showCreateTicketModal=!1,this.newTicket={subject:"",description:""},e().success("Ticket created successfully")}catch(i){422===(null==(t=i.response)?void 0:t.status)?Object.entries(i.response.data.errors).forEach((([t,[s]])=>{e().error(`${t}: ${s}`)})):e().error("Failed to create ticket")}finally{this.isCreating=!1}}},getStatusColor(e){switch(e.toLowerCase()){case"resolved":return"success";case"pending":return"warning";case"unresolved":return"error";default:return"grey"}},async sendMessage(){if(this.canSendMessage){this.isSending=!0;try{const e=new FormData;e.append("ticket_id",this.selectedTicket.id),this.message&&e.append("message",this.message),this.file&&e.append("file",this.file);const t=await s.post("/api/tickets/messages",e,{headers:{"Content-Type":"multipart/form-data"}});this.messages.push(t.data),this.message="",this.file=null,this.$refs.fileInput.value=""}catch(t){e().error("Failed to send message")}finally{this.isSending=!1}}},handleFileChange(t){const s=t.target.files[0];s.size>10485760?e().error("File size exceeds the 10MB limit"):this.file=s},removeFile(){this.file=null,this.$refs.fileInput.value=""},async closeTicket2(){if(this.selectedTicket)try{await s.post(`/api/tickets/${this.selectedTicket.id}/close`,{status:"resolved"}),e().success("Ticket closed successfully"),this.fetchTickets()}catch(t){e().error("Failed to close ticket")}},async submitCloseTicket(){var t,i,a,l,c,n;if(this.isCloseFormValid)if("unresolved"!==this.closeTicketData.status||(null==(t=this.closeTicketData.reason)?void 0:t.trim()))if(this.closeTicketData.rating<1)e().error("Please provide a rating");else{this.isClosing=!0;try{const t={status:this.closeTicketData.status,rating:this.closeTicketData.rating,reason:"unresolved"===this.closeTicketData.status?null==(i=this.closeTicketData.reason)?void 0:i.trim():null,feedback:"resolved"===this.closeTicketData.status?null==(a=this.closeTicketData.feedback)?void 0:a.trim():null},l=await s.post(`/api/tickets/${this.selectedTicket.id}/close`,t);if(l.data.error)return void e().error(l.data.error);e().success("Ticket closed successfully"),this.showCloseTicketModal=!1,await this.fetchTickets();const c=await s.get(`/api/tickets/${this.selectedTicket.id}`);this.selectedTicket=c.data}catch(o){if(422===(null==(l=o.response)?void 0:l.status)){const t=o.response.data.errors;Object.values(t).forEach((t=>{t.forEach((t=>e().error(t)))}))}else e().error((null==(n=null==(c=o.response)?void 0:c.data)?void 0:n.error)||"Failed to close ticket")}finally{this.isClosing=!1}}else e().error("Reason is required for unresolved tickets");else e().error("Please complete all required fields")},closeTicket(){this.closeTicketData={status:"resolved",reason:"",feedback:"",rating:0},this.showCloseTicketModal=!0},archiveTicket(){this.selectedTicket&&e().info("Archive ticket functionality is under development")}},mounted(){if(window.Echo&&window.Echo.connector&&window.Echo.connector.pusher){const e=window.Echo.connector.pusher;if(console.log("Echo instance found, socket ID:",window.Echo.socketId()),console.log("Pusher connection state:",e.connection.state),e.bind_global(((e,t)=>{(e.includes("Message")||e.includes("message")||e.startsWith("pusher:"))&&(console.log(`Global Pusher event: ${e}`,t),t&&(t.message||t.id)&&(console.log("This looks like a message event, attempting to process"),"function"==typeof this.handleNewMessage&&this.handleNewMessage(t)))})),console.log(window.Echo,"window.Echo"),window.Echo){const e=window.Echo.channel("ticket.0b07acd7-f834-4182-b2fa-d2cc431ebccc");e.listen("MessageCreated",(e=>{console.log("TEST - Message received!",e),alert("Message received: "+e.message)})),e.listenToAll(((e,t)=>{console.log(`TEST - Event received: ${e}`,t)})),console.log("Test listeners set up successfully")}e.connection.bind("state_change",(e=>{console.log(`Pusher connection changed: ${e.previous} â†’ ${e.current}`)})),e.connection.bind("connected",(()=>{console.log("âœ… Pusher connected! Socket ID:",e.connection.socket_id)})),e.connection.bind("error",(e=>{console.error("âŒ Pusher connection error:",e)}))}else console.error("Echo or Pusher not properly initialized");this.fetchTickets(),this.connectionCheckInterval=setInterval((()=>{this.logConnectionStatus()}),3e4),this.$nextTick((()=>{this.initChatMessagesScroll()}))},beforeUnmount(){this.channelSubscriptions.length>0&&(console.log("Cleaning up channel subscriptions"),this.channelSubscriptions.forEach((e=>{e.channel&&"function"==typeof e.channel.unsubscribe&&(e.channel.unsubscribe(),console.log(`Unsubscribed from ${e.name}`))})),this.channelSubscriptions=[]),this.connectionCheckInterval&&clearInterval(this.connectionCheckInterval)}},[["render",function(e,t,s,Te,ve,be){return F(),M(i,{fluid:"",class:"chat-container"},{default:V((()=>[L(l,{class:"mb-3"},{default:V((()=>[L(a,{cols:"12"},{default:V((()=>t[17]||(t[17]=[R("h2",{class:"text-h4 font-weight-bold"},"Help & Support",-1)]))),_:1})])),_:1}),L(l,null,{default:V((()=>[L(a,{cols:"12",md:"4"},{default:V((()=>[L(c,{elevation:"3",class:"rounded-lg ticket-list"},{default:V((()=>[L(n,{flat:"",color:"primary",class:"rounded-t-lg"},{default:V((()=>[L(o,{class:"text-white"},{default:V((()=>t[18]||(t[18]=[U("Tickets")]))),_:1}),L(r),L(d,{color:"white",class:"m-2",variant:"flat",onClick:t[0]||(t[0]=e=>ve.showCreateTicketModal=!0)},{default:V((()=>[L(u,{start:""},{default:V((()=>t[19]||(t[19]=[U("mdi-plus")]))),_:1}),t[20]||(t[20]=U(" Create "))])),_:1})])),_:1}),L(h,null,{default:V((()=>[L(k,{modelValue:ve.selectedStatus,"onUpdate:modelValue":t[1]||(t[1]=e=>ve.selectedStatus=e),items:["All","Pending","Resolved","Unresolved"],label:"Filter by Status",variant:"outlined",density:"compact",class:"mb-4"},null,8,["modelValue"]),L(g,{modelValue:ve.searchQuery,"onUpdate:modelValue":t[2]||(t[2]=e=>ve.searchQuery=e),label:"Search tickets","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",class:"mb-4"},null,8,["modelValue"]),L(f,{class:"ticket-list-items",style:{"max-height":"calc(90vh - 200px)","overflow-y":"auto"}},{default:V((()=>[(F(!0),z(A,null,j(be.filteredTickets,(e=>{var t;return F(),M(m,{key:e.id,onClick:t=>be.selectTicket(e.id),class:N([{"selected-ticket":(null==(t=ve.selectedTicket)?void 0:t.id)===e.id},"mb-2 rounded-lg"])},{prepend:V((()=>[L(p,{color:"primary",size:"40"},{default:V((()=>{var t;return[U(I((null==(t=e.subject[0])?void 0:t.toUpperCase())||"T"),1)]})),_:2},1024)])),append:V((()=>[R("div",O,[L(T,{color:be.getStatusColor(e.status),size:"small",class:"mb-1 text-capitalize"},{default:V((()=>[U(I(e.status),1)])),_:2},1032,["color"]),R("span",Q,I(be.formatRelativeTime(e.updated_at)),1)])])),default:V((()=>[L(v,{class:"font-weight-medium"},{default:V((()=>[U(I(be.truncate(e.subject,20)),1)])),_:2},1024),L(b,{class:"text-caption"},{default:V((()=>[U(I(be.truncate(e.last_message||e.description,30)),1)])),_:2},1024)])),_:2},1032,["onClick","class"])})),128))])),_:1})])),_:1})])),_:1})])),_:1}),L(a,{cols:"12",md:"8"},{default:V((()=>[L(c,{elevation:"3",class:"chat-section rounded-lg"},{default:V((()=>{var s;return[L(n,{flat:"",color:"primary",class:"rounded-t-lg"},{default:V((()=>[L(o,{class:"text-white"},{default:V((()=>{var e;return[U(I((null==(e=ve.selectedTicket)?void 0:e.subject)||"Select a Ticket"),1)]})),_:1}),L(r),ve.selectedTicket&&"pending"===ve.selectedTicket.status?(F(),M(w,{key:0},{activator:V((({props:e})=>[L(d,P({icon:""},e),{default:V((()=>[L(u,null,{default:V((()=>t[21]||(t[21]=[U("mdi-dots-vertical")]))),_:1})])),_:2},1040)])),default:V((()=>[L(f,null,{default:V((()=>[L(m,{onClick:be.closeTicket},{prepend:V((()=>[L(u,null,{default:V((()=>t[22]||(t[22]=[U("mdi-check-circle")]))),_:1})])),default:V((()=>[L(v,null,{default:V((()=>t[23]||(t[23]=[U("Close Ticket")]))),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})):B("",!0)])),_:1}),ve.selectedTicket?(F(),z("div",G,[L(c,{flat:"",class:"pa-4 bg-grey-lighten-4"},{default:V((()=>[R("div",H,[L(p,{color:"primary",size:"48",class:"mr-4"},{default:V((()=>{var e;return[U(I((null==(e=ve.selectedTicket.subject[0])?void 0:e.toUpperCase())||"T"),1)]})),_:1}),R("div",null,[R("h3",K,I(ve.selectedTicket.subject),1),R("p",W,I(ve.selectedTicket.description),1),R("div",J,[L(T,{color:be.getStatusColor(ve.selectedTicket.status),size:"small",class:"mr-2 text-capitalize"},{default:V((()=>[U(I(ve.selectedTicket.status),1)])),_:1},8,["color"]),R("span",X,"Created "+I(be.formatRelativeTime(ve.selectedTicket.created_at)),1)])])])])),_:1})])):B("",!0),ve.isLoadingTicket?(F(),M(_,{key:1,indeterminate:"",color:"primary"})):B("",!0),R("div",Y,[(F(!0),z(A,null,j(be.groupedMessages,((e,s)=>(F(),z(A,{key:s},[R("div",Z,[t[24]||(t[24]=R("div",{class:"date-line"},null,-1)),R("span",ee,I(s),1),t[25]||(t[25]=R("div",{class:"date-line"},null,-1))]),(F(!0),z(A,null,j(e,(e=>(F(),z("div",{key:e.id,class:N(["message-wrapper",{"message-sent":e.sender_id===ve.user.id}])},[L(c,{color:e.sender_id===ve.user.id?"primary":"grey-lighten-4",class:N({"message-bubble":!0})},{default:V((()=>[L(h,{class:N({"text-white":e.sender_id===ve.user.id})},{default:V((()=>[e.file_url?(F(),z("div",te,[L(c,{flat:"",color:e.sender_id===ve.user.id?"primary-lighten-1":"grey-lighten-3",class:"pa-2"},{default:V((()=>[R("a",{href:e.file_url,target:"_blank",class:"file-link d-flex align-center"},[L(u,{color:e.sender_id===ve.user.id?"white":"primary",class:"mr-2"},{default:V((()=>t[26]||(t[26]=[U(" mdi-file-document-outline ")]))),_:2},1032,["color"]),R("div",ie,[R("div",ae,I(e.file_name),1),R("div",le,I(be.formatFileSize(e.file_size)),1)])],8,se)])),_:2},1032,["color"])])):B("",!0),R("div",ce,I(e.message),1),R("span",ne,I(be.formatRelativeTime(e.created_at)),1)])),_:2},1032,["class"])])),_:2},1032,["color"])],2)))),128))],64)))),128))]),ve.file?(F(),z("div",oe,[R("div",re,[L(u,{color:"primary",size:"24"},{default:V((()=>t[27]||(t[27]=[U("mdi-file")]))),_:1}),R("div",de,[R("span",ue,I(ve.file.name),1),R("small",he,I((ve.file.size/1024).toFixed(2))+" KB",1)]),L(d,{icon:"",size:"small",color:"error",onClick:be.removeFile},{default:V((()=>[L(u,null,{default:V((()=>t[28]||(t[28]=[U("mdi-close")]))),_:1})])),_:1},8,["onClick"])])])):B("",!0),R("input",{type:"file",ref:"fileInput",class:"d-none",onChange:t[3]||(t[3]=(...e)=>be.handleFileChange&&be.handleFileChange(...e))},null,544),ve.selectedTicket&&"pending"===ve.selectedTicket.status?(F(),M(y,{key:3,class:"chat-input pa-4"},{default:V((()=>[L(d,{icon:"",onClick:t[4]||(t[4]=t=>e.$refs.fileInput.click())},{default:V((()=>[L(u,null,{default:V((()=>t[29]||(t[29]=[U("mdi-paperclip")]))),_:1})])),_:1}),L(C,{modelValue:ve.message,"onUpdate:modelValue":t[5]||(t[5]=e=>ve.message=e),rows:"1","auto-grow":"","hide-details":"",variant:"outlined",density:"compact",class:"mx-4",placeholder:"Type a message..."},null,8,["modelValue"]),L(d,{loading:ve.isSending,disabled:!be.canSendMessage,color:"primary",icon:"",onClick:be.sendMessage},{default:V((()=>[L(u,null,{default:V((()=>t[30]||(t[30]=[U("mdi-send")]))),_:1})])),_:1},8,["loading","disabled","onClick"])])),_:1})):B("",!0),R("div",ke,[ve.selectedTicket&&"pending"!==ve.selectedTicket.status?(F(),M(S,{key:0,color:"resolved"===ve.selectedTicket.status?"success":"error",icon:"resolved"===ve.selectedTicket.status?"mdi-check-circle":"mdi-alert-circle",variant:"tonal",class:"mb-6"},{default:V((()=>[U(" This ticket is "+I(ve.selectedTicket.status)+". No new messages can be sent. ",1)])),_:1},8,["color","icon"])):B("",!0),(null==(s=ve.selectedTicket)?void 0:s.closure)?(F(),M(c,{key:1,variant:"outlined",class:"closure-details pa-4"},{default:V((()=>[R("div",ge,[t[31]||(t[31]=R("div",{class:"text-h6"},"Ticket Closure Details",-1)),L(T,{color:"resolved"===ve.selectedTicket.status?"success":"error",size:"small",variant:"elevated"},{default:V((()=>[U(I(ve.selectedTicket.status.toUpperCase()),1)])),_:1},8,["color"])]),R("div",fe,[L(u,{size:"small",class:"mr-1"},{default:V((()=>t[32]||(t[32]=[U("mdi-clock-outline")]))),_:1}),U(" Closed "+I(be.formatRelativeTime(ve.selectedTicket.closure.created_at)),1)]),ve.selectedTicket.closure.reason?(F(),z(A,{key:0},[t[33]||(t[33]=R("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Reason",-1)),L(h,{class:"pa-3 bg-grey-lighten-4 rounded mb-4"},{default:V((()=>[U(I(ve.selectedTicket.closure.reason),1)])),_:1})],64)):B("",!0),ve.selectedTicket.closure.feedback?(F(),z(A,{key:1},[t[34]||(t[34]=R("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Feedback",-1)),L(h,{class:"pa-3 bg-grey-lighten-4 rounded mb-4"},{default:V((()=>[U(I(ve.selectedTicket.closure.feedback),1)])),_:1})],64)):B("",!0),ve.selectedTicket.closure.rating?(F(),z(A,{key:2},[t[35]||(t[35]=R("div",{class:"text-subtitle-1 font-weight-medium mb-2"},"Rating",-1)),L(D,{"model-value":ve.selectedTicket.closure.rating,color:"amber",readonly:"","half-increments":"",size:"small"},null,8,["model-value"])],64)):B("",!0)])),_:1})):B("",!0)])]})),_:1})])),_:1})])),_:1}),L(E,{modelValue:ve.showCreateTicketModal,"onUpdate:modelValue":t[10]||(t[10]=e=>ve.showCreateTicketModal=e),"max-width":"500px"},{default:V((()=>[L(c,null,{default:V((()=>[L(x,null,{default:V((()=>t[36]||(t[36]=[U("Create Ticket")]))),_:1}),L(h,null,{default:V((()=>[L($,{ref:"form",modelValue:ve.isFormValid,"onUpdate:modelValue":t[8]||(t[8]=e=>ve.isFormValid=e),onSubmit:q(be.createTicket,["prevent"])},{default:V((()=>[L(g,{modelValue:ve.newTicket.subject,"onUpdate:modelValue":t[6]||(t[6]=e=>ve.newTicket.subject=e),rules:[e=>!!e||"Subject is required"],label:"Subject",required:"",clearable:""},null,8,["modelValue","rules"]),L(C,{modelValue:ve.newTicket.description,"onUpdate:modelValue":t[7]||(t[7]=e=>ve.newTicket.description=e),rules:[e=>!!e||"Description is required"],label:"Description",required:"",clearable:""},null,8,["modelValue","rules"])])),_:1},8,["modelValue","onSubmit"])])),_:1}),L(y,null,{default:V((()=>[L(r),L(d,{text:"",onClick:t[9]||(t[9]=e=>ve.showCreateTicketModal=!1)},{default:V((()=>t[37]||(t[37]=[U("Cancel")]))),_:1}),L(d,{color:"primary",variant:"elevated",loading:ve.isCreating,disabled:!ve.isFormValid,onClick:be.createTicket},{default:V((()=>t[38]||(t[38]=[U(" Create ")]))),_:1},8,["loading","disabled","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),L(E,{modelValue:ve.showCloseTicketModal,"onUpdate:modelValue":t[16]||(t[16]=e=>ve.showCloseTicketModal=e),"max-width":"500px"},{default:V((()=>[L(c,null,{default:V((()=>[L(x,null,{default:V((()=>t[39]||(t[39]=[U("Close Ticket")]))),_:1}),L(h,null,{default:V((()=>[L(k,{modelValue:ve.closeTicketData.status,"onUpdate:modelValue":t[11]||(t[11]=e=>ve.closeTicketData.status=e),items:ve.statusOptions,label:"Status",required:""},null,8,["modelValue","items"]),"unresolved"===ve.closeTicketData.status?(F(),M(C,{key:0,modelValue:ve.closeTicketData.reason,"onUpdate:modelValue":t[12]||(t[12]=e=>ve.closeTicketData.reason=e),label:"Reason",required:""},null,8,["modelValue"])):B("",!0),R("div",me,[t[40]||(t[40]=R("div",{class:"text-subtitle-1 mb-2"},"Rate your experience",-1)),R("div",pe,[L(D,{modelValue:ve.closeTicketData.rating,"onUpdate:modelValue":t[13]||(t[13]=e=>ve.closeTicketData.rating=e),color:"amber","active-color":"amber",hover:"",size:"large"},null,8,["modelValue"])])]),"resolved"===ve.closeTicketData.status?(F(),M(C,{key:1,modelValue:ve.closeTicketData.feedback,"onUpdate:modelValue":t[14]||(t[14]=e=>ve.closeTicketData.feedback=e),label:"Additional Feedback (Optional)"},null,8,["modelValue"])):B("",!0)])),_:1}),L(y,null,{default:V((()=>[L(r),L(d,{text:"",onClick:t[15]||(t[15]=e=>ve.showCloseTicketModal=!1)},{default:V((()=>t[41]||(t[41]=[U("Cancel")]))),_:1}),L(d,{color:"primary",loading:ve.isClosing,disabled:!be.isCloseFormValid,onClick:be.submitCloseTicket},{default:V((()=>t[42]||(t[42]=[U("Close Ticket")]))),_:1},8,["loading","disabled","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}]]);export{Te as default};

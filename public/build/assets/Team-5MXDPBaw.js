import{b as e,u as t,s as a,e as s}from"./app-B9jtdv3Q.js";import{u as r}from"./useNotifications-htJGVcCc.js";import{v as i,O as o,C as n,F as l,L as m,G as d,H as u,E as c,D as h,z as b,y as g,K as p,J as f}from"./vendor-DWrK2g1_.js";import{_ as M,x as v,B as w,V as A,y as F,z as _,h as y,$ as C,p as x,a1 as N,A as E,j as T,E as V,F as D,e as k,k as P,b as S,g as I,G as U}from"./main-DhXQbgH3.js";const R={class:"amount-cell"},O={class:"amount-cell"},$={key:0,class:"d-flex gap-2"},L={class:"text-decoration-line-through grey--text"},q={key:1};const B=M({setup(){const s=e(),r=t(),{user:i}=a(r);return{authStore:r,user:i,toast:s}},data(){const{unreadCount:e,refresh:t}=r();return{refreshNotifications:t,isTableLoading:!1,isFormValid:!1,errorMessage:"",originalMembers:[],editableMembers:[],originalNewMember:{firstName:"",lastName:"",email:"",percentage:0,amount:0},accountGoal:"",totalAmount:0,team:{name:"Development Team"},team:{},teamMembers:[],isSubmitting:!1,tableHeaders:[{text:"SN",value:"index",align:"center",width:"50px"},{text:"Name",value:"name"},{text:"Email",value:"email"},{text:"Role",value:"role"},{text:"Status",value:"status"},{text:"Percentage",value:"percentage"},{text:"Amount",value:"amount"},{text:"Actions",value:"actions",sortable:!1}],currentMode:null,editableMembers:this.teamMembers,rules:{required:e=>null!=e&&""!==e||"This field is required.",email:e=>!e||(/.+@.+\..+/.test(e)||"Enter a valid email address."),positiveNumber:e=>{if(!e)return!0;const t=String(e).replace(/[^0-9.]/g,"");if(""===t)return"The amount must be a positive number.";return parseFloat(t)>0||"The amount must be a positive number."},positivePercentage:e=>{if(null==e||""===e)return"This field is required.";const t=parseFloat(e);return isNaN(t)?"Please enter a valid number":t>=1&&t<=100||"Percentage must be between 1 and 100."}},showEditAmountsModal:!1,showModal:!1,showAdminLeaveModal:!1,editMode:!1,newAdminUuid:null,newMemberForm:{firstName:"",lastName:"",email:"",percentage:0,amount:0},modalForm:{uuid:null,firstName:"",lastName:"",email:"",role:"member",status:"pending",amount:0},showResendConfirmDialog:!1,selectedMember:null,showDissolveModal:!1,verificationCode:"",dissolveConfirmed:!1,isPromoting:!1,isDissolving:!1,adminSelectError:"",codeError:"",checkboxError:""}},computed:{isCurrentUserAdmin(){var e;const t=null==(e=this.user)?void 0:e.id;return!(!t||!this.teamAdmin)&&this.teamAdmin.user_id===t},sortedTeamMembers(){return[...this.teamMembers].sort(((e,t)=>"admin"===e.role&&"admin"!==t.role?-1:"admin"!==e.role&&"admin"===t.role?1:"accepted"===e.status&&"accepted"!==t.status?-1:"accepted"!==e.status&&"accepted"===t.status?1:0))},teamAdmin(){return this.teamMembers.find((e=>"admin"===e.role))},activeMembers(){return this.teamMembers.filter((e=>"accepted"===e.status))},acceptedMembers(){return this.teamMembers.filter((e=>"accepted"===e.status))},remainingBalance(){return this.totalAmount-this.totalAssigned},remainingBalance(){return this.totalAmount-this.totalAssigned},totalAssignedAmount(){return this.activeMembers.reduce(((e,t)=>e+t.amount),0)},totalAssigned(){if(this.showEditAmountsModal){let e=this.editableMembers.reduce(((e,t)=>e+(t.amount||0)),0);return"add"===this.currentMode&&this.newMemberForm.amount&&(e+=this.newMemberForm.amount),e}return this.acceptedMembers.reduce(((e,t)=>e+(t.amount||0)),0)},totalAssignedPercentage(){if(this.showEditAmountsModal){let e=this.editableMembers.reduce(((e,t)=>e+(t.percentage||0)),0);return"add"===this.currentMode&&this.newMemberForm.percentage&&(e+=this.newMemberForm.percentage),e}return this.totalAssigned/this.totalAmount*100},remainingBalance(){return this.totalAmount-this.totalAssigned},remainingBalancePercentage(){return this.showEditAmountsModal?100-this.totalAssignedPercentage:this.remainingBalance/this.totalAmount*100},promotableMembers(){return this.teamMembers.filter((e=>"accepted"===e.status&&"member"===e.role)).map((e=>({uuid:e.uuid,title:e.name,subtitle:e.email})))},isFormValid(){return this.newMemberForm.firstName&&this.newMemberForm.lastName&&this.newMemberForm.email&&this.newMemberForm.percentage>0},calculatedNewMemberAmount(){return console.log(this.newMemberForm),this.newMemberForm.amount?(console.log(this.newMemberForm.amount),this.newMemberForm.amount):"0.00"}},methods:{updateAmountFromPercentage(e){const t=e===this.newMemberForm;("number"!=typeof e.percentage||isNaN(e.percentage))&&(e.percentage=0);const a=parseFloat(e.percentage)||0,s=a/100*this.totalAmount;t?(this.newMemberForm.percentage=a,this.newMemberForm.amount=parseFloat(s.toFixed(2))):e.amount=parseFloat(s.toFixed(2))},async validateForm(){const e=this.$refs.addMemberForm;if(this.errorMessage="",!e)return!1;return await e.validate()},async submitChangesOld(){var e,t;if(this.isCurrentUserAdmin){if("add"===this.currentMode){if(!(await this.validateForm()).valid)return}if(this.validatePercentageTotal())try{this.isSubmitting=!0,"add"===this.currentMode?await this.addNewMember():"remove"===this.currentMode?await this.removeMember(this.selectedMember):await this.adjustPercentages(),await this.fetchTeamData(),this.closeEditAmountsModal(),this.isSubmitting=!1}catch(a){this.isSubmitting=!1,this.teamMembers=JSON.parse(JSON.stringify(this.originalMembers)),this.toast.error((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error saving changes")}else this.toast.error("Total percentage must equal 100%")}else this.toast.error("Only team admin can perform this action")},async submitChanges(){var e,t;if(this.isCurrentUserAdmin){if("add"===this.currentMode){if(!(await this.validateForm()).valid)return}if(this.validatePercentageTotal())try{this.isSubmitting=!0;let e=!1;if(e="add"===this.currentMode?await this.addNewMember():"remove"===this.currentMode?await this.removeMember():await this.adjustPercentages(),!e)throw new Error("Operation failed");await this.refreshNotifications(),this.isSubmitting=!1}catch(a){this.toast.error((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error saving changes")}finally{this.isSubmitting=!1}else this.toast.error("Total percentage must equal 100%")}else this.toast.error("Only team admin can perform this action")},async fetchTeamDataOld(){try{const e=await s.get("/api/team/members");e.data.team&&(this.team=e.data.team,this.accountGoal=e.data.totalAmount.user.account_goal,this.totalAmount=parseFloat(e.data.totalAmount.amount||0),this.teamMembers=e.data.team.team_members.map((e=>({...e,percentage:parseFloat(e.percentage||0),amount:this.calculateMemberAmount(parseFloat(e.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:null}))))}catch(e){this.toast.error("Error fetching team data"),console.error("Error:",e)}},async fetchTeamData2(){var e,t;try{this.isTableLoading=!0;const e=await s.get("/api/team/members");return!!e.data.team&&(this.team=e.data.team,this.accountGoal=e.data.totalAmount.user.account_goal,this.totalAmount=parseFloat(e.data.totalAmount.amount||0),this.teamMembers=e.data.team.team_members.map((e=>({...e,percentage:parseFloat(e.percentage||0),amount:this.calculateMemberAmount(parseFloat(e.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:e.last_invite_sent_at?new Date(e.last_invite_sent_at).getTime()+18e6:null}))),this.teamMembers.sort(((e,t)=>"admin"===e.role?-1:"admin"===t.role?1:"accepted"===e.status&&"accepted"!==t.status?-1:"accepted"!==e.status&&"accepted"===t.status?1:0)),await this.refreshNotifications(),!0)}catch(a){return this.toast.error((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error fetching team data"),console.error("Error:",a),!1}finally{this.isTableLoading=!1}},async fetchTeamData(){var e,t,a,r,i;try{this.isTableLoading=!0;const r=await s.get("/api/team/members");return r.data.team?(this.team=r.data.team,r.data.totalAmount?(this.accountGoal=(null==(t=null==(e=r.data.totalAmount)?void 0:e.user)?void 0:t.account_goal)||"",this.totalAmount=parseFloat((null==(a=r.data.totalAmount)?void 0:a.amount)||0),this.team.address_id?(this.teamMembers=r.data.team.team_members.map((e=>({...e,percentage:parseFloat(e.percentage||0),amount:this.calculateMemberAmount(parseFloat(e.percentage||0),this.totalAmount||0),isResending:!1,nextInviteTime:e.last_invite_sent_at?new Date(e.last_invite_sent_at).getTime()+18e6:null}))),this.teamMembers.sort(((e,t)=>"admin"===e.role?-1:"admin"===t.role?1:"accepted"===e.status&&"accepted"!==t.status?-1:"accepted"!==e.status&&"accepted"===t.status?1:0)),await this.refreshNotifications(),!0):(this.toast.warning("Please add address details to manage team contributions"),this.teamMembers=[],!1)):(this.toast.warning("Please add address details to manage team contributions"),this.accountGoal="",this.totalAmount=0,this.teamMembers=[],!1)):(this.toast.warning("No team data found"),!1)}catch(o){return this.toast.error((null==(i=null==(r=o.response)?void 0:r.data)?void 0:i.message)||"Error fetching team data"),console.error("Error:",o),!1}finally{this.isTableLoading=!1}},async addNewMember(){var e,t;try{const e=this.editableMembers.map((e=>({uuid:e.uuid,percentage:e.percentage,amount:e.amount}))),t=await s.post("/api/team/members",{name:`${this.newMemberForm.firstName} ${this.newMemberForm.lastName}`,email:this.newMemberForm.email,percentage:this.newMemberForm.percentage,amount:this.newMemberForm.amount,members_percentages:e});if("success"===t.data.status){if(this.toast.success(t.data.message||"New member added successfully"),this.closeEditAmountsModal(),t.data.team){this.team=t.data.team;const e=t.data.team.team_members.map((e=>({...e,percentage:parseFloat(e.percentage||0),amount:this.calculateMemberAmount(parseFloat(e.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:null})));this.teamMembers=[...e]}return!0}throw new Error(t.data.message||"Failed to add member")}catch(a){const s=(null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||a.message||"Error adding new member";return this.toast.error(s),console.error("Add member error:",a),!1}},async removeMember(){var e,t;try{if(!this.selectedMember)return void this.toast.error("No member selected for removal");const e=this.editableMembers.map((e=>({uuid:e.uuid,percentage:e.percentage,amount:e.amount}))),t=await s.delete("/api/team/members",{data:{member_uuid:this.selectedMember.uuid,members_percentages:e}});if("success"===t.data.status){if(this.toast.success(`${this.selectedMember.name} has been removed from the team`),this.closeEditAmountsModal(),t.data.team){this.team=t.data.team;const e=t.data.team.team_members.map((e=>({...e,percentage:parseFloat(e.percentage||0),amount:this.calculateMemberAmount(parseFloat(e.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:null})));this.teamMembers=[...e]}return!0}throw new Error(t.data.message||"Failed to remove member")}catch(a){console.error("Remove member error:",a),this.toast.error((null==(t=null==(e=a.response)?void 0:e.data)?void 0:t.message)||"Error removing member from team")}},async adjustPercentages(){try{const e=this.editableMembers.map((e=>({uuid:e.uuid,percentage:e.percentage,amount:e.amount}))),t=await s.put("/api/team/members/percentages",{members_percentages:e});if("success"===t.data.status&&t.data.team){this.team=t.data.team;const e=t.data.team.team_members.map((e=>({...e,percentage:parseFloat(e.percentage||0),amount:this.calculateMemberAmount(parseFloat(e.percentage||0),this.totalAmount),isResending:!1,nextInviteTime:null})));return this.teamMembers=[...e],this.toast.success(t.data.message||"Percentages updated successfully"),!0}return!1}catch(e){return e.response?this.toast.error(e.response.data.message||"Error updating percentages"):this.toast.error("Network error occurred"),console.error("Adjust percentages error:",e),!1}},formatToCAD:e=>new Intl.NumberFormat("en-CA",{style:"currency",currency:"CAD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),calculateMemberAmount(e,t){if(!e||!t)return 0;return parseFloat((e/100*t).toFixed(2))},getStatusColor(e){switch(e){case"accepted":return"success";case"pending":return"warning";case"declined":return"error";default:return"grey"}},capitalizeFirst:e=>e?e.charAt(0).toUpperCase()+e.slice(1):"",getResendButtonText(e){if(e.nextInviteTime&&new Date<new Date(e.nextInviteTime)){return`Wait ${this.getTimeLeft(e.nextInviteTime)}`}return"Resend Invite"},getTimeLeft(e){const t=new Date(e)-new Date;return`${Math.floor(t/36e5)}h ${Math.floor(t%36e5/6e4)}m`},confirmResendInvite(e){this.isCurrentUserAdmin?(this.selectedMember=e,this.showResendConfirmDialog=!0):this.toast.error("Only team admin can perform this action")},async resendInvite(){if(this.isCurrentUserAdmin){if(this.selectedMember)try{this.selectedMember.isResending=!0,await s.post("/api/team/members/resend-invite",{member_uuid:this.selectedMember.uuid}),this.selectedMember.nextInviteTime=new Date(Date.now()+18e6).toISOString(),this.toast.success(`Invite resent to ${this.selectedMember.email}`)}catch(e){this.toast.error("Error resending invite"),console.error("Error:",e)}finally{this.selectedMember.isResending=!1,this.showResendConfirmDialog=!1,this.selectedMember=null}}else this.toast.error("Only team admin can perform this action")},openModal(e,t=null){this.isCurrentUserAdmin?(this.currentMode=e,this.originalMembers=JSON.parse(JSON.stringify(this.teamMembers)),"add"===e?(this.newMemberForm={...this.originalNewMember},this.editableMembers=JSON.parse(JSON.stringify(this.teamMembers))):"remove"===e?(this.editableMembers=this.teamMembers.filter((e=>e.uuid!==t.uuid)).map((e=>({...e}))),this.selectedMember={...t}):this.editableMembers=JSON.parse(JSON.stringify(this.teamMembers)),this.showEditAmountsModal=!0):this.toast.error("Only team admin can perform this action")},validatePercentageTotal(){var e;let t=this.editableMembers.reduce(((e,t)=>e+(parseFloat(null==t?void 0:t.percentage)||0)),0);if("add"===this.currentMode){t+=parseFloat(null==(e=this.newMemberForm)?void 0:e.percentage)||0}return Math.abs(t-100)<.01},async addNewMemberOld(){const e=this.editableMembers.map((e=>({uuid:e.uuid,percentage:e.percentage,amount:e.amount})));await s.post("/api/team/members",{name:`${this.newMemberForm.firstName} ${this.newMemberForm.lastName}`,email:this.newMemberForm.email,percentage:this.newMemberForm.percentage,amount:this.newMemberForm.amount,members_percentages:e})},sendInvite(){const e=this.editableMembers.find((e=>e.email===this.newMemberForm.email));this.teamMembers.push(e),this.toast.success(`Invite sent to ${e.email}`)},updateContributions(){this.teamMembers=[...this.editableMembers],this.toast.success("Contributions updated successfully.")},sanitizeInput(e){const t=this.modalForm[e];this.modalForm[e]=null!=t&&""!==t?String(t).replace(/[^0-9.]/g,""):""},sanitizeAmount(e){("number"!=typeof e.amount||isNaN(e.amount))&&(e.amount=0)},sanitizePercentage(e){e.percentage<0?e.percentage=0:e.percentage>100&&(e.percentage=100)},async editMember(e){this.showModal=!0,this.editMode=!0,this.modalForm={...e}},openAddMemberModal(){this.showModal=!0,this.editMode=!1,this.modalForm={uuid:null,firstName:"",lastName:"",email:"",role:"member",status:"pending",amount:0}},closeModal(){this.showModal=!1,this.$refs.form.reset()},closeEditAmountsModal(){this.showEditAmountsModal=!1,this.teamMembers=JSON.parse(JSON.stringify(this.originalMembers)),this.newMemberForm={...this.originalNewMember},this.currentMode=null,this.editableMembers=[]},validateAmountDistribution(){const e=this.totalAssignedAmount;e!==this.totalAmount&&this.toast.warning(`Total assigned amount (${e}) does not match the rent/mortgage amount (${this.totalAmount}). Please adjust!`)},openAdminLeaveModal(){this.isCurrentUserAdmin?this.showAdminLeaveModal=!0:this.toast.error("Only team admin can perform this action")},closeAdminLeaveModal(){this.showAdminLeaveModal=!1,this.newAdminUuid=null},async promoteNewAdmin(){if(this.newAdminUuid)try{this.isPromoting=!0;const e=await s.post("/api/team/admin/transfer",{new_admin_uuid:this.newAdminUuid});e.data.success&&(await this.fetchTeamData(),this.toast.success(e.data.message),this.closeAdminLeaveModal())}catch(e){this.handleError(e)}finally{this.isPromoting=!1}else this.adminSelectError="Please select a new admin"},showDissolveConfirmation(){this.showDissolveModal=!0,s.post("/api/team/dissolve/code")},handleError(e){var t,a,s,r,i,o,n,l;(null==(s=null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.errors)?void 0:s.new_admin_uuid)?this.adminSelectError=e.response.data.errors.new_admin_uuid[0]:(null==(o=null==(i=null==(r=e.response)?void 0:r.data)?void 0:i.errors)?void 0:o.verification_code)?this.codeError=e.response.data.errors.verification_code[0]:this.toast.error((null==(l=null==(n=e.response)?void 0:n.data)?void 0:l.message)||"An error occurred")},closeDissolveModal(){this.showDissolveModal=!1,this.verificationCode="",this.dissolveConfirmed=!1,this.codeError="",this.checkboxError=""},async confirmDissolveTeam(){if(this.dissolveConfirmed)if(this.verificationCode)try{this.isDissolving=!0;const e=await s.post("/api/team/dissolve",{verification_code:this.verificationCode});e.data.success&&(await this.fetchTeamData(),this.toast.success(e.data.message),this.closeDissolveModal(),this.closeAdminLeaveModal(),this.$router.push("/dashboard"))}catch(e){this.handleError(e)}finally{this.isDissolving=!1}else this.codeError="Verification code is required";else this.checkboxError="You must confirm this action"},clearAdminError(){this.adminSelectError=""},numericOnly(e){let t=String.fromCharCode(e.keyCode);if(/^[0-9]$/.test(t)&&this.verificationCode.length<6)return!0;e.preventDefault()},clearCodeError(){this.codeError="",this.verificationCode=this.verificationCode.replace(/[^0-9]/g,"").substring(0,6)},clearCheckboxError(){this.checkboxError=""}},mounted(){this.fetchTeamData(),console.log("Promotable Members:",this.promotableMembers)}},[["render",function(e,t,a,s,r,M){return m(),i(l,null,[o(v,null,{default:n((()=>[o(A,{class:"mb-4"},{default:n((()=>[o(F,null,{default:n((()=>[d("Team: "+u(M.capitalizeFirst(r.accountGoal)),1)])),_:1}),o(_,null,{default:n((()=>{var e;return[c("p",null,[t[17]||(t[17]=d("Total Amount: ")),c("b",R,u(M.formatToCAD(r.totalAmount.toFixed(2))),1)]),c("p",null,"Admin: "+u((null==(e=M.teamAdmin)?void 0:e.name)||"No Admin Assigned"),1),M.isCurrentUserAdmin?(m(),i(l,{key:0},[o(y,{color:"purple",rounded:"lg",class:"m-2",onClick:t[0]||(t[0]=e=>M.openModal("add"))},{default:n((()=>t[18]||(t[18]=[d("Add New Member")]))),_:1}),o(y,{color:"purple",rounded:"lg",class:"m-2",onClick:t[1]||(t[1]=e=>M.openModal("adjust"))},{default:n((()=>t[19]||(t[19]=[d("Adjust Amounts")]))),_:1}),o(y,{color:"red",rounded:"lg",class:"m-2",onClick:M.openAdminLeaveModal},{default:n((()=>t[20]||(t[20]=[d("Leave Team")]))),_:1},8,["onClick"])],64)):h("",!0)]})),_:1})])),_:1}),(m(),b(N,{headers:r.tableHeaders,loading:r.isTableLoading,"loading-text":"Loading team members...",items:r.teamMembers,"item-value":"uuid",class:"elevation-1",key:r.teamMembers.length},{loading:n((()=>[o(C,{type:"table-row",class:"my-2"})])),"item.index":n((({index:e})=>[d(u(e+1),1)])),"item.role":n((({item:e})=>[d(u(M.capitalizeFirst(e.role)),1)])),"item.status":n((({item:e})=>[o(x,{color:M.getStatusColor(e.status),text:M.capitalizeFirst(e.status),small:""},null,8,["color","text"])])),"item.percentage":n((({item:e})=>[d(u(e.percentage)+"% ",1)])),"item.amount":n((({item:e})=>[c("span",O,u(M.formatToCAD(parseFloat(e.amount).toFixed(2))),1)])),"item.actions":n((({item:e})=>[M.isCurrentUserAdmin?(m(),i("div",$,["pending"===e.status?(m(),b(y,{key:0,size:"x-small",color:"primary",loading:e.isResending,disabled:e.nextInviteTime&&new Date<new Date(e.nextInviteTime),onClick:t=>M.confirmResendInvite(e)},{default:n((()=>[d(u(M.getResendButtonText(e)),1)])),_:2},1032,["loading","disabled","onClick"])):h("",!0),o(y,{size:"x-small",color:"error",disabled:"admin"===e.role,onClick:t=>M.openModal("remove",e)},{default:n((()=>t[21]||(t[21]=[d(" Remove ")]))),_:2},1032,["disabled","onClick"])])):h("",!0)])),_:1},8,["headers","loading","items"])),o(w,{modelValue:r.showResendConfirmDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>r.showResendConfirmDialog=e),"max-width":"400px"},{default:n((()=>[o(A,null,{default:n((()=>[o(F,null,{default:n((()=>t[22]||(t[22]=[d("Confirm Resend Invite")]))),_:1}),o(_,null,{default:n((()=>{var e;return[d(" Are you sure you want to resend invite to "+u(null==(e=r.selectedMember)?void 0:e.email)+"? ",1)]})),_:1}),o(E,null,{default:n((()=>[o(T),o(y,{color:"primary",onClick:M.resendInvite},{default:n((()=>t[23]||(t[23]=[d("Yes")]))),_:1},8,["onClick"]),o(y,{color:"grey",onClick:t[2]||(t[2]=e=>r.showResendConfirmDialog=!1)},{default:n((()=>t[24]||(t[24]=[d("No")]))),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),o(w,{modelValue:r.showEditAmountsModal,"onUpdate:modelValue":t[11]||(t[11]=e=>r.showEditAmountsModal=e),persistent:"","max-width":"700px"},{default:n((()=>[o(A,null,{default:n((()=>[o(F,null,{default:n((()=>[d(u("add"===r.currentMode?"Add New Member":"remove"===r.currentMode?"Remove Member":"Adjust Contributions"),1)])),_:1}),o(_,null,{default:n((()=>["remove"===r.currentMode?(m(),b(V,{key:0,type:"warning",color:"warning",class:"mb-4",variant:"tonal"},{default:n((()=>{var e,a;return[t[25]||(t[25]=d(" Please redistribute ")),c("strong",null,u(null==(e=r.selectedMember)?void 0:e.name)+"'s",1),d(" percentage ("+u(null==(a=r.selectedMember)?void 0:a.percentage)+"%) among remaining members. Total must equal 100% to proceed. ",1)]})),_:1})):h("",!0),c("div",null,[c("p",null,[t[26]||(t[26]=c("strong",null,"Total Rent/Mortgage:",-1)),d(" $"+u(r.totalAmount.toFixed(2)),1)]),c("p",null,[t[27]||(t[27]=c("strong",null,"Total Assigned:",-1)),d(" $"+u(M.totalAssigned.toFixed(2))+" ("+u(M.totalAssignedPercentage.toFixed(2))+"%) ",1)]),c("p",null,[t[28]||(t[28]=c("strong",null,"Balance:",-1)),c("span",{class:g(0===M.remainingBalance?"text-success":"text-error")}," $"+u(M.remainingBalance.toFixed(2))+" ("+u(M.remainingBalancePercentage.toFixed(2))+"%) ",3)])]),t[29]||(t[29]=c("hr",null,null,-1)),o(D,{ref:"editAmountsForm"},{default:n((()=>[o(v,null,{default:n((()=>[(m(!0),i(l,null,p(r.editableMembers,((e,t)=>(m(),b(S,{key:e.uuid,class:g(["align-center",{"active-member":"remove"===r.currentMode}])},{default:n((()=>[o(k,{cols:"4"},{default:n((()=>[c("p",null,u(e.name),1)])),_:2},1024),o(k,{cols:"4"},{default:n((()=>{var t;return[o(P,{modelValue:e.percentage,"onUpdate:modelValue":t=>e.percentage=t,modelModifiers:{number:!0},label:"Percentage (%)",type:"number",readonly:e.readOnly,onInput:t=>M.updateAmountFromPercentage(e),rules:[r.rules.required,r.rules.positivePercentage],hint:"remove"===r.currentMode?`Previous: ${null==(t=r.originalMembers.find((t=>t.uuid===e.uuid)))?void 0:t.percentage}%`:"","persistent-hint":"",required:""},null,8,["modelValue","onUpdate:modelValue","readonly","onInput","rules","hint"])]})),_:2},1024),o(k,{cols:"4"},{default:n((()=>[o(P,{modelValue:e.amount,"onUpdate:modelValue":t=>e.amount=t,modelModifiers:{number:!0},label:"Amount ($)",type:"number",readonly:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1032,["class"])))),128)),"remove"===r.currentMode&&r.selectedMember?(m(),b(S,{key:0,class:"align-center removed-member-row"},{default:n((()=>[o(k,{cols:"4"},{default:n((()=>[c("p",L,u(r.selectedMember.name)+" (Being Removed) ",1)])),_:1}),o(k,{cols:"4"},{default:n((()=>[o(P,{value:r.selectedMember.percentage,label:"Previous Percentage (%)",disabled:"",readonly:"",class:"grey--text"},null,8,["value"])])),_:1}),o(k,{cols:"4"},{default:n((()=>[o(P,{value:r.selectedMember.amount,label:"Previous Amount ($)",disabled:"",readonly:"",class:"grey--text"},null,8,["value"])])),_:1})])),_:1})):h("",!0)])),_:1})])),_:1},512),"add"==r.currentMode?(m(),b(v,{key:1},{default:n((()=>[o(D,{ref:"addMemberForm",onSubmit:f(M.submitChanges,["prevent"]),modelValue:M.isFormValid,"onUpdate:modelValue":t[10]||(t[10]=e=>M.isFormValid=e)},{default:n((()=>[o(v,null,{default:n((()=>[o(S,null,{default:n((()=>[o(k,{cols:"6"},{default:n((()=>[o(P,{modelValue:r.newMemberForm.firstName,"onUpdate:modelValue":t[4]||(t[4]=e=>r.newMemberForm.firstName=e),label:"First Name",rules:[r.rules.required],required:""},null,8,["modelValue","rules"])])),_:1}),o(k,{cols:"6"},{default:n((()=>[o(P,{modelValue:r.newMemberForm.lastName,"onUpdate:modelValue":t[5]||(t[5]=e=>r.newMemberForm.lastName=e),label:"Last Name",rules:[r.rules.required],required:""},null,8,["modelValue","rules"])])),_:1})])),_:1}),o(S,null,{default:n((()=>[o(k,{cols:"12"},{default:n((()=>[o(P,{modelValue:r.newMemberForm.email,"onUpdate:modelValue":t[6]||(t[6]=e=>r.newMemberForm.email=e),label:"Email",rules:[r.rules.required,r.rules.email],required:""},null,8,["modelValue","rules"])])),_:1})])),_:1}),o(S,null,{default:n((()=>[o(k,{cols:"6"},{default:n((()=>[o(P,{modelValue:r.newMemberForm.percentage,"onUpdate:modelValue":t[7]||(t[7]=e=>r.newMemberForm.percentage=e),modelModifiers:{number:!0},label:"Percentage (%)",type:"number",min:"1",max:"100",rules:[r.rules.required,r.rules.positivePercentage],onInput:t[8]||(t[8]=e=>M.updateAmountFromPercentage(r.newMemberForm)),required:""},null,8,["modelValue","rules"])])),_:1}),o(k,{cols:"6"},{default:n((()=>[o(P,{modelValue:M.calculatedNewMemberAmount,"onUpdate:modelValue":t[9]||(t[9]=e=>M.calculatedNewMemberAmount=e),label:"Amount ($)",type:"text",readonly:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit","modelValue"])])),_:1})):h("",!0)])),_:1}),o(E,null,{default:n((()=>[o(y,{color:"primary",disabled:0!==M.remainingBalance,loading:r.isSubmitting,onClick:M.submitChanges},{default:n((()=>[d(u("add"===r.currentMode?"Send Invite":"remove"===r.currentMode?"Confirm Removal":"Submit Changes"),1)])),_:1},8,["disabled","loading","onClick"]),o(y,{color:"grey",onClick:M.closeEditAmountsModal,disabled:r.isSubmitting},{default:n((()=>t[30]||(t[30]=[d("Cancel")]))),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),o(w,{modelValue:r.showAdminLeaveModal,"onUpdate:modelValue":t[13]||(t[13]=e=>r.showAdminLeaveModal=e),persistent:"","max-width":"500px"},{default:n((()=>[o(A,null,{default:n((()=>[o(F,null,{default:n((()=>t[31]||(t[31]=[d("Admin Leaving Options")]))),_:1}),o(_,null,{default:n((()=>[t[32]||(t[32]=c("p",null,"You are about to leave the team. Choose one of the following options:",-1)),r.teamMembers.length>1?(m(),b(I,{key:0,modelValue:r.newAdminUuid,"onUpdate:modelValue":t[12]||(t[12]=e=>r.newAdminUuid=e),items:M.promotableMembers,"item-text":"name","item-value":"uuid",label:"Select New Admin","error-messages":r.adminSelectError,onInput:M.clearAdminError},null,8,["modelValue","items","error-messages","onInput"])):(m(),i("p",q,"There are no other members in this team. You can dissolve the team."))])),_:1}),o(E,null,{default:n((()=>[r.teamMembers.length>1?(m(),b(y,{key:0,color:"primary",onClick:M.promoteNewAdmin,loading:r.isPromoting},{default:n((()=>t[33]||(t[33]=[d(" Promote New Admin ")]))),_:1},8,["onClick","loading"])):h("",!0),o(y,{color:"red",onClick:M.showDissolveConfirmation},{default:n((()=>t[34]||(t[34]=[d("Dissolve Team")]))),_:1},8,["onClick"]),o(y,{color:"grey",onClick:M.closeAdminLeaveModal},{default:n((()=>t[35]||(t[35]=[d("Cancel")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),o(w,{modelValue:r.showDissolveModal,"onUpdate:modelValue":t[16]||(t[16]=e=>r.showDissolveModal=e),persistent:"","max-width":"500px"},{default:n((()=>[o(A,null,{default:n((()=>[o(F,null,{default:n((()=>t[36]||(t[36]=[d("Confirm Team Dissolution")]))),_:1}),o(_,null,{default:n((()=>[t[37]||(t[37]=c("p",null,"A verification code has been sent to your email.",-1)),o(P,{modelValue:r.verificationCode,"onUpdate:modelValue":t[14]||(t[14]=e=>r.verificationCode=e),label:"Enter Verification Code","error-messages":r.codeError,onInput:M.clearCodeError,maxlength:"6",rules:[e=>!!e||"Code is required",e=>/^[0-9]{6}$/.test(e)||"Code must be 6 digits"],type:"text",onKeypress:M.numericOnly},null,8,["modelValue","error-messages","onInput","rules","onKeypress"]),o(U,{modelValue:r.dissolveConfirmed,"onUpdate:modelValue":t[15]||(t[15]=e=>r.dissolveConfirmed=e),label:"I understand this action cannot be undone","error-messages":r.checkboxError,onChange:M.clearCheckboxError},null,8,["modelValue","error-messages","onChange"])])),_:1}),o(E,null,{default:n((()=>[o(y,{color:"red",onClick:M.confirmDissolveTeam,loading:r.isDissolving,disabled:!r.dissolveConfirmed||!r.verificationCode},{default:n((()=>t[38]||(t[38]=[d(" Dissolve Team ")]))),_:1},8,["onClick","loading","disabled"]),o(y,{color:"grey",onClick:M.closeDissolveModal},{default:n((()=>t[39]||(t[39]=[d("Cancel")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}],["__scopeId","data-v-2f317fdc"]]);export{B as default};

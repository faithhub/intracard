import{i as e}from"./intracard-Q-6WcxOO.js";import{b as t}from"./app-B9jtdv3Q.js";import{_ as s,a as i,x as a,e as o,m as r,b as n,V as l,i as d,D as c,z as m,E as u,u as h,F as f,k as p,h as v,G as g,A as w,j as y,y as b,B as _}from"./main-DhXQbgH3.js";import{z as V,C,M as E,L as P,O as k,G as D,H as I,E as x,J as N,D as T}from"./vendor-DWrK2g1_.js";const j={class:"text-h5 mb-4"},$={class:"mb-6"},q={class:"text-center pb-5",style:{"background-color":"#7b1fa2 !important"}},L={class:"text-h6 mb-2 font-weight-bold primary-text"},S={class:"mt-2"},A={class:"content-text mb-2"},U={class:"mt-2"},F={class:"d-flex justify-space-between align-center mb-1"},R={class:"label-text"},M={class:"content-text"},Y={class:"d-flex justify-space-between align-center mb-1"},z={class:"content-text"},O={class:"d-flex justify-space-between align-center"},G={class:"content-text"};const W=s({setup:()=>({toast:t()}),data(){return{showDeclineDialog:!1,isDeclining:!1,isLoading:!0,isValid:!1,errorMessage:"",invitation:null,errorDescription:"",status:"",logoSrc:e,verificationCode:"",cooldownTime:0,cooldownInterval:null,form:{firstName:"",middleName:"",lastName:"",email:"",phone:"",password:"",password_confirmation:"",consent:!1},token:null,attemptsRemaining:5,validationErrors:{phone:[],verificationCode:[]},showPassword:!1,isRegistering:!1,isDeclining:!1,isSendingCode:!1,isVerifyingCode:!1,isCodeSent:!1,isPhoneVerified:!1,verificationCode:"",displayPhone:"",rules:{required:e=>!!e||"This field is required",email:e=>/.+@.+\..+/.test(e)||"Enter a valid email address",min:e=>e.length>=8||"Password must be at least 8 characters",passwordMatch:e=>e===this.form.password||"Passwords must match",phone:e=>/^\+?[\d\s-]{10,}$/.test(e)||"Enter a valid phone number",consent:e=>e||"You must agree to the terms"}}},computed:{isPhoneValid(){return!0===this.rules.phone(this.form.phone)},isFormValid(){return this.valid&&this.isPhoneVerified&&this.form.consent},canVerifyPhone(){return 10===this.form.phone.replace(/\D/g,"").length&&!this.isPhoneVerified},errorIcon(){switch(this.status){case"declined":return"mdi-close-circle";case"accepted":return"mdi-check-circle";case"expired":return"mdi-clock-alert";default:return"mdi-alert-circle"}},errorIconColor(){switch(this.status){case"declined":default:return"error";case"accepted":return"success";case"expired":return"warning"}},errorDescription(){switch(this.status){case"declined":return"This invitation has been declined. Please contact the team administrator for a new invitation if needed.";case"accepted":return"This invitation has already been used. Please login to your account.";case"expired":return"This invitation has expired. Please contact the team administrator for a new invitation.";default:return"Please contact the team administrator for assistance."}}},created(){this.token=this.$route.params.token,this.token?this.checkInvitation():this.handleInvalidInvitation("Invalid invitation link")},methods:{async register(){var e,t,s,a,o,r;if(this.validateForm()){if(!this.isPhoneVerified)return this.toast.error("Please verify your phone number"),void(this.validationErrors.phone=["Phone number must be verified"]);this.isRegistering=!0;try{const t={first_name:this.form.firstName.trim(),middle_name:(null==(e=this.form.middleName)?void 0:e.trim())||null,last_name:this.form.lastName.trim(),email:this.form.email.trim(),phone:this.form.phone.replace(/\D/g,""),password:this.form.password,password_confirmation:this.form.password_confirmation,terms_accepted:this.form.consent};await i.post(`/api/team/invitation/${this.token}/accept`,t);this.toast.success("Registration completed! Please check your email for verification instructions."),setTimeout((()=>{this.$router.push({name:"Login"})}),2e3)}catch(n){422===(null==(t=n.response)?void 0:t.status)?(this.validationErrors=n.response.data.errors,this.toast.error("Please correct the errors in the form")):404===(null==(s=n.response)?void 0:s.status)?(this.toast.error("Invalid or expired invitation"),setTimeout((()=>this.$router.push({name:"Login"})),3e3)):409===(null==(a=n.response)?void 0:a.status)?(this.validationErrors.email=[n.response.data.message],this.toast.error("Email address is already registered")):(null==(r=null==(o=n.response)?void 0:o.data)?void 0:r.message)?this.toast.error(n.response.data.message):(this.toast.error("An unexpected error occurred. Please try again."),console.error("Registration error:",n))}finally{this.isRegistering=!1}}else this.toast.error("Please fill in all required fields")},async checkInvitation(){var e,t,s,a;try{const e=await i.get(`/api/team/invitation/${this.token}`);if(!e.data.valid)return void this.handleInvalidInvitation(e.data.message,e.data.status);if(this.isValid=!0,this.invitation=e.data.data,this.form.email=this.invitation.email,this.invitation.name){const e=this.invitation.name.split(" ");this.form.firstName=e[0]||"",this.form.lastName=e[e.length-1]||"",e.length>2&&(this.form.middleName=e.slice(1,-1).join(" "))}}catch(o){const i=(null==(t=null==(e=o.response)?void 0:e.data)?void 0:t.message)||"Error loading invitation details",r=(null==(a=null==(s=o.response)?void 0:s.data)?void 0:a.status)||"";this.handleInvalidInvitation(i,r)}finally{this.isLoading=!1}},handleInvalidInvitation(e,t=""){this.isValid=!1,this.errorMessage=e,this.status=t,this.isLoading=!1,"accepted"===t&&setTimeout((()=>{this.$router.push({name:"login"})}),3e3)},onPhoneInput(e){this.clearError("phone");let t=(e||"").replace(/\D/g,"");t.length>10&&(t=t.slice(0,10));let s=t;t.length>6?s=`${t.slice(0,3)} ${t.slice(3,6)} ${t.slice(6)}`:t.length>3&&(s=`${t.slice(0,3)} ${t.slice(3)}`),this.form.phone=s},clearError(e){this.validationErrors[e]&&delete this.validationErrors[e]},async sendVerificationCode(){var e,t,s,a;this.isSendingCode=!0;try{const e=this.form.phone.replace(/\D/g,""),t=await i.post("/api/phone/send-code",{phone:e});this.isCodeSent=!0,this.toast.success("Verification code sent"),this.cooldownTime=60,this.startCooldownTimer(),t.data.data&&(this.attemptsRemaining=t.data.data.attempts_remaining)}catch(o){if(null==(t=null==(e=o.response)?void 0:e.data)?void 0:t.errors){const e=Object.values(o.response.data.errors).flat().join("\n");this.toast.error(e),o.response.data.errors.phone&&(this.validationErrors.phone=o.response.data.errors.phone)}else(null==(a=null==(s=o.response)?void 0:s.data)?void 0:a.message)?this.toast.error(o.response.data.message):this.toast.error("Error sending verification code")}finally{this.isSendingCode=!1}},async verifyCode(){var e,t,s,a;this.isVerifyingCode=!0;try{const e=this.form.phone.replace(/\D/g,"");await i.post("/api/phone/verify-code",{phone:e,code:this.verificationCode}),this.isPhoneVerified=!0,this.toast.success("Phone number verified"),this.validationErrors.phone=[],this.verificationCode="",this.isCodeSent=!1}catch(o){if(null==(t=null==(e=o.response)?void 0:e.data)?void 0:t.errors){const e=Object.values(o.response.data.errors).flat().join("\n");this.toast.error(e),o.response.data.errors.code&&(this.validationErrors.verificationCode=o.response.data.errors.code),o.response.data.errors.phone&&(this.validationErrors.phone=o.response.data.errors.phone)}else(null==(a=null==(s=o.response)?void 0:s.data)?void 0:a.message)?this.toast.error(o.response.data.message):this.toast.error("Invalid verification code")}finally{this.isVerifyingCode=!1}},startCooldownTimer(){this.cooldownInterval&&clearInterval(this.cooldownInterval),this.cooldownInterval=setInterval((()=>{this.cooldownTime>0?this.cooldownTime--:clearInterval(this.cooldownInterval)}),1e3)},capitalizeFirstLetter:e=>e?("string"!=typeof e&&(e=String(e)),e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()):"",formatToCAD:e=>new Intl.NumberFormat("en-CA",{style:"currency",currency:"CAD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),validateForm(){return this.validationErrors={},this.form.firstName||(this.validationErrors.firstName=["First name is required"]),this.form.lastName||(this.validationErrors.lastName=["Last name is required"]),this.form.email||(this.validationErrors.email=["Email is required"]),this.form.phone||(this.validationErrors.phone=["Phone number is required"]),this.form.password||(this.validationErrors.password=["Password is required"]),this.form.password.length<8&&(this.validationErrors.password=["Password must be at least 8 characters"]),this.form.password!==this.form.password_confirmation&&(this.validationErrors.password_confirmation=["Passwords do not match"]),this.form.consent||(this.validationErrors.consent=["You must agree to the terms"]),0===Object.keys(this.validationErrors).length},async confirmDecline(){this.isDeclining=!0;try{const e=await i.post(`/api/team/invitation/${this.token}/decline`);this.toast.success(e.data.message||"Invitation declined successfully"),setTimeout((()=>{this.$router.push({name:"Login"})}),1500)}catch(e){if(e.response)switch(e.response.status){case 404:this.toast.error("Invitation not found or already processed");break;case 400:this.toast.error(e.response.data.message||"Invalid invitation status");break;case 403:this.toast.error("You do not have permission to decline this invitation");break;default:this.toast.error(e.response.data.message||"Error declining invitation")}else e.request?this.toast.error("Network error. Please check your connection and try again."):(this.toast.error("An unexpected error occurred"),console.error("Decline error:",e))}finally{this.isDeclining=!1,this.showDeclineDialog=!1}}},beforeDestroy(){this.cooldownInterval&&clearInterval(this.cooldownInterval)}},[["render",function(e,t,s,i,W,B){const H=E("router-link");return W.isLoading?(P(),V(a,{key:0,class:"fill-height d-flex align-center justify-center"},{default:C((()=>[k(n,{justify:"center",align:"center"},{default:C((()=>[k(o,{cols:"12",class:"text-center"},{default:C((()=>[k(r,{indeterminate:"",color:"purple-darken-2",size:"64",width:"4"})])),_:1})])),_:1})])),_:1})):(P(),V(a,{key:1,class:"fill-height"},{default:C((()=>[W.isValid?(P(),V(n,{key:1,align:"center",justify:"center"},{default:C((()=>[k(o,{cols:"12",sm:"10",md:"10",lg:"8"},{default:C((()=>[k(l,{class:"elevation-12"},{default:C((()=>[x("div",q,[k(H,{to:"/",onClick:t[0]||(t[0]=N((()=>{}),["prevent"]))},{default:C((()=>t[21]||(t[21]=[x("img",{alt:"Logo",src:"/build/assets/intracard-small-D4WtWD_P.png",class:"h-65px mb-2 mt-2"},null,-1)]))),_:1}),k(c,{class:"text-white"},{default:C((()=>t[22]||(t[22]=[D("Complete Your Registration")]))),_:1})]),k(m,null,{default:C((()=>[k(u,{type:"info",variant:"tonal",color:"purple-lighten-4",class:"mb-4 invitation-details",border:""},{default:C((()=>{var e,s,i,a,o,r;return[x("h3",L,"Team: "+I(null==(e=W.invitation)?void 0:e.team_name),1),k(h,{class:"my-2"}),x("div",S,[t[23]||(t[23]=x("div",{class:"label-text mb-1"},"Property Address:",-1)),x("p",A,I(null==(s=W.invitation)?void 0:s.property_address),1)]),k(h,{class:"my-2"}),x("div",U,[x("div",F,[x("span",R,"Total Amount for "+I(B.capitalizeFirstLetter(null==(i=W.invitation)?void 0:i.role))+":",1),x("span",M,I(B.formatToCAD(null==(a=W.invitation)?void 0:a.total_amount)),1)]),x("div",Y,[t[24]||(t[24]=x("span",{class:"label-text"},"Your Percentage:",-1)),x("span",z,I(null==(o=W.invitation)?void 0:o.percentage)+"%",1)]),x("div",O,[t[25]||(t[25]=x("span",{class:"label-text"},"Your Monthly Payment:",-1)),x("span",G,I(B.formatToCAD(null==(r=W.invitation)?void 0:r.monthly_payment)),1)])])]})),_:1}),k(f,{ref:"form",onSubmit:N(B.register,["prevent"])},{default:C((()=>{var e;return[k(n,null,{default:C((()=>[k(o,{cols:"12",md:"6"},{default:C((()=>[k(p,{modelValue:W.form.firstName,"onUpdate:modelValue":t[1]||(t[1]=e=>W.form.firstName=e),"error-messages":W.validationErrors.firstName,label:"First Name",outlined:"",dense:"",onInput:t[2]||(t[2]=e=>B.clearError("firstName")),required:""},null,8,["modelValue","error-messages"])])),_:1}),k(o,{cols:"12",md:"6"},{default:C((()=>[k(p,{modelValue:W.form.lastName,"onUpdate:modelValue":t[3]||(t[3]=e=>W.form.lastName=e),"error-messages":W.validationErrors.lastName,label:"Last Name",outlined:"",dense:"",onInput:t[4]||(t[4]=e=>B.clearError("lastName")),required:""},null,8,["modelValue","error-messages"])])),_:1})])),_:1}),k(n,null,{default:C((()=>[k(o,{cols:"12",md:"6"},{default:C((()=>[k(p,{modelValue:W.form.email,"onUpdate:modelValue":t[5]||(t[5]=e=>W.form.email=e),"error-messages":W.validationErrors.email,label:"Email",outlined:"",dense:"",onInput:t[6]||(t[6]=e=>B.clearError("email")),required:""},null,8,["modelValue","error-messages"])])),_:1}),k(o,{cols:"12",md:"6"},{default:C((()=>[k(p,{modelValue:W.form.middleName,"onUpdate:modelValue":t[7]||(t[7]=e=>W.form.middleName=e),label:"Middle Name (Optional)",outlined:"",dense:""},null,8,["modelValue"])])),_:1})])),_:1}),k(n,{align:"center",class:"mb-2 mt-2","no-gutters":""},{default:C((()=>[k(o,{cols:"10",class:"pe-2"},{default:C((()=>[k(p,{modelValue:W.form.phone,"onUpdate:modelValue":[t[8]||(t[8]=e=>W.form.phone=e),B.onPhoneInput],"error-messages":W.validationErrors.phone,label:"Phone Number",readonly:W.isPhoneVerified,suffix:W.isPhoneVerified?"✓ Verified":"",outlined:"",dense:"",class:"input-no-spacing"},{prepend:C((()=>t[26]||(t[26]=[x("div",{class:"d-flex align-center"},[x("img",{src:"/build/assets/ca-flag-DhNpSlue.png",alt:"Canadian flag",class:"mr-1",style:{width:"20px",height:"15px"}}),x("span",{class:"country-prefix"},"+1")],-1)]))),_:1},8,["modelValue","error-messages","readonly","suffix","onUpdate:modelValue"])])),_:1}),k(o,{cols:"2",class:"pl-1"},{default:C((()=>[k(v,{color:"purple-darken-2",loading:W.isSendingCode,disabled:!B.canVerifyPhone||W.cooldownTime>0,onClick:B.sendVerificationCode,width:"120",height:"40",class:"ml-auto d-block"},{default:C((()=>[D(I(W.isPhoneVerified?"✓ Verified":W.cooldownTime>0?`${W.cooldownTime}s`:"Get Code"),1)])),_:1},8,["loading","disabled","onClick"])])),_:1})])),_:1}),W.isCodeSent&&!W.isPhoneVerified?(P(),V(n,{key:0,align:"center",class:"mb-2"},{default:C((()=>[k(o,{cols:"10",class:"pt-0"},{default:C((()=>[k(p,{modelValue:W.verificationCode,"onUpdate:modelValue":t[9]||(t[9]=e=>W.verificationCode=e),"error-messages":W.validationErrors.verificationCode,label:"Enter Verification Code",outlined:"",dense:"",maxlength:"6",placeholder:"Enter 6-digit code"},null,8,["modelValue","error-messages"])])),_:1}),k(o,{cols:"2",class:"pl-0 pt-0"},{default:C((()=>[k(v,{color:"success",loading:W.isVerifyingCode,onClick:B.verifyCode,width:"120",height:"40",class:"ml-auto d-block",disabled:!W.verificationCode||6!==W.verificationCode.length},{default:C((()=>t[27]||(t[27]=[D(" Verify ")]))),_:1},8,["loading","onClick","disabled"])])),_:1})])),_:1})):T("",!0),k(p,{class:"mb-3",modelValue:W.form.password,"onUpdate:modelValue":t[10]||(t[10]=e=>W.form.password=e),"error-messages":W.validationErrors.password,type:W.showPassword?"text":"password",label:"Password",outlined:"",dense:"","append-icon":W.showPassword?"mdi-eye":"mdi-eye-off","onClick:append":t[11]||(t[11]=e=>W.showPassword=!W.showPassword),onInput:t[12]||(t[12]=e=>B.clearError("password")),required:""},null,8,["modelValue","error-messages","type","append-icon"]),k(p,{modelValue:W.form.password_confirmation,"onUpdate:modelValue":t[13]||(t[13]=e=>W.form.password_confirmation=e),"error-messages":W.validationErrors.password_confirmation,type:W.showPassword?"text":"password",label:"Confirm Password",outlined:"",dense:"",onInput:t[14]||(t[14]=e=>B.clearError("password_confirmation")),required:""},null,8,["modelValue","error-messages","type"]),k(g,{modelValue:W.form.consent,"onUpdate:modelValue":t[15]||(t[15]=e=>W.form.consent=e),"error-messages":W.validationErrors.consent,label:`I agree to the terms and conditions and confirm that I will be responsible for my portion of the ${(null==(e=W.invitation)?void 0:e.role)||"rent/mortgage"} payment`,onChange:t[16]||(t[16]=e=>B.clearError("consent")),required:""},null,8,["modelValue","error-messages","label"])]})),_:1},8,["onSubmit"])])),_:1}),k(w,null,{default:C((()=>[k(y),k(v,{variant:"outlined",color:"error",onClick:t[17]||(t[17]=e=>W.showDeclineDialog=!0),loading:W.isDeclining},{default:C((()=>t[28]||(t[28]=[D(" Decline ")]))),_:1},8,["loading"]),k(v,{variant:"flat",color:"purple-darken-2",onClick:B.register,loading:W.isRegistering,class:"ml-4"},{default:C((()=>t[29]||(t[29]=[D(" Complete Registration ")]))),_:1},8,["onClick","loading"])])),_:1})])),_:1})])),_:1})])),_:1})):(P(),V(n,{key:0,align:"center",justify:"center"},{default:C((()=>[k(o,{cols:"12",sm:"8",md:"6"},{default:C((()=>[k(l,{class:"text-center pa-6"},{default:C((()=>[k(d,{size:"64",color:B.errorIconColor,class:"mb-4"},{default:C((()=>[D(I(B.errorIcon),1)])),_:1},8,["color"]),x("h2",j,I(W.errorMessage),1),x("p",$,I(B.errorDescription),1),k(H,{to:"/auth/sign-in",class:"home-button"},{default:C((()=>t[20]||(t[20]=[D("Return to Login")]))),_:1})])),_:1})])),_:1})])),_:1})),k(_,{modelValue:W.showDeclineDialog,"onUpdate:modelValue":t[19]||(t[19]=e=>W.showDeclineDialog=e),"max-width":"400"},{default:C((()=>[k(l,null,{default:C((()=>[k(b,null,{default:C((()=>t[30]||(t[30]=[D("Decline Invitation?")]))),_:1}),k(m,null,{default:C((()=>t[31]||(t[31]=[D(" Are you sure you want to decline this invitation? This action cannot be undone. ")]))),_:1}),k(w,null,{default:C((()=>[k(y),k(v,{color:"grey-darken-1",variant:"text",onClick:t[18]||(t[18]=e=>W.showDeclineDialog=!1)},{default:C((()=>t[32]||(t[32]=[D(" Cancel ")]))),_:1}),k(v,{color:"error",variant:"text",loading:W.isDeclining,onClick:B.confirmDecline},{default:C((()=>t[33]||(t[33]=[D(" Yes, Decline ")]))),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}))}],["__scopeId","data-v-6426cf47"]]);export{W as default};

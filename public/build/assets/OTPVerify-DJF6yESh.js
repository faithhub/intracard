import{u as e,b as t,c as s,r as o}from"./app-B9jtdv3Q.js";import{v as r,E as a,J as n,O as i,C as l,H as d,D as c,F as u,K as m,G as p,y as h,M as f,L as g,X as v}from"./vendor-DWrK2g1_.js";import{i as y}from"./intracard-Q-6WcxOO.js";import{_ as w}from"./main-DhXQbgH3.js";const b={class:"d-flex flex-column flex-root",id:"kt_app_root"},T={class:"d-flex flex-column flex-xl-row flex-column-fluid"},x={class:"container"},P={class:"center-div"},O={class:"flex-row-fluid flex-center justfiy-content-xl-first p-10"},I={class:""},k={class:"text-center mb-9"},L={class:"fv-row mb-5 text-center"},_={key:0,class:"text-danger mb-3"},j={class:"otp-container"},C=["onInput","onKeydown"],F={class:"text-center mt-9"},S=["disabled"],V={key:0},$={key:1},M={class:"text-center"},A={class:"mt-4"},D={class:"text-black"},E={class:"countdown"},K=["disabled"],q={key:0},B={key:1};const R=w({setup:()=>({logout:e().logout}),data:()=>({otp:Array(6).fill(""),loading:!1,resendLoading:!1,error:null,countdownTime:300,intervalId:null}),computed:{isFormValid(){return this.otp.every((e=>""!==e))&&6===this.otp.join("").length},countdown(){return`${Math.floor(this.countdownTime/60)}:${(this.countdownTime%60).toString().padStart(2,"0")}`}},methods:{handleInput(e,t){const s=t.target.value;/^[0-9]$/.test(s)?(this.otp[e]=s,e<5&&this.$refs.otpInputs[e+1].focus()):t.target.value=""},handleBackspace(e,t){""===t.target.value?(this.otp[e]="",e>0&&this.$refs.otpInputs[e-1].focus()):this.otp[e]=""},async resendOTP(){const e=t();this.resendLoading=!0;try{const t=await s.post("/auth/otp-resend");console.log(t),t.data.success?(e.success(t.data.message||"OTP resent successfully!",{timeout:3e3}),this.countdownTime=300,localStorage.setItem("otpCountdown",Math.floor(Date.now()/1e3)+300)):e.error(t.data.message||"Failed to resend OTP.",{timeout:5e3})}catch(o){e.error("Failed to resend OTP. Please try again later.",{timeout:5e3})}finally{this.resendLoading=!1}},async verifyOTP(){const r=t();this.loading=!0,this.error=null;try{const t=this.otp.join("");if(!this.isFormValid)throw new Error("Please fill in all the OTP boxes.");console.log(t);const a=await s.post("/auth/otp-verify",{otp_code:t});if(a.data.success){const t=e();return await t.updateUserState({...t.user,otp_verified:!0}),r.success(a.data.message||"OTP verified successfully!",{timeout:3e3}),void o.push(a.data.redirect_url||"/dashboard")}r.error(a.data.message||"Failed to verify OTP.",{timeout:5e3})}catch(a){if("Please fill in all the OTP boxes."===a.message)this.error=a.message,r.error(this.error,{timeout:5e3});else if(a.response)if(422===a.response.status){const e=a.response.data.errors||{},t=Object.values(e)[0][0]||"Validation failed.";this.error=t,r.error(t,{timeout:5e3})}else 409===a.response.status?(this.error=a.response.data.message||"Invalid or expired OTP.",r.error(this.error,{timeout:5e3})):(this.error=a.response.data.message||"An unexpected server error occurred.",r.error(this.error,{timeout:5e3}));else a.request?(this.error="No response from the server. Please try again.",r.error(this.error,{timeout:5e3})):(this.error="An error occurred while verifying OTP.",r.error(this.error,{timeout:5e3}))}finally{this.loading=!1}},startCountdown(){const e=localStorage.getItem("otpCountdown"),t=Math.floor(Date.now()/1e3);e&&e>t?this.countdownTime=e-t:(this.countdownTime=300,localStorage.setItem("otpCountdown",t+300)),this.intervalId=setInterval((()=>{this.countdownTime>0?this.countdownTime--:clearInterval(this.intervalId)}),1e3)},async handleLogout(){const e=t();try{await this.logout()}catch(s){e.error("Logout failed. Please try again.",{timeout:5e3})}}},mounted(){this.startCountdown()},beforeUnmount(){clearInterval(this.intervalId)}},[["render",function(e,t,s,o,w,R){const U=f("router-link");return g(),r("div",b,[a("div",T,[a("div",x,[a("div",P,[a("div",O,[a("div",I,[a("form",{class:"form",novalidate:"novalidate",onSubmit:t[2]||(t[2]=n(((...e)=>R.verifyOTP&&R.verifyOTP(...e)),["prevent"]))},[a("div",k,[i(U,{class:"mb-15",to:""},{default:l((()=>t[3]||(t[3]=[a("img",{alt:"Logo",src:y,class:"h-100px"},null,-1)]))),_:1}),t[4]||(t[4]=a("h2",{class:"text-gray-900 mb-3"},"Verify OTP",-1)),t[5]||(t[5]=a("div",{class:"text-gray-500 fw-semibold fs-4"}," Enter the OTP code sent to your email ",-1))]),a("div",L,[w.error?(g(),r("p",_,d(w.error),1)):c("",!0),a("div",j,[(g(),r(u,null,m(6,((e,t)=>a("input",{key:t,ref_for:!0,ref:"otpInputs",maxlength:1,type:"text",class:"otp-box",onInput:e=>R.handleInput(t,e),onKeydown:v((e=>R.handleBackspace(t,e)),["backspace"])},null,40,C))),64))]),a("div",F,[a("button",{class:"btn btn-dark",type:"submit",disabled:!R.isFormValid||w.loading},[w.loading?(g(),r("span",$,"Verifying...")):(g(),r("span",V,"Verify & Proceed"))],8,S)])]),a("div",M,[a("button",{onClick:t[0]||(t[0]=(...e)=>R.handleLogout&&R.handleLogout(...e)),class:"btn btn-outline-danger-custom mt-2",type:"button"},"Logout"),a("div",A,[a("p",D,[t[6]||(t[6]=p(" If you haven't received your OTP, you can request it again in ")),a("span",E,d(R.countdown),1)]),a("button",{class:h([{"btn-secondary":w.countdownTime>0,"btn-primary":0===w.countdownTime},"btn"]),disabled:w.countdownTime>0||w.resendLoading,onClick:t[1]||(t[1]=n(((...e)=>R.resendOTP&&R.resendOTP(...e)),["prevent"])),type:"button"},[w.resendLoading?(g(),r("span",q,"Resending...")):(g(),r("span",B,"Resend OTP"))],10,K)])])],32)])])])])])])}],["__scopeId","data-v-f7ce6764"]]);export{R as default};
